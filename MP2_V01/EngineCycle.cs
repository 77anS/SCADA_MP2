using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Threading;
using System.Timers;

using S7.Net;
using ElementBase_Template.PLC.Data_Mapping;
using ElementBase_Template.PLC.Data_Mapping.Engine;
using ElementBase_Template.PLC.PLC1;
using ElementBase_Template.PLC.PLC2;
using ElementBase_Template.PLC.PLC3;
using ElementBase_Template.ALARM;
using System.Windows.Forms;
using System.Drawing;

using ElementBase_Template.User;
using System.Runtime.InteropServices;

using MongoDB.Driver;
using MongoDB.Bson;

using ElementBase_Template.MongoDB;
using ElementBase_Template.Ultility;

namespace MP2_V01
{
    public class EngineCycle
    {
        // PLC: CPU1214C - Giai đoạn 1 "GD1" IP = "192.168.0.3", Rack = 0, Slot = 1;
        public class PLC_GD1 : PLC
        {
            InputStatus_DB43 InputStatus_PLC1 = new InputStatus_DB43();
            QuanTracIndex_DB44 QuanTracIndex_PLC1 = new QuanTracIndex_DB44();
            ResetRuntime_DB20 ResetRuntime_PLC1 = new ResetRuntime_DB20();
            Runtime_DB19 Runtime_PLC1 = new Runtime_DB19();
            RuntimeSetting_DB16 RuntimeSetting_PLC1 = new RuntimeSetting_DB16();

            // 192.168.0.11 CARD ETHERNET MAP TO 192.168.0.3 => GET 192.168.0.11 FOR TESTING:
            // PLC GD1: 192.168.0.3, RACK: 0, SLOT: 1
            public PLC_GD1() : base("S7_1200_GD1", CpuType.S71200, "192.168.0.3", 0, 1, 250)
            {
                // myPLC = new Plc(CpuType.S71200, "192.168.0.11", 0, 1);
                // Do nothing!

            }
            public async override void updateEventHandler(object sender, ElapsedEventArgs e)
            {
                Action myAction = () =>
                {
                    try
                    {
                        if (plc.IsAvailable)
                        {
                            plc_connectError = this.plc.Open();

                            plc_connected = this.plc.IsConnected;
                            plc_isAvailable = this.plc.IsAvailable;

                            if (plc.IsConnected)
                            {
                                #region READ DATA FROM PLC1:

                                // READ DATA: to CLASS AT PLC:
                                plc.ReadClass(InputStatus_PLC1, 43, 0);
                                plc.ReadClass(ResetRuntime_PLC1, 20, 0);
                                plc.ReadClass(Runtime_PLC1, 19, 0);
                                plc.ReadClass(RuntimeSetting_PLC1, 16, 0);
                                //plc.ReadClass(QuanTracIndex_PLC1, 44, 0);


                                QuanTracIndex_PLC1.cod_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 0, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.tss_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 4, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.flowOutCap = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 8, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.ph_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 12, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.color_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 16, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.temper_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 20, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.nh3_Index = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 24, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.flowInCap = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 28, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.flowOutTotal = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 32, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.reset_flowOut_total = Convert.ToBoolean(plc.Read(DataType.DataBlock, 44, 36, VarType.Bit, 1, 0));
                                QuanTracIndex_PLC1.flowInTotal = Convert.ToSingle(plc.Read(DataType.DataBlock, 44, 38, VarType.Real, 1, 0));
                                QuanTracIndex_PLC1.reset_flowIn_total = Convert.ToBoolean(plc.Read(DataType.DataBlock, 44, 42, VarType.Bit, 1, 0));

                                #endregion

                                #region SAVE DATA

                                // Chỉ số quan trắc:
                                Program.QuanTracIndex_PLC1.flowInCap = QuanTracIndex_PLC1.flowInCap;
                                Program.QuanTracIndex_PLC1.flowOutCap = QuanTracIndex_PLC1.flowOutCap;
                                Program.QuanTracIndex_PLC1.flowInTotal = QuanTracIndex_PLC1.flowInTotal;
                                Program.QuanTracIndex_PLC1.flowOutTotal = QuanTracIndex_PLC1.flowOutTotal;
                                Program.QuanTracIndex_PLC1.cod_Index = QuanTracIndex_PLC1.cod_Index;
                                Program.QuanTracIndex_PLC1.tss_Index = QuanTracIndex_PLC1.tss_Index;
                                Program.QuanTracIndex_PLC1.ph_Index = QuanTracIndex_PLC1.ph_Index;
                                Program.QuanTracIndex_PLC1.color_Index = QuanTracIndex_PLC1.cod_Index;
                                Program.QuanTracIndex_PLC1.temper_Index = QuanTracIndex_PLC1.temper_Index;
                                Program.QuanTracIndex_PLC1.nh3_Index = QuanTracIndex_PLC1.nh3_Index;
                                Program.QuanTracIndex_PLC1.reset_flowIn_total = QuanTracIndex_PLC1.reset_flowIn_total;
                                Program.QuanTracIndex_PLC1.reset_flowOut_total = QuanTracIndex_PLC1.reset_flowOut_total;



                                // Chỉ số Quan trắc cho Logger:
                                Program.QuanTracIndexLogger.codIndex_Tag.Value = Program.QuanTracIndex_PLC1.cod_Index;
                                Program.QuanTracIndexLogger.codIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.tssIndex_Tag.Value = Program.QuanTracIndex_PLC1.tss_Index;
                                Program.QuanTracIndexLogger.tssIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.phIndex_Tag.Value = Program.QuanTracIndex_PLC1.ph_Index;
                                Program.QuanTracIndexLogger.phIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.colorIndex_Tag.Value = Program.QuanTracIndex_PLC1.color_Index;
                                Program.QuanTracIndexLogger.colorIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.temperIndex_Tag.Value = Program.QuanTracIndex_PLC1.temper_Index;
                                Program.QuanTracIndexLogger.temperIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.amoniIndex_Tag.Value = Program.QuanTracIndex_PLC1.nh3_Index;
                                Program.QuanTracIndexLogger.amoniIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.flowInTotalIndex_Tag.Value = Program.QuanTracIndex_PLC1.flowInTotal;
                                Program.QuanTracIndexLogger.flowInTotalIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.flowInCapIndex_Tag.Value = Program.QuanTracIndex_PLC1.flowInCap;
                                Program.QuanTracIndexLogger.flowInCapIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.flowOutTotalIndex_Tag.Value = Program.QuanTracIndex_PLC1.flowOutTotal;
                                Program.QuanTracIndexLogger.flowOutTotalIndex_Tag.Timestamp = DateTime.Now;

                                Program.QuanTracIndexLogger.flowOutCapIndex_Tag.Value = Program.QuanTracIndex_PLC1.flowOutCap;
                                Program.QuanTracIndexLogger.flowOutCapIndex_Tag.Timestamp = DateTime.Now;

                                // Cập nhật giá trị phao bể gom
                                Program.InputStatus_PLC1.low_beGom_float = InputStatus_PLC1.low_beGom_float; // Read "I2.6"
                                Program.InputStatus_PLC1.medium_beGom_float = InputStatus_PLC1.medium_beGom_float; // Read "I2.7"
                                Program.InputStatus_PLC1.high_beGom_float = InputStatus_PLC1.high_beGom_float; // Read "I3.0"

                                // Trạng thái "RUN" GD1
                                Program.InputStatus_PLC1.dieuHoa1_runStatus = InputStatus_PLC1.dieuHoa1_runStatus;
                                Program.InputStatus_PLC1.dieuHoa2_runStatus = InputStatus_PLC1.dieuHoa2_runStatus;
                                Program.InputStatus_PLC1.tuanHoanNuoc_runStatus = InputStatus_PLC1.tuanHoanNuoc_runStatus;
                                Program.InputStatus_PLC1.tuanHoanBun_runStatus = InputStatus_PLC1.tuanHoanBun_runStatus;
                                Program.InputStatus_PLC1.bunHoaLy1_runStatus = InputStatus_PLC1.bunHoaLy1_runStatus;
                                Program.InputStatus_PLC1.bunHoaLy2_runStatus = InputStatus_PLC1.bunHoaLy2_runStatus;
                                Program.InputStatus_PLC1.beGom1_runStatus = InputStatus_PLC1.beGom1_runStatus;
                                Program.InputStatus_PLC1.beGom2_runStatus = InputStatus_PLC1.beGom2_runStatus;
                                Program.InputStatus_PLC1.beGom3_runStatus = InputStatus_PLC1.beGom3_runStatus;
                                Program.InputStatus_PLC1.skbm1_runStatus = InputStatus_PLC1.skbm1_runStatus;
                                Program.InputStatus_PLC1.skbm2_runStatus = InputStatus_PLC1.skbm2_runStatus;
                                Program.InputStatus_PLC1.skbm3_runStatus = InputStatus_PLC1.skbm3_runStatus;
                                Program.InputStatus_PLC1.mtk01_runStatus = InputStatus_PLC1.mtk01_runStatus;
                                Program.InputStatus_PLC1.mtk02_runStatus = InputStatus_PLC1.mtk02_runStatus;
                                Program.InputStatus_PLC1.mtk03_runStatus = InputStatus_PLC1.mtk03_runStatus;
                                Program.InputStatus_PLC1.dlAxit_runStatus = InputStatus_PLC1.dlAxit_runStatus;
                                Program.InputStatus_PLC1.dlXut_runStatus = InputStatus_PLC1.dlXut_runStatus;
                                Program.InputStatus_PLC1.dlNp_runStatus = InputStatus_PLC1.dlNp_runStatus;
                                Program.InputStatus_PLC1.dlClo_runStatus = InputStatus_PLC1.dlClo_runStatus;
                                Program.InputStatus_PLC1.dlPac_runStatus = InputStatus_PLC1.dlPac_runStatus;
                                Program.InputStatus_PLC1.dlPolyme1_runStatus = InputStatus_PLC1.dlPolyme1_runStatus;
                                Program.InputStatus_PLC1.dlPolyme2_runStatus = InputStatus_PLC1.dlPolyme2_runStatus;
                                Program.InputStatus_PLC1.khuayNp_runStatus = InputStatus_PLC1.khuayNp_runStatus;
                                Program.InputStatus_PLC1.khuayClo_runStatus = InputStatus_PLC1.khuayClo_runStatus;
                                Program.InputStatus_PLC1.khuayPac_runStatus = InputStatus_PLC1.khuayPac_runStatus;
                                Program.InputStatus_PLC1.khuayPolyme1_runStatus = InputStatus_PLC1.khuayPolyme1_runStatus;
                                Program.InputStatus_PLC1.khuayPolyme2_runStatus = InputStatus_PLC1.khuayPolyme2_runStatus;
                                Program.InputStatus_PLC1.khuayTaoBong1_runStatus = InputStatus_PLC1.khuayTaoBong1_runStatus;
                                Program.InputStatus_PLC1.khuayTaoBong2_runStatus = InputStatus_PLC1.dieuHoa1_runStatus;
                                Program.InputStatus_PLC1.motorGatBun_runStatus = InputStatus_PLC1.motorGatBun_runStatus;

                                // Trạng thái "TRIP" GD1
                                Program.InputStatus_PLC1.dieuHoa1_tripStatus = InputStatus_PLC1.dieuHoa1_tripStatus;
                                Program.InputStatus_PLC1.dieuHoa2_tripStatus = InputStatus_PLC1.dieuHoa2_tripStatus;
                                Program.InputStatus_PLC1.tuanHoanNuoc_tripStatus = InputStatus_PLC1.tuanHoanNuoc_tripStatus;
                                Program.InputStatus_PLC1.tuanHoanBun_tripStatus = InputStatus_PLC1.tuanHoanBun_tripStatus;
                                Program.InputStatus_PLC1.bunHoaLy1_tripStatus = InputStatus_PLC1.bunHoaLy1_tripStatus;
                                Program.InputStatus_PLC1.bunHoaLy2_tripStatus = InputStatus_PLC1.bunHoaLy2_tripStatus;
                                Program.InputStatus_PLC1.beGom1_tripStatus = InputStatus_PLC1.beGom1_tripStatus;
                                Program.InputStatus_PLC1.beGom2_tripStatus = InputStatus_PLC1.beGom2_tripStatus;
                                Program.InputStatus_PLC1.beGom3_tripStatus = InputStatus_PLC1.beGom3_tripStatus;
                                Program.InputStatus_PLC1.skbm1_tripStatus = InputStatus_PLC1.skbm1_tripStatus;
                                Program.InputStatus_PLC1.skbm2_tripStatus = InputStatus_PLC1.skbm2_tripStatus;
                                Program.InputStatus_PLC1.skbm3_tripStatus = InputStatus_PLC1.skbm3_tripStatus;
                                Program.InputStatus_PLC1.mtk01_tripStatus = InputStatus_PLC1.mtk01_tripStatus;
                                Program.InputStatus_PLC1.mtk02_tripStatus = InputStatus_PLC1.mtk02_tripStatus;
                                Program.InputStatus_PLC1.mtk03_tripStatus = InputStatus_PLC1.mtk03_tripStatus;
                                Program.InputStatus_PLC1.dlAxit_tripStatus = InputStatus_PLC1.dlAxit_tripStatus;
                                Program.InputStatus_PLC1.dlXut_tripStatus = InputStatus_PLC1.dlXut_tripStatus;
                                Program.InputStatus_PLC1.dlNp_tripStatus = InputStatus_PLC1.dlNp_tripStatus;
                                Program.InputStatus_PLC1.dlClo_tripStatus = InputStatus_PLC1.dlClo_tripStatus;
                                Program.InputStatus_PLC1.dlPac_tripStatus = InputStatus_PLC1.dlPac_tripStatus;
                                Program.InputStatus_PLC1.dlPolyme1_tripStatus = InputStatus_PLC1.dlPolyme1_tripStatus;
                                Program.InputStatus_PLC1.dlPolyme2_tripStatus = InputStatus_PLC1.dlPolyme2_tripStatus;
                                Program.InputStatus_PLC1.khuayNp_tripStatus = InputStatus_PLC1.khuayNp_tripStatus;
                                Program.InputStatus_PLC1.khuayClo_tripStatus = InputStatus_PLC1.khuayClo_tripStatus;
                                Program.InputStatus_PLC1.khuayPac_tripStatus = InputStatus_PLC1.khuayPac_tripStatus;
                                Program.InputStatus_PLC1.khuayPolyme1_tripStatus = InputStatus_PLC1.khuayPolyme1_tripStatus;
                                Program.InputStatus_PLC1.khuayPolyme2_tripStatus = InputStatus_PLC1.khuayPolyme2_tripStatus;
                                Program.InputStatus_PLC1.khuayTaoBong1_tripStatus = InputStatus_PLC1.khuayTaoBong1_tripStatus;
                                Program.InputStatus_PLC1.khuayTaoBong2_tripStatus = InputStatus_PLC1.dieuHoa1_tripStatus;
                                Program.InputStatus_PLC1.motorGatBun_tripStatus = InputStatus_PLC1.motorGatBun_tripStatus;

                                /// Thời gian chạy RUNTIME thực tế (GD1)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 
                                Program.Runtime_PLC1.dieuHoa1_runtime = Runtime_PLC1.dieuHoa1_runtime;
                                Program.Runtime_PLC1.dieuHoa2_runtime = Runtime_PLC1.dieuHoa2_runtime;
                                Program.Runtime_PLC1.tuanHoanNuoc_runtime = Runtime_PLC1.tuanHoanNuoc_runtime;
                                Program.Runtime_PLC1.tuanHoanBun_runtime = Runtime_PLC1.tuanHoanBun_runtime;
                                Program.Runtime_PLC1.bunHoaLy1_runtime = Runtime_PLC1.bunHoaLy1_runtime;
                                Program.Runtime_PLC1.bunHoaLy2_runtime = Runtime_PLC1.bunHoaLy2_runtime;
                                Program.Runtime_PLC1.beGom1_runtime = Runtime_PLC1.beGom1_runtime;
                                Program.Runtime_PLC1.beGom2_runtime = Runtime_PLC1.beGom2_runtime;
                                Program.Runtime_PLC1.beGom3_runtime = Runtime_PLC1.beGom3_runtime;
                                Program.Runtime_PLC1.skbm1_runtime = Runtime_PLC1.skbm1_runtime;
                                Program.Runtime_PLC1.skbm2_runtime = Runtime_PLC1.skbm2_runtime;
                                Program.Runtime_PLC1.skbm3_runtime = Runtime_PLC1.skbm3_runtime;
                                Program.Runtime_PLC1.mtk1_runtime = Runtime_PLC1.mtk1_runtime;
                                Program.Runtime_PLC1.mtk2_runtime = Runtime_PLC1.mtk2_runtime;
                                Program.Runtime_PLC1.mtk3_runtime = Runtime_PLC1.mtk3_runtime;
                                Program.Runtime_PLC1.dlAxit_runtime = Runtime_PLC1.dlAxit_runtime;
                                Program.Runtime_PLC1.dlXut_runtime = Runtime_PLC1.dlXut_runtime;
                                Program.Runtime_PLC1.dlNp_runtime = Runtime_PLC1.dlNp_runtime;
                                Program.Runtime_PLC1.dlClo_runtime = Runtime_PLC1.dlClo_runtime;
                                Program.Runtime_PLC1.dlPac_runtime = Runtime_PLC1.dlPac_runtime;
                                Program.Runtime_PLC1.dlPolyme_runtime = Runtime_PLC1.dlPolyme_runtime;
                                Program.Runtime_PLC1.khuayNp_runtime = Runtime_PLC1.khuayNp_runtime;
                                Program.Runtime_PLC1.khuayClo_runtime = Runtime_PLC1.khuayClo_runtime;
                                Program.Runtime_PLC1.khuayPac_runtime = Runtime_PLC1.khuayPac_runtime;
                                Program.Runtime_PLC1.khuayPolyme1_runtime = Runtime_PLC1.khuayPolyme1_runtime;
                                Program.Runtime_PLC1.khuayPolyme2_runtime = Runtime_PLC1.khuayPolyme2_runtime;


                                /// Thời gian cài đặt runtime thực tế (GD1)
                                /// Note: int (PLC) <=> KDL: short trong C#
                                /// 
                                Program.RuntimeSetting_PLC1.beGom1_setTime = RuntimeSetting_PLC1.beGom1_setTime;
                                Program.RuntimeSetting_PLC1.beGom2_setTime = RuntimeSetting_PLC1.beGom2_setTime;
                                Program.RuntimeSetting_PLC1.beGom3_setTime = RuntimeSetting_PLC1.beGom3_setTime;
                                Program.RuntimeSetting_PLC1.dieuHoa1_setTime = RuntimeSetting_PLC1.dieuHoa1_setTime;
                                Program.RuntimeSetting_PLC1.dieuHoa2_setTime = RuntimeSetting_PLC1.dieuHoa2_setTime;
                                Program.RuntimeSetting_PLC1.mtk01_setTime = RuntimeSetting_PLC1.mtk01_setTime;
                                Program.RuntimeSetting_PLC1.mtk02_setTime = RuntimeSetting_PLC1.mtk02_setTime;
                                Program.RuntimeSetting_PLC1.mtk03_setTime = RuntimeSetting_PLC1.mtk03_setTime;

                                #endregion

                                #region ZONE FOR DEBUG:----------------------------------------------
                                //FOR TESTING-------------------------------------------------------
                                Console.WriteLine("Read PLC_1 Success!");

                                //Console.WriteLine("BEGOM1: {0}",Program.RuntimeSetting_PLC1.beGom1_setTime);
                                //Console.WriteLine("MTK03: {0}",Program.RuntimeSetting_PLC1.mtk03_setTime);

                                //Console.WriteLine("P103: ");
                                //Console.WriteLine(Program.InputStatus_PLC1.beGom3_runStatus);
                                //Console.WriteLine(Program.InputStatus_PLC1.beGom3_tripStatus);

                                //Console.WriteLine("MTK02: ");
                                //Console.WriteLine(Program.InputStatus_PLC1.mtk02_runStatus);

                                //Console.WriteLine("COD Index: ");
                                //Console.WriteLine(Program.QuanTracIndex_PLC1.cod_Index);

                                //float a = Convert.ToSingle(plc.Read(DataType.DataBlock, 14, 40, VarType.Real, 1, 0));
                                //Console.WriteLine(a.ToString());

                                #endregion

                                plc.Close();
                            }

                        }
                        else
                        {
                            Console.WriteLine("PLC1 is not available");
                            return;
                        }
                    }

                    catch (Exception err)
                    {

                    }
                };

                Task task1 = new Task(myAction);
                task1.Start();

                await task1;
                plc.Close();

            }

        }

        // PLC: CPU1214C - Giai đoạn 1 cải tạo "GD1MR" IP = "192.168.0.2", Rack = 0, Slot = 1;
        public class PLC_GD1MR : PLC
        {
            InputStatus_DB63_PLC2 InputStatus_PLC2 = new InputStatus_DB63_PLC2();
            ResetRuntime_DB38_PLC2 ResetRuntime_PLC2 = new ResetRuntime_DB38_PLC2();
            Runtime_DB39_PLC2 Runtime_PLC2 = new Runtime_DB39_PLC2();
            RuntimeSetting_DB1_PLC2 RuntimeSetting_PLC2 = new RuntimeSetting_DB1_PLC2();

            public PLC_GD1MR() : base("S7_1200_GD1MR", CpuType.S71200, "192.168.0.2", 0, 1, 250)
            {

            }

            public async override void updateEventHandler(object sender, ElapsedEventArgs e)
            {
                Action myAction2 = () =>
                {
                    try
                    {
                        if (plc.IsAvailable)
                        {
                            this.plc_isAvailable = plc.IsAvailable;
                            this.plc_connectError = this.plc.Open();
                            this.plc_connected = plc.IsConnected;

                            if (plc.IsConnected)
                            {
                                #region READ DATA
                                // Read data to class: Mapping
                                plc.ReadClass(InputStatus_PLC2, 63, 0);
                                plc.ReadClass(ResetRuntime_PLC2, 38, 0);
                                plc.ReadClass(Runtime_PLC2, 39, 0);
                                plc.ReadClass(RuntimeSetting_PLC2, 1, 0);
                                #endregion

                                #region SAVE DATA
                                //Trạng thái "RUN" giai đoạn 1 cải tạo "GD1MR"
                                Program.InputStatus_PLC2.anoxic1_runStatus = InputStatus_PLC2.anoxic1_runStatus;
                                Program.InputStatus_PLC2.anoxic2_runStatus = InputStatus_PLC2.anoxic2_runStatus;
                                Program.InputStatus_PLC2.anoxic3_runStatus = InputStatus_PLC2.anoxic3_runStatus;
                                Program.InputStatus_PLC2.anoxic4_runStatus = InputStatus_PLC2.anoxic4_runStatus;
                                Program.InputStatus_PLC2.anoxic5_runStatus = InputStatus_PLC2.anoxic5_runStatus;
                                Program.InputStatus_PLC2.anoxic6_runStatus = InputStatus_PLC2.anoxic6_runStatus;
                                Program.InputStatus_PLC2.anoxic7_runStatus = InputStatus_PLC2.anoxic7_runStatus;
                                Program.InputStatus_PLC2.anoxic8_runStatus = InputStatus_PLC2.anoxic8_runStatus;
                                Program.InputStatus_PLC2.etanol1_runStatus = InputStatus_PLC2.anoxic6_runStatus;
                                Program.InputStatus_PLC2.etanol2_runStatus = InputStatus_PLC2.anoxic6_runStatus;
                                Program.InputStatus_PLC2.metanol_runStatus = InputStatus_PLC2.anoxic6_runStatus;
                                Program.InputStatus_PLC2.mkt01_runStatus = InputStatus_PLC2.mkt01_runStatus;
                                Program.InputStatus_PLC2.mkt02_runStatus = InputStatus_PLC2.mkt02_runStatus;
                                Program.InputStatus_PLC2.mkt03_runStatus = InputStatus_PLC2.mkt03_runStatus;
                                Program.InputStatus_PLC2.tuanHoan1_runStatus = InputStatus_PLC2.tuanHoan1_runStatus;
                                Program.InputStatus_PLC2.tuanHoan2_runStatus = InputStatus_PLC2.tuanHoan2_runStatus;
                                Program.InputStatus_PLC2.tuanHoan3_runStatus = InputStatus_PLC2.tuanHoan3_runStatus;
                                Program.InputStatus_PLC2.gatBun_runStatus = InputStatus_PLC2.gatBun_runStatus;
                                Program.InputStatus_PLC2.bomBun1_runStatus = InputStatus_PLC2.bomBun1_runStatus;
                                Program.InputStatus_PLC2.bomBun2_runStatus = InputStatus_PLC2.bomBun2_runStatus;
                                Program.InputStatus_PLC2.khuayNaoh_runStatus = InputStatus_PLC2.khuayNaoh_runStatus;
                                Program.InputStatus_PLC2.dlNaoh_runStatus = InputStatus_PLC2.dlNaoh_runStatus;
                                Program.InputStatus_PLC2.al2so4_1_runStatus = InputStatus_PLC2.al2so4_1_runStatus;
                                Program.InputStatus_PLC2.al2so4_2_runStatus = InputStatus_PLC2.al2so4_2_runStatus;

                                // Trạng thái "TRIP" giai đoạn 1 cải tạo "GD1MR"
                                Program.InputStatus_PLC2.anoxic1_tripStatus = InputStatus_PLC2.anoxic1_tripStatus;
                                Program.InputStatus_PLC2.anoxic2_tripStatus = InputStatus_PLC2.anoxic2_tripStatus;
                                Program.InputStatus_PLC2.anoxic3_tripStatus = InputStatus_PLC2.anoxic3_tripStatus;
                                Program.InputStatus_PLC2.anoxic4_tripStatus = InputStatus_PLC2.anoxic4_tripStatus;
                                Program.InputStatus_PLC2.anoxic5_tripStatus = InputStatus_PLC2.anoxic5_tripStatus;
                                Program.InputStatus_PLC2.anoxic6_tripStatus = InputStatus_PLC2.anoxic6_tripStatus;
                                Program.InputStatus_PLC2.anoxic7_tripStatus = InputStatus_PLC2.anoxic7_tripStatus;
                                Program.InputStatus_PLC2.anoxic8_tripStatus = InputStatus_PLC2.anoxic8_tripStatus;
                                Program.InputStatus_PLC2.etanol1_tripStatus = InputStatus_PLC2.etanol1_tripStatus;
                                Program.InputStatus_PLC2.etanol2_tripStatus = InputStatus_PLC2.etanol2_tripStatus;
                                Program.InputStatus_PLC2.metanol_tripStatus = InputStatus_PLC2.metanol_tripStatus;
                                Program.InputStatus_PLC2.mkt01_tripStatus = InputStatus_PLC2.mkt01_tripStatus;
                                Program.InputStatus_PLC2.mkt02_tripStatus = InputStatus_PLC2.mkt02_tripStatus;
                                Program.InputStatus_PLC2.mkt03_tripStatus = InputStatus_PLC2.mkt03_tripStatus;
                                Program.InputStatus_PLC2.tuanHoan1_tripStatus = InputStatus_PLC2.tuanHoan1_tripStatus;
                                Program.InputStatus_PLC2.tuanHoan2_tripStatus = InputStatus_PLC2.tuanHoan2_tripStatus;
                                Program.InputStatus_PLC2.tuanHoan3_tripStatus = InputStatus_PLC2.tuanHoan3_tripStatus;
                                Program.InputStatus_PLC2.gatBun_tripStatus = InputStatus_PLC2.gatBun_tripStatus;
                                Program.InputStatus_PLC2.bomBun1_tripStatus = InputStatus_PLC2.bomBun1_tripStatus;
                                Program.InputStatus_PLC2.bomBun2_tripStatus = InputStatus_PLC2.bomBun2_tripStatus;
                                Program.InputStatus_PLC2.khuayNaoh_tripStatus = InputStatus_PLC2.khuayNaoh_tripStatus;
                                Program.InputStatus_PLC2.dlNaoh_tripStatus = InputStatus_PLC2.dlNaoh_tripStatus;
                                Program.InputStatus_PLC2.al2so4_1_tripStatus = InputStatus_PLC2.al2so4_1_tripStatus;
                                Program.InputStatus_PLC2.al2so4_2_tripStatus = InputStatus_PLC2.al2so4_2_tripStatus;

                                /// Thời gian chạy RUNTIME thực tế (GD1MR)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 
                                Program.Runtime_PLC2.anoxic1_runtime = Runtime_PLC2.anoxic1_runtime;
                                Program.Runtime_PLC2.anoxic2_runtime = Runtime_PLC2.anoxic2_runtime;
                                Program.Runtime_PLC2.anoxic3_runtime = Runtime_PLC2.anoxic3_runtime;
                                Program.Runtime_PLC2.anoxic4_runtime = Runtime_PLC2.anoxic4_runtime;
                                Program.Runtime_PLC2.anoxic5_runtime = Runtime_PLC2.anoxic5_runtime;
                                Program.Runtime_PLC2.anoxic6_runtime = Runtime_PLC2.anoxic6_runtime;
                                Program.Runtime_PLC2.anoxic7_runtime = Runtime_PLC2.anoxic7_runtime;
                                Program.Runtime_PLC2.anoxic8_runtime = Runtime_PLC2.anoxic8_runtime;
                                Program.Runtime_PLC2.etanol1_runtime = Runtime_PLC2.etanol1_runtime;
                                Program.Runtime_PLC2.etanol2_runtime = Runtime_PLC2.etanol2_runtime;
                                Program.Runtime_PLC2.metanol_runtime = Runtime_PLC2.metanol_runtime;
                                Program.Runtime_PLC2.mkt01_runtime = Runtime_PLC2.mkt01_runtime;
                                Program.Runtime_PLC2.mkt02_runtime = Runtime_PLC2.mkt02_runtime;
                                Program.Runtime_PLC2.mkt03_runtime = Runtime_PLC2.mkt03_runtime;
                                Program.Runtime_PLC2.tuanHoan1_runtime = Runtime_PLC2.tuanHoan1_runtime;
                                Program.Runtime_PLC2.tuanHoan2_runtime = Runtime_PLC2.tuanHoan2_runtime;
                                Program.Runtime_PLC2.tuanHoan3_runtime = Runtime_PLC2.tuanHoan3_runtime;
                                Program.Runtime_PLC2.gatBun_runtime = Runtime_PLC2.gatBun_runtime;
                                Program.Runtime_PLC2.bomBun1_runtime = Runtime_PLC2.bomBun1_runtime;
                                Program.Runtime_PLC2.bomBun2_runtime = Runtime_PLC2.bomBun2_runtime;
                                Program.Runtime_PLC2.khuayNaoh_runtime = Runtime_PLC2.khuayNaoh_runtime;
                                Program.Runtime_PLC2.dlNaoh_runtime = Runtime_PLC2.dlNaoh_runtime;
                                Program.Runtime_PLC2.al2so4_1_runtime = Runtime_PLC2.al2so4_1_runtime;
                                Program.Runtime_PLC2.al2so4_2_runtime = Runtime_PLC2.al2so4_2_runtime;

                                /// Thời gian cài đặt runtime thực tế (GD1MR)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                ///
                                Program.RuntimeSetting_PLC2.anoxic1_setTime = RuntimeSetting_PLC2.anoxic1_setTime;
                                Program.RuntimeSetting_PLC2.anoxic2_setTime = RuntimeSetting_PLC2.anoxic2_setTime;
                                Program.RuntimeSetting_PLC2.anoxic3_setTime = RuntimeSetting_PLC2.anoxic3_setTime;
                                Program.RuntimeSetting_PLC2.anoxic4_setTime = RuntimeSetting_PLC2.anoxic4_setTime;
                                Program.RuntimeSetting_PLC2.anoxic5_setTime = RuntimeSetting_PLC2.anoxic5_setTime;
                                Program.RuntimeSetting_PLC2.anoxic6_setTime = RuntimeSetting_PLC2.anoxic6_setTime;
                                Program.RuntimeSetting_PLC2.anoxic7_setTime = RuntimeSetting_PLC2.anoxic7_setTime;
                                Program.RuntimeSetting_PLC2.anoxic8_setTime = RuntimeSetting_PLC2.anoxic8_setTime;
                                Program.RuntimeSetting_PLC2.metanol_setTime_on = RuntimeSetting_PLC2.anoxic6_setTime;
                                Program.RuntimeSetting_PLC2.metanol_setTime_off = RuntimeSetting_PLC2.anoxic6_setTime;
                                Program.RuntimeSetting_PLC2.mkt01_setTime = RuntimeSetting_PLC2.mkt01_setTime;
                                Program.RuntimeSetting_PLC2.mkt02_setTime = RuntimeSetting_PLC2.mkt02_setTime;
                                Program.RuntimeSetting_PLC2.mkt03_setTime = RuntimeSetting_PLC2.mkt03_setTime;
                                Program.RuntimeSetting_PLC2.tuanHoan1_setTime = RuntimeSetting_PLC2.tuanHoan1_setTime;
                                Program.RuntimeSetting_PLC2.tuanHoan2_setTime = RuntimeSetting_PLC2.tuanHoan2_setTime;
                                Program.RuntimeSetting_PLC2.tuanHoan3_setTime = RuntimeSetting_PLC2.tuanHoan3_setTime;
                                Program.RuntimeSetting_PLC2.gatBun_setTime_on = RuntimeSetting_PLC2.gatBun_setTime_on;
                                Program.RuntimeSetting_PLC2.gatBun_setTime_off = RuntimeSetting_PLC2.gatBun_setTime_off;
                                Program.RuntimeSetting_PLC2.bomBun_setTime_on = RuntimeSetting_PLC2.bomBun_setTime_on;
                                Program.RuntimeSetting_PLC2.bomBun_setTime_off = RuntimeSetting_PLC2.bomBun_setTime_off;
                                Program.RuntimeSetting_PLC2.khuayNaoh_setTime_on = RuntimeSetting_PLC2.khuayNaoh_setTime_on;
                                Program.RuntimeSetting_PLC2.khuayNaoh_setTime_off = RuntimeSetting_PLC2.khuayNaoh_setTime_off;
                                //Program.RuntimeSetting_PLC2.dlNaoh_setTime = RuntimeSetting_PLC2.dlNaoh_setTime;
                                //Program.RuntimeSetting_PLC2.al2so4_1_setTime = RuntimeSetting_PLC2.al2so4_1_setTime;
                                //Program.RuntimeSetting_PLC2.al2so4_2_setTime = RuntimeSetting_PLC2.al2so4_2_setTime;

                                //Tín hiệu "Auto/ Man" Máy thổi khí 1, 2 và 3
                                Program.InputStatus_PLC2.mtk1_manMode = InputStatus_PLC2.mtk1_manMode; // Tín hiệu "Manual" mode máy thổi khí 1
                                Program.InputStatus_PLC2.mtk1_autoMode = InputStatus_PLC2.mtk1_autoMode; // Tín hiệu "Auto" máy thổi khí 1
                                Program.InputStatus_PLC2.mtk2_manMode = InputStatus_PLC2.mtk2_manMode; // Tín hiệu "Manual" máy thổi khí 2
                                Program.InputStatus_PLC2.mtk2_autoMode = InputStatus_PLC2.mtk2_autoMode; // Tín hiệu "Auto" máy thổi khí 2
                                Program.InputStatus_PLC2.mtk3_manMode = InputStatus_PLC2.mtk3_manMode; // Tín hiệu "Manual" máy thổi khí 3
                                Program.InputStatus_PLC2.mtk3_autoMode = InputStatus_PLC2.mtk3_autoMode; // Tín hiệu "Auto" máy thổi khí 3

                                ///------------------------------------------------------------------------------------------------------------------------
                                #endregion

                                #region OLD VERSION
                                ////Trạng thái "RUN" giai đoạn 1 cải tạo "GD1MR"
                                //Input.anoxic1_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất Anoxic 1 "M17.0"
                                //Input.anoxic2_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất Anoxic 2 "M17.1"
                                //Input.anoxic3_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất Anoxic 3 "M17.2"
                                //Input.anoxic4_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất Anoxic 4 "M17.3"
                                //Input.anoxic5_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm hóa chất Anoxic 5 "M17.4"
                                //Input.anoxic6_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm hóa chất Anoxic 6 "M17.5"
                                //Input.anoxic7_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm hóa chất Anoxic 7 "M17.6"
                                //Input.anoxic8_runStatus = (bool)plc.Read(DataType.Memory, 0, 17, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm hóa chất Anoxic 8 "M17.7"
                                //Input.etanol1_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 0);  // Trạng thái "RUN" bơm hóa chất Etanol 1 "M18.0"
                                //Input.etanol2_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm hóa chất Etanol 2 "M18.5"
                                //Input.metanol_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất Metanol "M18.1"
                                //Input.mkt01_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 2); // Trạng thái "RUN" máy thổi khí MKT1 "M18.2"
                                //Input.mkt02_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 4); // Trạng thái "RUN" máy thổi khí MTK2 "M18.4"
                                //Input.mkt03_runStatus = (bool)plc.Read(DataType.Memory, 0, 18, VarType.Bit, 1, 6); // Trạng thái "RUN" máy thổi khí MTK3 "M18.6"
                                //Input.tuanHoan1_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm tuần hoàn 1 "M19.0"
                                //Input.tuanHoan2_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm tuần hoàn 2 "M19.1"
                                //Input.tuanHoan3_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm tuần hoàn 3 "M19.2"
                                //Input.gatBun_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 3); // Trạng thái "RUN" gạt bùn "M19.3"
                                //Input.bomBun1_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm bùn 1 "M19.4"
                                //Input.bomBun2_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm bùn 2 "M19.7"
                                //Input.khuayNaoh_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 5); // Trạng thái "RUN" khuấy NaoH "M19.5"
                                //Input.dlNaoh_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 6); // Trạng thái "RUN" định lượng NaoH "M19.6"                                                            // "
                                //Input.al2so4_runStatus = (bool)plc.Read(DataType.Memory, 0, 19, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất AL2SO4 "M18.3"

                                //// Trạng thái "TRIP" giai đoạn 1 cải tạo "GD1MR"
                                //Input.anoxic1_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất Anoxic 1 "I0.0"
                                //Input.anoxic1_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất Anoxic 1 "I0.0"
                                //Input.anoxic2_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất Anoxic 2 "I0.1"
                                //Input.anoxic3_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất Anoxic 3 "I0.2"
                                //Input.anoxic4_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất Anoxic 4 "I0.3"
                                //Input.anoxic5_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm hóa chất Anoxic 5 "I0.4"
                                //Input.anoxic6_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm hóa chất Anoxic 6 "I0.5"
                                //Input.anoxic7_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm hóa chất Anoxic 7 "I0.6"
                                //Input.anoxic8_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm hóa chất Anoxic 8 "I0.7"
                                //Input.etanol1_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 0);  // Trạng thái "RUN" bơm hóa chất Etanol 1 "I1.0"
                                //Input.etanol2_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất Etanol 2 "I1.1"
                                //Input.metanol_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất Metanol "I1.2"
                                //Input.mkt01_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 3); // Trạng thái "RUN" máy thổi khí MKT1 "I1.3"
                                //Input.mkt02_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 4); // Trạng thái "RUN" máy thổi khí MTK2 "I1.4"
                                //Input.mkt03_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 5); // Trạng thái "RUN" máy thổi khí MTK3 "I1.5"
                                //Input.tuanHoan1_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm tuần hoàn 1 "I2.0"
                                //Input.tuanHoan2_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm tuần hoàn 2 "I2.1"
                                //Input.tuanHoan3_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm tuần hoàn 3 "I2.2"
                                //Input.gatBun_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 3); // Trạng thái "RUN" gạt bùn "I2.3"
                                //Input.bomBun1_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm bùn 1 "I2.4"
                                //Input.bomBun2_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm bùn 2 "I2.5"
                                //Input.khuayNaoh_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 6); // Trạng thái "RUN" khuấy NaoH "I2.6"
                                //Input.dlNaoh_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 7); // Trạng thái "RUN" định lượng NaoH "I2.7"                                                            // "
                                //Input.al2so4_1_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất AL2SO4 "I3.0"
                                //Input.al2so4_2_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất AL2SO4 "I3.1"


                                /// Thời gian chạy RUNTIME thực tế (GD1MR)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 

                                //Parameter.anoxic1_runtime = (int)plc.Read(DataType.DataBlock, 39, 0, VarType.DInt, 1);
                                //Parameter.anoxic2_runtime = (int)plc.Read(DataType.DataBlock, 39, 4, VarType.DInt, 1);
                                //Parameter.anoxic3_runtime = (int)plc.Read(DataType.DataBlock, 39, 8, VarType.DInt, 1);
                                //Parameter.anoxic4_runtime = (int)plc.Read(DataType.DataBlock, 39, 12, VarType.DInt, 1);
                                //Parameter.anoxic5_runtime = (int)plc.Read(DataType.DataBlock, 39, 16, VarType.DInt, 1);
                                //Parameter.anoxic6_runtime = (int)plc.Read(DataType.DataBlock, 39, 20, VarType.DInt, 1);
                                //Parameter.anoxic7_runtime = (int)plc.Read(DataType.DataBlock, 39, 24, VarType.DInt, 1);
                                //Parameter.anoxic8_runtime = (int)plc.Read(DataType.DataBlock, 39, 28, VarType.DInt, 1);
                                //Parameter.etanol1_runtime = (int)plc.Read(DataType.DataBlock, 39, 32, VarType.DInt, 1);
                                //Parameter.metanol_runtime = (int)plc.Read(DataType.DataBlock, 39, 36, VarType.DInt, 1);
                                //Parameter.mtk_1_runtime = (int)plc.Read(DataType.DataBlock, 39, 40, VarType.DInt, 1);
                                //Parameter.mtk_2_runtime = (int)plc.Read(DataType.DataBlock, 39, 44, VarType.DInt, 1);
                                //Parameter.mtk_3_runtime = (int)plc.Read(DataType.DataBlock, 39, 48, VarType.DInt, 1);
                                //Parameter.tuanHoan1_runtime = (int)plc.Read(DataType.DataBlock, 39, 52, VarType.DInt, 1);
                                //Parameter.tuanHoan2_runtime = (int)plc.Read(DataType.DataBlock, 39, 56, VarType.DInt, 1);
                                //Parameter.tuanHoan3_runtime = (int)plc.Read(DataType.DataBlock, 39, 60, VarType.DInt, 1);
                                //Parameter.gatBun_runtime = (int)plc.Read(DataType.DataBlock, 39, 64, VarType.DInt, 1);
                                //Parameter.bomBun1_runtime = (int)plc.Read(DataType.DataBlock, 39, 68, VarType.DInt, 1);
                                //Parameter.bomBun2_runtime = (int)plc.Read(DataType.DataBlock, 39, 72, VarType.DInt, 1);
                                //Parameter.khuayNaoh_runtime = (int)plc.Read(DataType.DataBlock, 39, 76, VarType.DInt, 1);
                                //Parameter.dlNaoh_runtime = (int)plc.Read(DataType.DataBlock, 39, 80, VarType.DInt, 1);
                                //Parameter.al2so4_1_runtime = (int)plc.Read(DataType.DataBlock, 39, 84, VarType.DInt, 1);
                                //Parameter.al2so4_2_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);

                                /// Thời gian cài đặt runtime thực tế (GD1MR)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 
                                //Parameter.anoxic1_setTime = (short)plc.Read(DataType.DataBlock, 1, 0, VarType.Int, 1);
                                //Parameter.anoxic2_setTime = (short)plc.Read(DataType.DataBlock, 1, 2, VarType.Int, 1);
                                //Parameter.anoxic3_setTime = (short)plc.Read(DataType.DataBlock, 1, 4, VarType.Int, 1);
                                //Parameter.anoxic4_setTime = (short)plc.Read(DataType.DataBlock, 1, 6, VarType.Int, 1);
                                //Parameter.anoxic5_setTime = (short)plc.Read(DataType.DataBlock, 1, 8, VarType.Int, 1);
                                //Parameter.anoxic6_setTime = (short)plc.Read(DataType.DataBlock, 1, 10, VarType.Int, 1);
                                //Parameter.anoxic7_setTime = (short)plc.Read(DataType.DataBlock, 1, 12, VarType.Int, 1);
                                //Parameter.anoxic8_setTime = (short)plc.Read(DataType.DataBlock, 1, 14, VarType.Int, 1);
                                //Parameter.metanol_setTime_on = (short)plc.Read(DataType.DataBlock, 1, 16, VarType.Int, 1);
                                //Parameter.metanol_setTime_off = (short)plc.Read(DataType.DataBlock, 1, 18, VarType.Int, 1);
                                //Parameter.tuanHoan1_setTime = (short)plc.Read(DataType.DataBlock, 1, 20, VarType.Int, 1);
                                //Parameter.tuanHoan2_setTime = (short)plc.Read(DataType.DataBlock, 1, 22, VarType.Int, 1);
                                //Parameter.tuanHoan3_setTime = (short)plc.Read(DataType.DataBlock, 1, 24, VarType.Int, 1);
                                //Parameter.gatBun_setTime_on = (short)plc.Read(DataType.DataBlock, 1, 26, VarType.Int, 1);
                                //Parameter.gatBun_setTime_off = (short)plc.Read(DataType.DataBlock, 1, 28, VarType.Int, 1);
                                //Parameter.bomBun_setTime_on = (short)plc.Read(DataType.DataBlock, 1, 30, VarType.Int, 1);
                                //Parameter.bomBun_setTime_off = (short)plc.Read(DataType.DataBlock, 1, 32, VarType.Int, 1);
                                //Parameter.khuayNaoh_setTime_on = (short)plc.Read(DataType.DataBlock, 1, 34, VarType.Int, 1);
                                //Parameter.khuayNaoh_setTime_off = (short)plc.Read(DataType.DataBlock, 1, 36, VarType.Int, 1);
                                //Parameter.mkt1_setTime = (short)plc.Read(DataType.DataBlock, 1, 38, VarType.Int, 1);
                                //Parameter.mkt2_setTime = (short)plc.Read(DataType.DataBlock, 1, 40, VarType.Int, 1);
                                //Parameter.mkt3_setTime = (short)plc.Read(DataType.DataBlock, 1, 42, VarType.Int, 1);
                                #endregion

                                #region ZONE FOR DEBUGGING
                                Console.WriteLine("Read PLC_2 Success!");
                                #endregion

                                this.plc.Close();
                            }

                        }
                        else
                        {
                            Console.WriteLine("PLC2 is not available");
                            return;
                        }
                    }

                    catch (Exception err)
                    {
                        this.plc_error = err.Message;
                    }
                };

                Task task2 = new Task(myAction2);
                task2.Start();

                await task2;
                plc.Close();
            }

        }

        // PLC: CPU1214C - Giai đoạn 2 cải tạo "GD2" IP = "192.168.0.11", Rack = 0, Slot = 1;
        public class PLC_GD2 : PLC
        {
            InputStatus_DB55_PLC3 InputStatus_PLC3 = new InputStatus_DB55_PLC3();
            ResetRuntime_DB25_PLC3 ResetRuntime_PLC3 = new ResetRuntime_DB25_PLC3();
            Runtime_DB24_PLC3 Runtime_PLC3 = new Runtime_DB24_PLC3();
            RuntimeSetting_DB19_PLC3 RuntimeSetting_PLC3 = new RuntimeSetting_DB19_PLC3();

            public PLC_GD2() : base("S7_1200_GD2", CpuType.S71200, "192.168.0.11", 0, 1, 250)
            {
                // Do nothing!
            }

            public async override void updateEventHandler(object sender, ElapsedEventArgs e)
            {
                Action myAction3 = () =>
                {
                    try
                    {
                        if (plc.IsAvailable)
                        {
                            this.plc_isAvailable = plc.IsAvailable;
                            this.plc_connectError = this.plc.Open();
                            this.plc_connected = plc.IsConnected;

                            if (plc.IsConnected)
                            {
                                #region READ DATA
                                // Read data to class: Mapping
                                plc.ReadClass(InputStatus_PLC3, 55, 0);
                                plc.ReadClass(ResetRuntime_PLC3, 25, 0);
                                plc.ReadClass(Runtime_PLC3, 24, 0);
                                plc.ReadClass(RuntimeSetting_PLC3, 19, 0);
                                #endregion

                                #region SAVE DATA
                                // Tín hiệu phao bể điều hòa
                                Program.InputStatus_PLC3.low_dieuHoa_float = InputStatus_PLC3.low_dieuHoa_float; // Tín hiệu phao mức thấp 
                                Program.InputStatus_PLC3.high_dieuHoa_float = InputStatus_PLC3.high_dieuHoa_float; // Tín hiệu phao mức cao
                                Program.InputStatus_PLC3.float_beBun05_float = InputStatus_PLC3.float_beBun05_float; // Tín hiệu phao bể bùn 05
                                Program.InputStatus_PLC3.float_beBun07_float = InputStatus_PLC3.float_beBun07_float; // Tín hiệu phao bể bùn 07
                                Program.InputStatus_PLC3.float_beBunSP10_float = InputStatus_PLC3.float_beBunSP10_float; // Tín hiệu phao bể bùn SP10

                                //// Trạng thái "RUN" GD2
                                Program.InputStatus_PLC3.dlPolyme_04A_runStatus = InputStatus_PLC3.dlPolyme_04A_runStatus;
                                Program.InputStatus_PLC3.dlPolyme_04B_runStatus = InputStatus_PLC3.dlPolyme_04B_runStatus;
                                Program.InputStatus_PLC3.mayTachRac_runStatus = InputStatus_PLC3.mayTachRac_runStatus;
                                Program.InputStatus_PLC3.bomNt_02A_runStatus = InputStatus_PLC3.bomNt_02A_runStatus;
                                Program.InputStatus_PLC3.bomNt_02B_runStatus = InputStatus_PLC3.bomNt_02B_runStatus;
                                Program.InputStatus_PLC3.mtk_AB06A_runStatus = InputStatus_PLC3.mtk_AB06A_runStatus;
                                Program.InputStatus_PLC3.mtk_AB06B_runStatus = InputStatus_PLC3.mtk_AB06B_runStatus;
                                Program.InputStatus_PLC3.mtk_AB06C_runStatus = InputStatus_PLC3.mtk_AB06C_runStatus;
                                Program.InputStatus_PLC3.khuayKeoTu_GD2_runStatus = InputStatus_PLC3.khuayKeoTu_GD2_runStatus;
                                Program.InputStatus_PLC3.khuayTaoBong_A_runStatus = InputStatus_PLC3.khuayTaoBong_A_runStatus;
                                Program.InputStatus_PLC3.khuayTaoBong_B_runStatus = InputStatus_PLC3.khuayTaoBong_B_runStatus;
                                Program.InputStatus_PLC3.gbbl05_runStatus = InputStatus_PLC3.gbbl05_runStatus;
                                Program.InputStatus_PLC3.gbbl07_runStatus = InputStatus_PLC3.gbbl07_runStatus;
                                Program.InputStatus_PLC3.gbbl09_runStatus = InputStatus_PLC3.gbbl09_runStatus;
                                Program.InputStatus_PLC3.khuayPac_GD2_runStatus = InputStatus_PLC3.khuayPac_GD2_runStatus;
                                Program.InputStatus_PLC3.khuayPoly_GD2_runStatus = InputStatus_PLC3.khuayPoly_GD2_runStatus;
                                Program.InputStatus_PLC3.bomBun_05A_runStatus = InputStatus_PLC3.bomBun_05A_runStatus;
                                Program.InputStatus_PLC3.bomBun_05B_runStatus = InputStatus_PLC3.bomBun_05B_runStatus;
                                Program.InputStatus_PLC3.bomBun_07A_runStatus = InputStatus_PLC3.bomBun_07A_runStatus;
                                Program.InputStatus_PLC3.bomBun_07B_runStatus = InputStatus_PLC3.bomBun_07B_runStatus;
                                Program.InputStatus_PLC3.bomBun_SP10_runStatus = InputStatus_PLC3.bomBun_SP10_runStatus;
                                Program.InputStatus_PLC3.dlPhen_03A_runStatus = InputStatus_PLC3.dlPhen_03A_runStatus;
                                Program.InputStatus_PLC3.dlPhen_03B_runStatus = InputStatus_PLC3.dlPhen_03B_runStatus;
                                Program.InputStatus_PLC3.dlXut_05A_runStatus = InputStatus_PLC3.dlXut_05A_runStatus;
                                Program.InputStatus_PLC3.dlXut_05B_runStatus = InputStatus_PLC3.dlXut_05B_runStatus;
                                Program.InputStatus_PLC3.dlDd_06A_runStatus = InputStatus_PLC3.dlDd_06A_runStatus;
                                Program.InputStatus_PLC3.dlDd_06B_runStatus = InputStatus_PLC3.dlDd_06B_runStatus;
                                Program.InputStatus_PLC3.dlKhuTrung_07A_runStatus = InputStatus_PLC3.dlKhuTrung_07A_runStatus;
                                Program.InputStatus_PLC3.dlKhuTrung_07B_runStatus = InputStatus_PLC3.dlKhuTrung_07B_runStatus;

                                // Trạng thái "TRIP" GD2
                                Program.InputStatus_PLC3.dlPolyme_04A_tripStatus = InputStatus_PLC3.dlPolyme_04A_tripStatus;
                                Program.InputStatus_PLC3.dlPolyme_04B_tripStatus = InputStatus_PLC3.dlPolyme_04B_tripStatus;
                                Program.InputStatus_PLC3.mayTachRac_tripStatus = InputStatus_PLC3.mayTachRac_tripStatus;
                                Program.InputStatus_PLC3.bomNt_02A_tripStatus = InputStatus_PLC3.bomNt_02A_tripStatus;
                                Program.InputStatus_PLC3.bomNt_02B_tripStatus = InputStatus_PLC3.bomNt_02B_tripStatus;
                                Program.InputStatus_PLC3.mtk_AB06A_tripStatus = InputStatus_PLC3.mtk_AB06A_tripStatus;
                                Program.InputStatus_PLC3.mtk_AB06B_tripStatus = InputStatus_PLC3.mtk_AB06B_tripStatus;
                                Program.InputStatus_PLC3.mtk_AB06C_tripStatus = InputStatus_PLC3.mtk_AB06C_tripStatus;
                                Program.InputStatus_PLC3.khuayKeoTu_GD2_tripStatus = InputStatus_PLC3.khuayKeoTu_GD2_tripStatus;
                                Program.InputStatus_PLC3.khuayTaoBong_A_tripStatus = InputStatus_PLC3.khuayTaoBong_A_tripStatus;
                                Program.InputStatus_PLC3.khuayTaoBong_B_tripStatus = InputStatus_PLC3.khuayTaoBong_B_tripStatus;
                                Program.InputStatus_PLC3.gbbl05_tripStatus = InputStatus_PLC3.gbbl05_tripStatus;
                                Program.InputStatus_PLC3.gbbl07_tripStatus = InputStatus_PLC3.gbbl07_tripStatus;
                                Program.InputStatus_PLC3.gbbl09_tripStatus = InputStatus_PLC3.gbbl09_tripStatus;
                                Program.InputStatus_PLC3.khuayPac_GD2_tripStatus = InputStatus_PLC3.khuayPac_GD2_tripStatus;
                                Program.InputStatus_PLC3.khuayPoly_GD2_tripStatus = InputStatus_PLC3.khuayPoly_GD2_tripStatus;
                                Program.InputStatus_PLC3.bomBun_05A_tripStatus = InputStatus_PLC3.bomBun_05A_tripStatus;
                                Program.InputStatus_PLC3.bomBun_05B_tripStatus = InputStatus_PLC3.bomBun_05B_tripStatus;
                                Program.InputStatus_PLC3.bomBun_07A_tripStatus = InputStatus_PLC3.bomBun_07A_tripStatus;
                                Program.InputStatus_PLC3.bomBun_07B_tripStatus = InputStatus_PLC3.bomBun_07B_tripStatus;
                                Program.InputStatus_PLC3.bomBun_SP10_tripStatus = InputStatus_PLC3.bomBun_SP10_tripStatus;
                                Program.InputStatus_PLC3.dlPhen_03A_tripStatus = InputStatus_PLC3.dlPhen_03A_tripStatus;
                                Program.InputStatus_PLC3.dlPhen_03B_tripStatus = InputStatus_PLC3.dlPhen_03B_tripStatus;
                                Program.InputStatus_PLC3.dlXut_05A_tripStatus = InputStatus_PLC3.dlXut_05A_tripStatus;
                                Program.InputStatus_PLC3.dlXut_05B_tripStatus = InputStatus_PLC3.dlXut_05B_tripStatus;
                                Program.InputStatus_PLC3.dlDd_06A_tripStatus = InputStatus_PLC3.dlDd_06A_tripStatus;
                                Program.InputStatus_PLC3.dlDd_06B_tripStatus = InputStatus_PLC3.dlDd_06B_tripStatus;
                                Program.InputStatus_PLC3.dlKhuTrung_07A_tripStatus = InputStatus_PLC3.dlKhuTrung_07A_tripStatus;
                                Program.InputStatus_PLC3.dlKhuTrung_07B_tripStatus = InputStatus_PLC3.dlKhuTrung_07B_tripStatus;

                                // Gía trị quan trắc NT đầu vào
                                Program.InputStatus_PLC3.ph_sensor_in = InputStatus_PLC3.ph_sensor_in;
                                Program.InputStatus_PLC3.do_sensor_in = InputStatus_PLC3.do_sensor_in;
                                Program.InputStatus_PLC3.ph_value_in = InputStatus_PLC3.ph_value_in;

                                /// Thời gian chạy RUNTIME thực tế (GD2)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 

                                Program.Runtime_PLC3.mayTachRac_runtime = Runtime_PLC3.mayTachRac_runtime;
                                Program.Runtime_PLC3.bomNt_02A_runtime = Runtime_PLC3.bomNt_02A_runtime;
                                Program.Runtime_PLC3.bomNt_02B_runtime = Runtime_PLC3.bomNt_02B_runtime;
                                Program.Runtime_PLC3.mtk_AB06A_runtime = Runtime_PLC3.mtk_AB06A_runtime;
                                Program.Runtime_PLC3.mtk_AB06B_runtime = Runtime_PLC3.mtk_AB06B_runtime;
                                Program.Runtime_PLC3.mtk_AB06C_runtime = Runtime_PLC3.mtk_AB06C_runtime;
                                Program.Runtime_PLC3.khuayKeoTu_GD2_runtime = Runtime_PLC3.khuayKeoTu_GD2_runtime;
                                Program.Runtime_PLC3.khuayTaoBong_A_runtime = Runtime_PLC3.khuayTaoBong_A_runtime;
                                Program.Runtime_PLC3.khuayTaoBong_B_runtime = Runtime_PLC3.khuayTaoBong_B_runtime;
                                Program.Runtime_PLC3.gbbl05_runtime = Runtime_PLC3.gbbl05_runtime;
                                Program.Runtime_PLC3.gbbl07_runtime = Runtime_PLC3.gbbl07_runtime;
                                Program.Runtime_PLC3.gbbl09_runtime = Runtime_PLC3.gbbl09_runtime;
                                Program.Runtime_PLC3.khuayPac_GD2_runtime = Runtime_PLC3.khuayPac_GD2_runtime;
                                Program.Runtime_PLC3.khuayPoly_GD2_runtime = Runtime_PLC3.khuayPoly_GD2_runtime;
                                Program.Runtime_PLC3.bomBun_05A_runtime = Runtime_PLC3.bomBun_05A_runtime;
                                Program.Runtime_PLC3.bomBun_05B_runtime = Runtime_PLC3.bomBun_05B_runtime;
                                Program.Runtime_PLC3.bomBun_07A_runtime = Runtime_PLC3.bomBun_07A_runtime;
                                Program.Runtime_PLC3.bomBun_07B_runtime = Runtime_PLC3.bomBun_07B_runtime;
                                Program.Runtime_PLC3.bomBun_SP10_runtime = Runtime_PLC3.bomBun_SP10_runtime;
                                Program.Runtime_PLC3.dlPhen_03A_runtime = Runtime_PLC3.dlPhen_03A_runtime;
                                Program.Runtime_PLC3.dlPhen_03B_runtime = Runtime_PLC3.dlPhen_03B_runtime;
                                Program.Runtime_PLC3.dlPoly_04A_runtime = Runtime_PLC3.dlPoly_04A_runtime;
                                Program.Runtime_PLC3.dlPoly_04B_runtime = Runtime_PLC3.dlPoly_04B_runtime;
                                Program.Runtime_PLC3.dlXut_05A_runtime = Runtime_PLC3.dlXut_05A_runtime;
                                Program.Runtime_PLC3.dlXut_05B_runtime = Runtime_PLC3.dlXut_05B_runtime;
                                Program.Runtime_PLC3.dlDd_06A_runtime = Runtime_PLC3.dlDd_06A_runtime;
                                Program.Runtime_PLC3.dlDd_06B_runtime = Runtime_PLC3.dlDd_06B_runtime;
                                Program.Runtime_PLC3.dlKhuTrung_07A_runtime = Runtime_PLC3.dlKhuTrung_07A_runtime;
                                Program.Runtime_PLC3.dlKhuTrung_07B_runtime = Runtime_PLC3.dlKhuTrung_07B_runtime;

                                /// Thời gian cài đặt runtime thực tế (GD2)
                                /// Note: int (PLC) <=> KDL: short trong C#
                                /// 
                                Program.RuntimeSetting_PLC3.bomNt_02A_setTime = RuntimeSetting_PLC3.bomNt_02A_setTime;
                                Program.RuntimeSetting_PLC3.bomNt_02B_setTime = RuntimeSetting_PLC3.bomNt_02B_setTime;
                                Program.RuntimeSetting_PLC3.mtk_AB06A_setTime = RuntimeSetting_PLC3.mtk_AB06A_setTime;
                                Program.RuntimeSetting_PLC3.mtk_AB06B_setTime = RuntimeSetting_PLC3.mtk_AB06B_setTime;
                                Program.RuntimeSetting_PLC3.mtk_AB06C_setTime = RuntimeSetting_PLC3.mtk_AB06C_setTime;
                                Program.RuntimeSetting_PLC3.gbbl05_setTime_on = RuntimeSetting_PLC3.gbbl05_setTime_on;
                                Program.RuntimeSetting_PLC3.gbbl05_setTime_off = RuntimeSetting_PLC3.gbbl05_setTime_off;
                                Program.RuntimeSetting_PLC3.gbbl07_setTime_on = RuntimeSetting_PLC3.gbbl07_setTime_on;
                                Program.RuntimeSetting_PLC3.gbbl07_setTime_off = RuntimeSetting_PLC3.gbbl07_setTime_off;
                                Program.RuntimeSetting_PLC3.gbbl09_setTime_on = RuntimeSetting_PLC3.gbbl09_setTime_on;
                                Program.RuntimeSetting_PLC3.gbbl09_setTime_off = RuntimeSetting_PLC3.gbbl09_setTime_off;
                                Program.RuntimeSetting_PLC3.bomBun_05AB_setTime_on = RuntimeSetting_PLC3.bomBun_05AB_setTime_on;
                                Program.RuntimeSetting_PLC3.bomBun_05AB_setTime_off = RuntimeSetting_PLC3.bomBun_05AB_setTime_off;
                                Program.RuntimeSetting_PLC3.bomBun_07AB_setTime_on = RuntimeSetting_PLC3.bomBun_07AB_setTime_on;
                                Program.RuntimeSetting_PLC3.bomBun_07AB_setTime_off = RuntimeSetting_PLC3.bomBun_07AB_setTime_off;

                                // Chế độ Auto / Man: 3 máy thổi khí : GD2
                                Program.RuntimeSetting_PLC3.gbbl09_setTime_on = RuntimeSetting_PLC3.gbbl09_setTime_on;
                                Program.RuntimeSetting_PLC3.gbbl09_setTime_off = RuntimeSetting_PLC3.gbbl09_setTime_off;
                                Program.RuntimeSetting_PLC3.bomBun_05AB_setTime_on = RuntimeSetting_PLC3.bomBun_05AB_setTime_on;
                                Program.RuntimeSetting_PLC3.bomBun_05AB_setTime_off = RuntimeSetting_PLC3.bomBun_05AB_setTime_off;
                                Program.RuntimeSetting_PLC3.bomBun_07AB_setTime_on = RuntimeSetting_PLC3.bomBun_07AB_setTime_on;
                                Program.RuntimeSetting_PLC3.bomBun_07AB_setTime_off = RuntimeSetting_PLC3.bomBun_07AB_setTime_off;

                                //-------------------------------------------------------------------------------------------------------
                                #endregion

                                #region OLD VERSION
                                //// Cập nhật giá trị phao bể điều hòa
                                //Input.low_dieuHoa_float = (bool)plc.Read(DataType.Input, 0, 8, VarType.Bit, 1); // READ I8.0
                                //Input.high_dieuHoa_float = (bool)plc.Read(DataType.Input, 0, 8, VarType.Bit, 1, 1); // READ I8.1
                                //Input.float_beBun05_float = (bool)plc.Read(DataType.Input, 0, 8, VarType.Bit, 1, 2); // READ I8.2
                                //Input.float_beBun07_float = (bool)plc.Read(DataType.Input, 0, 8, VarType.Bit, 1, 3); // READ I8.3
                                //Input.float_beBunSP10_float = (bool)plc.Read(DataType.Input, 0, 8, VarType.Bit, 1, 4); // READ I8.4

                                //Input.ph_sensor = (short)plc.Read(DataType.Input, 0, 160, VarType.Word, 1, 0); // Read "IW160"
                                //Input.do_sensor = (short)plc.Read(DataType.Input, 0, 162, VarType.Word, 1, 0); // Read "IW162"
                                //Input.ph_value = (double)plc.Read(DataType.Memory, 0, 50, VarType.Real, 1, 0); // Read "MD50"


                                ////// Trạng thái "RUN" GD2
                                //Input.dlPoly_04A_runStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm định lượng Polyme 04A "I5.5"
                                //Input.dlPoly_04B_runStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm định lượng Polyme 04B "I5.6"
                                //Input.mayTachRac_runStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 0); // Trạng thái "RUN" máy tách rác "I0.0"
                                //Input.bomNt_02A_runStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm nước thải 02A "I0.2"
                                //Input.bomNt_02B_runStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm nước thải 02B "I0.4"
                                //Input.mtk_AB06A_runStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 6); // Trạng thái "RUN" máy thổi khí AB06A "I0.6"
                                //Input.mtk_AB06B_runStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 0); // Trạng thái "RUN" máy thổi khí AB06B "I1.0"
                                //Input.mtk_AB06C_runStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 2); // Trạng thái "RUN" máy thổi khí AB06C "I1.2"
                                //Input.khuayKeoTu_GD2_runStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 4); // Trạng thái "RUN" khuấy keo tụ GD2 "I1.4"
                                //Input.khuayTaoBong_A_runStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 6); // Trạng thái "RUN" khuấy tạo bông A "I1.6"
                                //Input.khuayTaoBong_B_runStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 0);  // Trạng thái "RUN" khuấy tạo bông B "I2.0"
                                //Input.gbbl05_runStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất GBBL 05 "I2.2"
                                //Input.gbbl07_runStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm hóa chất GBBL 07 "I2.4"
                                //Input.gbbl09_runStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm hóa chất GBBL 09 "I2.6"
                                //Input.khuayPac_GD2_runStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 0); // Trạng thái "RUN" khuấy PAC GD2 "I3.0"
                                //Input.khuayPoly_GD2_runStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 2); // Trạng thái "RUN" khuấy Polyme GD2 "I3.2"
                                //Input.bomBun_05A_runStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm bùn 05A "I3.4"
                                //Input.bomBun_05B_runStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm bùn 05B "I3.6"
                                //Input.bomBun_07A_runStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm bùn 07A "I4.0"
                                //Input.bomBun_07B_runStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm bùn 07B "I4.2"
                                //Input.bomBun_SP10_runStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm bùn SP10 "I4.4"
                                //Input.dlPhen_03A_runStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm định lượng phèn 03A "I5.0"
                                //Input.dlPhen_03B_runStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm định lượng phèn 03B "I5.2"
                                //Input.dlXut_05A_runStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất Xút 05A "I6.0"
                                //Input.dlXut_05B_runStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất Xút 05B "I6.2"
                                //Input.dlDd_06A_runStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 4); // Trạng thái "RUN" bơm hóa chất Dd 06A "I6.4"
                                //Input.dlDd_06B_runStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm hóa chất Dd 06B "I6.6"
                                //Input.dlKhuTrung_07A_runStatus = (bool)plc.Read(DataType.Input, 0, 7, VarType.Bit, 1, 0); // Trạng thái "RUN" bơm hóa chất khử trùng 07A "I7.0"
                                //Input.dlKhuTrung_07B_runStatus = (bool)plc.Read(DataType.Input, 0, 7, VarType.Bit, 1, 2); // Trạng thái "RUN" bơm hóa chất khử trùng 07B "I7.2"

                                //// Trạng thái "TRIP" GD2
                                //Input.mayTachRac_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 1); // Trạng thái "RUN" máy tách rác "I0.1"
                                //Input.bomNt_02A_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm nước thải 02A "I0.3"
                                //Input.bomNt_02B_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm nước thải 02B "I0.5"
                                //Input.mtk_AB06A_tripStatus = (bool)plc.Read(DataType.Input, 0, 0, VarType.Bit, 1, 7); // Trạng thái "RUN" máy thổi khí AB06A "I0.7"
                                //Input.mtk_AB06B_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 1); // Trạng thái "RUN" máy thổi khí AB06B "I1.1"
                                //Input.mtk_AB06C_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 3); // Trạng thái "RUN" máy thổi khí AB06C "I1.3"
                                //Input.khuayKeoTu_GD2_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 5); // Trạng thái "RUN" khuấy keo tụ GD2 "I1.5"
                                //Input.khuayTaoBong_A_tripStatus = (bool)plc.Read(DataType.Input, 0, 1, VarType.Bit, 1, 7); // Trạng thái "RUN" khuấy tạo bông A "I1.7"
                                //Input.khuayTaoBong_B_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 1);  // Trạng thái "RUN" khuấy tạo bông B "I2.1"
                                //Input.gbbl05_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất GBBL 05 "I2.3"
                                //Input.gbbl07_tripStatus = (bool)plc.Read(DataType.Input, 0, 2, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm hóa chất GBBL 07 "I2.5"
                                //Input.gbbl09_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm hóa chất GBBL 09 "I2.7"
                                //Input.khuayPac_GD2_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 1); // Trạng thái "RUN" khuấy PAC GD2 "I3.1"
                                //Input.khuayPoly_GD2_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 3); // Trạng thái "RUN" khuấy Polyme GD2 "I3.3"
                                //Input.bomBun_05A_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm bùn 05A "I3.5"
                                //Input.bomBun_05B_tripStatus = (bool)plc.Read(DataType.Input, 0, 3, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm bùn 05B "I3.7"
                                //Input.bomBun_07A_tripStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm bùn 07A "I4.1"
                                //Input.bomBun_07B_tripStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm bùn 07B "I4.3"
                                //Input.bomBun_SP10_tripStatus = (bool)plc.Read(DataType.Input, 0, 4, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm bùn SP10 "I4.5"
                                //Input.dlPhen_03A_tripStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm định lượng phèn 03A "I5.1"
                                //Input.dlPhen_03B_tripStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm định lượng phèn 03B "I5.3"
                                //Input.dlPoly_04A_tripStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 6); // Trạng thái "RUN" bơm định lượng Polyme 04A "I5.6"
                                //Input.dlPoly_04B_tripStatus = (bool)plc.Read(DataType.Input, 0, 5, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm định lượng Polyme 04B "I5.7"
                                //Input.dlXut_05A_tripStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất Xút 05A "I6.1"
                                //Input.dlXut_05B_tripStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất Xút 05B "I6.3"
                                //Input.dlDd_06A_tripStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 5); // Trạng thái "RUN" bơm hóa chất Dd 06A "I6.5"
                                //Input.dlDd_06B_tripStatus = (bool)plc.Read(DataType.Input, 0, 6, VarType.Bit, 1, 7); // Trạng thái "RUN" bơm hóa chất Dd 06B "I6.7"
                                //Input.dlKhuTrung_07A_tripStatus = (bool)plc.Read(DataType.Input, 0, 7, VarType.Bit, 1, 1); // Trạng thái "RUN" bơm hóa chất khử trùng 07A "I7.1"
                                //Input.dlKhuTrung_07B_tripStatus = (bool)plc.Read(DataType.Input, 0, 7, VarType.Bit, 1, 3); // Trạng thái "RUN" bơm hóa chất khử trùng 07B "I7.3"

                                /// Thời gian chạy RUNTIME thực tế (GD2)
                                /// Note: Dint (PLC) <=> KDL: Int trong C#
                                /// 

                                //Parameter.mayTachRac_runtime = (int)plc.Read(DataType.DataBlock, 39, 0, VarType.DInt, 1);
                                //Parameter.bomNt_02A_runtime = (int)plc.Read(DataType.DataBlock, 39, 4, VarType.DInt, 1);
                                //Parameter.bomNt_02B_runtime = (int)plc.Read(DataType.DataBlock, 39, 8, VarType.DInt, 1);
                                //Parameter.mtk_AB06A_runtime = (int)plc.Read(DataType.DataBlock, 39, 12, VarType.DInt, 1);
                                //Parameter.mtk_AB06B_runtime = (int)plc.Read(DataType.DataBlock, 39, 16, VarType.DInt, 1);
                                //Parameter.mtk_AB06C_runtime = (int)plc.Read(DataType.DataBlock, 39, 20, VarType.DInt, 1);
                                //Parameter.khuayKeoTu_GD2_runtime = (int)plc.Read(DataType.DataBlock, 39, 24, VarType.DInt, 1);
                                //Parameter.khuayTaoBong_A_runtime = (int)plc.Read(DataType.DataBlock, 39, 28, VarType.DInt, 1);
                                //Parameter.khuayTaoBong_B_runtime = (int)plc.Read(DataType.DataBlock, 39, 32, VarType.DInt, 1);
                                //Parameter.gbbl05_runtime = (int)plc.Read(DataType.DataBlock, 39, 36, VarType.DInt, 1);
                                //Parameter.gbbl07_runtime = (int)plc.Read(DataType.DataBlock, 39, 40, VarType.DInt, 1);
                                //Parameter.gbbl09_runtime = (int)plc.Read(DataType.DataBlock, 39, 44, VarType.DInt, 1);
                                //Parameter.khuayPac_GD2_runtime = (int)plc.Read(DataType.DataBlock, 39, 48, VarType.DInt, 1);
                                //Parameter.khuayPoly_GD2_runtime = (int)plc.Read(DataType.DataBlock, 39, 52, VarType.DInt, 1);
                                //Parameter.bomBun_05A_runtime = (int)plc.Read(DataType.DataBlock, 39, 56, VarType.DInt, 1);
                                //Parameter.bomBun_05B_runtime = (int)plc.Read(DataType.DataBlock, 39, 60, VarType.DInt, 1);
                                //Parameter.bomBun_07A_runtime = (int)plc.Read(DataType.DataBlock, 39, 64, VarType.DInt, 1);
                                //Parameter.bomBun_07B_runtime = (int)plc.Read(DataType.DataBlock, 39, 68, VarType.DInt, 1);
                                //Parameter.bomBun_SP10_runtime = (int)plc.Read(DataType.DataBlock, 39, 72, VarType.DInt, 1);
                                //Parameter.dlPhen_03A_runtime = (int)plc.Read(DataType.DataBlock, 39, 76, VarType.DInt, 1);
                                //Parameter.dlPhen_03B_runtime = (int)plc.Read(DataType.DataBlock, 39, 80, VarType.DInt, 1);
                                //Parameter.dlPoly_04A_runtime = (int)plc.Read(DataType.DataBlock, 39, 84, VarType.DInt, 1);
                                //Parameter.dlPoly_04B_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlXut_05A_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlXut_05B_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlDd_06A_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlDd_06B_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlKhuTrung_07A_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);
                                //Parameter.dlKhuTrung_07B_runtime = (int)plc.Read(DataType.DataBlock, 39, 88, VarType.DInt, 1);

                                /// Thời gian cài đặt runtime thực tế (GD2)
                                /// Note: int (PLC) <=> KDL: short trong C#
                                /// 
                                //Parameter.nt02a_setTime = (short)plc.Read(DataType.DataBlock, 19, 0, VarType.Int, 1);
                                //Parameter.nt02b_setTime = (short)plc.Read(DataType.DataBlock, 19, 2, VarType.Int, 1);
                                //Parameter.mtk_AB06A_setTime = (short)plc.Read(DataType.DataBlock, 19, 4, VarType.Int, 1);
                                //Parameter.mtk_AB06B_setTime = (short)plc.Read(DataType.DataBlock, 19, 6, VarType.Int, 1);
                                //Parameter.mtk_AB06C_setTime = (short)plc.Read(DataType.DataBlock, 19, 8, VarType.Int, 1);
                                //Parameter.gbbl05_setTime_on = (short)plc.Read(DataType.DataBlock, 19, 10, VarType.Int, 1);
                                //Parameter.gbbl05_setTime_off = (short)plc.Read(DataType.DataBlock, 19, 12, VarType.Int, 1);
                                //Parameter.gbbl07_setTime_on = (short)plc.Read(DataType.DataBlock, 19, 14, VarType.Int, 1);
                                //Parameter.gbbl07_setTime_off = (short)plc.Read(DataType.DataBlock, 19, 16, VarType.Int, 1);
                                //Parameter.gbbl09_setTime_on = (short)plc.Read(DataType.DataBlock, 19, 18, VarType.Int, 1);
                                //Parameter.gbbl09_setTime_off = (short)plc.Read(DataType.DataBlock, 19, 20, VarType.Int, 1);
                                //Parameter.bomBun05_setTime_on = (short)plc.Read(DataType.DataBlock, 19, 22, VarType.Int, 1);
                                //Parameter.bomBun05_setTime_off = (short)plc.Read(DataType.DataBlock, 19, 24, VarType.Int, 1);
                                //Parameter.bomBun07_setTime_on = (short)plc.Read(DataType.DataBlock, 19, 26, VarType.Int, 1);
                                //Parameter.bomBun07_setTime_off = (short)plc.Read(DataType.DataBlock, 19, 28, VarType.Int, 1);
                                #endregion

                                #region ZONE FOR DEBUGGING
                                /*
                                Console.WriteLine("MT-02A:");
                                Console.WriteLine(Program.InputStatus_PLC1.khuayTaoBong1_runStatus);
                                Console.WriteLine("MT-01:");
                                Console.WriteLine(Program.InputStatus_PLC1.khuayKeoTu_runStatus);
                                Console.WriteLine("Read PLC_3 Success!");
                                */
                                #endregion

                                this.plc.Close();
                            }

                        }
                        else
                        {
                            Console.WriteLine("PLC3 is not available");
                            return;
                        }
                    }

                    catch (Exception err)
                    {
                        this.plc_error = err.Message;
                    }
                };

                Task task3 = new Task(myAction3);
                task3.Start();

                await task3;
                plc.Close();

            }
        }

        // SCAN VALUE AND TRIGGER ALARM TO TABLE:
        internal class AlarmEngine : Alarm_CycleScan.levelDown
        {

            ListView lvAlarm = new ListView();
            ListViewItem lviAlarm_InLviList;

            Control[] alarmTableList;
            int count = 0;
            public int maxNumberItem { get; set; } = 250;


            AlarmItems.tripAlarmRow TripItem_InClassList = new AlarmItems.tripAlarmRow();

            Users.Administrators user1 = new Users.Administrators() { fullName = "demoFullName", role = Users.roles.Administrator, username = "demoUser" };

            public string hostName { get; set; } = "localhost";
            public string port { get; set; } = "27017";
            utility_MongoDB ultilityMongoDB { get; set; }


            /*
            public override void DetectAlarm()
            {
                
                // Find Control "Listview" in alarmPage in Program "Main"
                Control[] alarmTableList = Program.alarmPage.Controls.Find("alarmTable_alm_alarmPage", true);
                lvAlarm = alarmTableList[0] as ListView;

                if (lvAlarm != null)
                {
                    Program.danhSachAlarm.almItem_mtk01_tripStatus.value = Program.InputStatus_PLC1.mtk01_tripStatus;
                    if (Program.danhSachAlarm.almItem_mtk01_tripStatus.value != Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue)
                    {
                        if(Program.danhSachAlarm.almItem_mtk01_tripStatus.value)
                        {
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue = true;

                            // Định nghĩa alarm, đẩy vào Alarm Table
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus = true;
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp = DateTime.Now;
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.status = "Lỗi quá tải bơm thổi khí 'MTK01'";
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.entityName = "MTK01";
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment = false;
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.date = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("dd/MM/yyyy");
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.time = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("HH:mm:ss");
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.id = "MTK01";
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id = "0x001";

                            lviAlarm = new ListViewItem(Program.danhSachAlarm.almItem_mtk01_tripStatus.date);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.time);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.duration);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.id);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity.ToString());
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.status);
                            lviAlarm.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment.ToString());
                            lviAlarm.BackColor = Color.Yellow;


                            lvAlarm.Invoke((MethodInvoker)delegate
                            {
                                lvAlarm.Items.Add(lviAlarm);
                            });
                        } 
                        else
                        {
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.value = false;
                            Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue = false;

                            //for(int i = 0; i < lvAlarm.Items.Count; i++)
                            //{
                            //   if( lvAlarm.Items[i].SubItems[4].Text == "MTK01")
                            //    {
                            //        // Black out row Alarm
                            //        lvAlarm.BeginInvoke((MethodInvoker)delegate
                            //        {
                            //            lvAlarm.Items[i].BackColor = Color.White;
                            //        });
                            //    }    
                            //}    
                        }    

                        // Lưu vào DataBase
                    }
                }
                else
                {
                    return;
                }    
            }
            */

            public override void Load()
            {
                // base.Load();
                // Find Control "Listview" in alarmPage in Program "Main"
                alarmTableList = Program.alarmPage.Controls.Find("alarmTable_alm_alarmPage", true);
                lvAlarm = alarmTableList[0] as ListView;

            }

            public override void updateEventHandler(object sender, ElapsedEventArgs e)
            {
                DetectAlarm();
            }
            public override void DetectAlarm()
            {
                try
                {
                    if (lvAlarm != null)
                    {

                        #region Giai đoạn 1: GD1
                        #region MTK01
                        Program.danhSachAlarm.almItem_mtk01_tripStatus.value = Program.InputStatus_PLC1.mtk01_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk01_tripStatus.value != Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk01_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();


                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.entityName = "MTK01";
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk01_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.date = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.time = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.description = "Lỗi quá tải thiết bị 'MTK01'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk01_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk01_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk01_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK01
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK01
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của MTK01

                                #region Thêm vào General List
                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    AlarmItems.GeneralAlarmItem mtk01_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk01_genAlarm.id = Program.danhSachAlarm.almItem_mtk01_tripStatus.id;
                                    mtk01_genAlarm.entityName = "MTK01";
                                    mtk01_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp;
                                    mtk01_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus;
                                    mtk01_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk01_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment;
                                    mtk01_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk01_genAlarm.status = Program.danhSachAlarm.almItem_mtk01_tripStatus.status;
                                    mtk01_genAlarm.description = Program.danhSachAlarm.almItem_mtk01_tripStatus.description;

                                    var l3 = (mtk01_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk01_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk01_genAlarm.id = Program.danhSachAlarm.almItem_mtk01_tripStatus.id;
                                    mtk01_genAlarm.entityName = "MTK01";
                                    mtk01_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp;
                                    mtk01_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus;
                                    mtk01_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk01_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment;
                                    mtk01_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk01_genAlarm.status = Program.danhSachAlarm.almItem_mtk01_tripStatus.status;
                                    mtk01_genAlarm.description = Program.danhSachAlarm.almItem_mtk01_tripStatus.description;

                                    var l3 = (mtk01_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                var bsonDoc = new BsonDocument {
                                            { "_id", Program.danhSachAlarm.almItem_mtk01_tripStatus.id },
                                            { "entityName", Program.danhSachAlarm.almItem_mtk01_tripStatus.entityName },
                                            { "activeStatus", Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus },
                                            {"timestamp", Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp},
                                            {"alarmSeverity", Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity},
                                            {"acknowledgment", Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment},
                                            {"error_id", Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id},
                                            {"status", Program.danhSachAlarm.almItem_mtk01_tripStatus.status},
                                            { "description",Program.danhSachAlarm.almItem_mtk01_tripStatus.description }
                                            };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk01_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk01_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk01_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk01_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                            { "_id", Guid.NewGuid().ToString() },
                                            { "entityName", Program.danhSachAlarm.almItem_mtk01_tripStatus.entityName },
                                            { "activeStatus", false },
                                            {"timestamp", T2},
                                            {"alarmSeverity", Program.danhSachAlarm.almItem_mtk01_tripStatus.alarmSeverity},
                                            {"acknowledgment", Program.danhSachAlarm.almItem_mtk01_tripStatus.acknowledgment},
                                            {"error_id", Program.danhSachAlarm.almItem_mtk01_tripStatus.error_id},
                                            {"status", Program.danhSachAlarm.almItem_mtk01_tripStatus.status},
                                            { "description",Program.danhSachAlarm.almItem_mtk01_tripStatus.description }
                                            };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }

                        }
                        #endregion

                        #region MTK02
                        Program.danhSachAlarm.almItem_mtk02_tripStatus.value = Program.InputStatus_PLC1.mtk02_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk02_tripStatus.value != Program.danhSachAlarm.almItem_mtk02_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk02_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.entityName = "MTK02";
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk02_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.date = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.time = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.description = "Lỗi quá tải thiết bị 'MTK02'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk02_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk02_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk02_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk02_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk02_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK02
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK02
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của MTK02
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mtk02_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk02_genAlarm.id = Program.danhSachAlarm.almItem_mtk02_tripStatus.id;
                                    mtk02_genAlarm.entityName = "MTK02";
                                    mtk02_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp;
                                    mtk02_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk02_tripStatus.activeStatus;
                                    mtk02_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk02_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment;
                                    mtk02_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk02_genAlarm.status = Program.danhSachAlarm.almItem_mtk02_tripStatus.status;
                                    mtk02_genAlarm.description = Program.danhSachAlarm.almItem_mtk02_tripStatus.description;

                                    var l3 = (mtk02_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk02_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk02_genAlarm.id = Program.danhSachAlarm.almItem_mtk02_tripStatus.id;
                                    mtk02_genAlarm.entityName = "MTK02";
                                    mtk02_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp;
                                    mtk02_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk02_tripStatus.activeStatus;
                                    mtk02_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk02_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment;
                                    mtk02_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk02_genAlarm.status = Program.danhSachAlarm.almItem_mtk02_tripStatus.status;
                                    mtk02_genAlarm.description = Program.danhSachAlarm.almItem_mtk02_tripStatus.description;

                                    var l3 = (mtk02_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mtk02_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk02_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mtk02_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk02_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk02_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk02_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk02_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                        //var l4 = lviAlarm_InLviList.Clone() as ListViewItem;

                                        lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk02_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk02_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk02_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk02_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk02_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk02_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk02_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk02_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk02_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk02_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion

                        #region MTK03
                        Program.danhSachAlarm.almItem_mtk03_tripStatus.value = Program.InputStatus_PLC1.mtk03_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk03_tripStatus.value != Program.danhSachAlarm.almItem_mtk03_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk03_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.entityName = "MTK03";
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk03_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.date = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.time = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.description = "Lỗi quá tải thiết bị 'MTK03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk03_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk03_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk03_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk03_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk03_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK03
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của MTK03
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của MTK03
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mtk03_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk03_genAlarm.id = Program.danhSachAlarm.almItem_mtk03_tripStatus.id;
                                    mtk03_genAlarm.entityName = "MTK03";
                                    mtk03_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp;
                                    mtk03_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk03_tripStatus.activeStatus;
                                    mtk03_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk03_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment;
                                    mtk03_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk03_genAlarm.status = Program.danhSachAlarm.almItem_mtk03_tripStatus.status;
                                    mtk03_genAlarm.description = Program.danhSachAlarm.almItem_mtk03_tripStatus.description;

                                    var l3 = (mtk03_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk03_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk03_genAlarm.id = Program.danhSachAlarm.almItem_mtk03_tripStatus.id;
                                    mtk03_genAlarm.entityName = "MTK03";
                                    mtk03_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp;
                                    mtk03_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk03_tripStatus.activeStatus;
                                    mtk03_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk03_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment;
                                    mtk03_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk03_genAlarm.status = Program.danhSachAlarm.almItem_mtk03_tripStatus.status;
                                    mtk03_genAlarm.description = Program.danhSachAlarm.almItem_mtk03_tripStatus.description;

                                    var l3 = (mtk03_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mtk03_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk03_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mtk03_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk03_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk03_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk03_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk03_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk03_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk03_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk03_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk03_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk03_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk03_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk03_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk03_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk03_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk03_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region P0201
                        Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.value = Program.InputStatus_PLC1.dieuHoa1_tripStatus;
                        if (Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.value != Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.entityName = "P0201";
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.date = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.time = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description = "Lỗi quá tải thiết bị 'P0201'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của P0201
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của P0201
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của P0201
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dieuHoa1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dieuHoa1_genAlarm.id = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id;
                                    dieuHoa1_genAlarm.entityName = "P0201";
                                    dieuHoa1_genAlarm.timestamp = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp;
                                    dieuHoa1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.activeStatus;
                                    dieuHoa1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dieuHoa1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment;
                                    dieuHoa1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dieuHoa1_genAlarm.status = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status;
                                    dieuHoa1_genAlarm.description = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description;

                                    var l3 = (dieuHoa1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dieuHoa1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dieuHoa1_genAlarm.id = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id;
                                    dieuHoa1_genAlarm.entityName = "P0201";
                                    dieuHoa1_genAlarm.timestamp = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp;
                                    dieuHoa1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.activeStatus;
                                    dieuHoa1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dieuHoa1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment;
                                    dieuHoa1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dieuHoa1_genAlarm.status = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status;
                                    dieuHoa1_genAlarm.description = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description;

                                    var l3 = (dieuHoa1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dieuHoa1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region P0202
                        Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.value = Program.InputStatus_PLC1.dieuHoa2_tripStatus;
                        if (Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.value != Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.entityName = "P0202";
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.date = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.time = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description = "Lỗi quá tải thiết bị 'P0202'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của P0202
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của P0202
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của P0202
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dieuHoa2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dieuHoa2_genAlarm.id = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id;
                                    dieuHoa2_genAlarm.entityName = "P0202";
                                    dieuHoa2_genAlarm.timestamp = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp;
                                    dieuHoa2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.activeStatus;
                                    dieuHoa2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dieuHoa2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment;
                                    dieuHoa2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dieuHoa2_genAlarm.status = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status;
                                    dieuHoa2_genAlarm.description = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description;

                                    var l3 = (dieuHoa2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dieuHoa2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dieuHoa2_genAlarm.id = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id;
                                    dieuHoa2_genAlarm.entityName = "P0202";
                                    dieuHoa2_genAlarm.timestamp = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp;
                                    dieuHoa2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.activeStatus;
                                    dieuHoa2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dieuHoa2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment;
                                    dieuHoa2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dieuHoa2_genAlarm.status = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status;
                                    dieuHoa2_genAlarm.description = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description;

                                    var l3 = (dieuHoa2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dieuHoa2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region THN
                        Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.value = Program.InputStatus_PLC1.tuanHoanNuoc_tripStatus;
                        if (Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.value != Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.entityName = "THN";
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.date = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.time = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description = "Lỗi quá tải thiết bị 'THN'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của THN
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của THN
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của THN
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem tuanHoanNuoc_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoanNuoc_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id;
                                    tuanHoanNuoc_genAlarm.entityName = "THN";
                                    tuanHoanNuoc_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp;
                                    tuanHoanNuoc_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.activeStatus;
                                    tuanHoanNuoc_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoanNuoc_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment;
                                    tuanHoanNuoc_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoanNuoc_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status;
                                    tuanHoanNuoc_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description;

                                    var l3 = (tuanHoanNuoc_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem tuanHoanNuoc_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoanNuoc_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id;
                                    tuanHoanNuoc_genAlarm.entityName = "THN";
                                    tuanHoanNuoc_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp;
                                    tuanHoanNuoc_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.activeStatus;
                                    tuanHoanNuoc_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoanNuoc_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment;
                                    tuanHoanNuoc_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoanNuoc_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status;
                                    tuanHoanNuoc_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description;

                                    var l3 = (tuanHoanNuoc_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoanNuoc_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region THB
                        Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.value = Program.InputStatus_PLC1.tuanHoanBun_tripStatus;
                        if (Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.value != Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.entityName = "THB";
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.date = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.time = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description = "Lỗi quá tải thiết bị 'THB'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của THB
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của THB
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của THB
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem tuanHoanBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoanBun_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id;
                                    tuanHoanBun_genAlarm.entityName = "THB";
                                    tuanHoanBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp;
                                    tuanHoanBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.activeStatus;
                                    tuanHoanBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoanBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment;
                                    tuanHoanBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoanBun_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status;
                                    tuanHoanBun_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description;

                                    var l3 = (tuanHoanBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem tuanHoanBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoanBun_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id;
                                    tuanHoanBun_genAlarm.entityName = "THB";
                                    tuanHoanBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp;
                                    tuanHoanBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.activeStatus;
                                    tuanHoanBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoanBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment;
                                    tuanHoanBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoanBun_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status;
                                    tuanHoanBun_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description;

                                    var l3 = (tuanHoanBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoanBun_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP09A
                        Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.value = Program.InputStatus_PLC1.bunHoaLy1_tripStatus;
                        if (Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.value != Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.entityName = "SP09A";
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.date = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.time = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description = "Lỗi quá tải thiết bị 'SP09A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của SP09A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của SP09A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của SP09A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bunHoaLy1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bunHoaLy1_genAlarm.id = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id;
                                    bunHoaLy1_genAlarm.entityName = "SP09A";
                                    bunHoaLy1_genAlarm.timestamp = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp;
                                    bunHoaLy1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.activeStatus;
                                    bunHoaLy1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bunHoaLy1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment;
                                    bunHoaLy1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bunHoaLy1_genAlarm.status = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status;
                                    bunHoaLy1_genAlarm.description = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description;

                                    var l3 = (bunHoaLy1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bunHoaLy1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bunHoaLy1_genAlarm.id = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id;
                                    bunHoaLy1_genAlarm.entityName = "SP09A";
                                    bunHoaLy1_genAlarm.timestamp = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp;
                                    bunHoaLy1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.activeStatus;
                                    bunHoaLy1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bunHoaLy1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment;
                                    bunHoaLy1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bunHoaLy1_genAlarm.status = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status;
                                    bunHoaLy1_genAlarm.description = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description;

                                    var l3 = (bunHoaLy1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bunHoaLy1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP09B
                        Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.value = Program.InputStatus_PLC1.bunHoaLy2_tripStatus;
                        if (Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.value != Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.entityName = "SP09B";
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.date = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.time = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description = "Lỗi quá tải thiết bị 'SP09B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của SP09B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của SP09B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của SP09B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bunHoaLy2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bunHoaLy2_genAlarm.id = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id;
                                    bunHoaLy2_genAlarm.entityName = "SP09B";
                                    bunHoaLy2_genAlarm.timestamp = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp;
                                    bunHoaLy2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.activeStatus;
                                    bunHoaLy2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bunHoaLy2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment;
                                    bunHoaLy2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bunHoaLy2_genAlarm.status = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status;
                                    bunHoaLy2_genAlarm.description = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description;

                                    var l3 = (bunHoaLy2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bunHoaLy2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bunHoaLy2_genAlarm.id = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id;
                                    bunHoaLy2_genAlarm.entityName = "SP09B";
                                    bunHoaLy2_genAlarm.timestamp = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp;
                                    bunHoaLy2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.activeStatus;
                                    bunHoaLy2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bunHoaLy2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment;
                                    bunHoaLy2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bunHoaLy2_genAlarm.status = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status;
                                    bunHoaLy2_genAlarm.description = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description;

                                    var l3 = (bunHoaLy2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bunHoaLy2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region P101
                        Program.danhSachAlarm.almItem_beGom1_tripStatus.value = Program.InputStatus_PLC1.beGom1_tripStatus;
                        if (Program.danhSachAlarm.almItem_beGom1_tripStatus.value != Program.danhSachAlarm.almItem_beGom1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_beGom1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.entityName = "P101";
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_beGom1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.date = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.time = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.description = "Lỗi quá tải thiết bị 'P101'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_beGom1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_beGom1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_beGom1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_beGom1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_beGom1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của P101
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của P101
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của P101
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem beGom1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom1_genAlarm.id = Program.danhSachAlarm.almItem_beGom1_tripStatus.id;
                                    beGom1_genAlarm.entityName = "P101";
                                    beGom1_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp;
                                    beGom1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom1_tripStatus.activeStatus;
                                    beGom1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment;
                                    beGom1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom1_genAlarm.status = Program.danhSachAlarm.almItem_beGom1_tripStatus.status;
                                    beGom1_genAlarm.description = Program.danhSachAlarm.almItem_beGom1_tripStatus.description;

                                    var l3 = (beGom1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem beGom1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom1_genAlarm.id = Program.danhSachAlarm.almItem_beGom1_tripStatus.id;
                                    beGom1_genAlarm.entityName = "P101";
                                    beGom1_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp;
                                    beGom1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom1_tripStatus.activeStatus;
                                    beGom1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment;
                                    beGom1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom1_genAlarm.status = Program.danhSachAlarm.almItem_beGom1_tripStatus.status;
                                    beGom1_genAlarm.description = Program.danhSachAlarm.almItem_beGom1_tripStatus.description;

                                    var l3 = (beGom1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_beGom1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_beGom1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_beGom1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_beGom1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_beGom1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_beGom1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region P102
                        Program.danhSachAlarm.almItem_beGom2_tripStatus.value = Program.InputStatus_PLC1.beGom2_tripStatus;
                        if (Program.danhSachAlarm.almItem_beGom2_tripStatus.value != Program.danhSachAlarm.almItem_beGom2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_beGom2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.entityName = "P102";
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_beGom2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.date = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.time = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.description = "Lỗi quá tải thiết bị 'P102'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_beGom2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_beGom2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_beGom2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_beGom2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_beGom2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của P102
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của P102
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của P102
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem beGom2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom2_genAlarm.id = Program.danhSachAlarm.almItem_beGom2_tripStatus.id;
                                    beGom2_genAlarm.entityName = "P102";
                                    beGom2_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp;
                                    beGom2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom2_tripStatus.activeStatus;
                                    beGom2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment;
                                    beGom2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom2_genAlarm.status = Program.danhSachAlarm.almItem_beGom2_tripStatus.status;
                                    beGom2_genAlarm.description = Program.danhSachAlarm.almItem_beGom2_tripStatus.description;

                                    var l3 = (beGom2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem beGom2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom2_genAlarm.id = Program.danhSachAlarm.almItem_beGom2_tripStatus.id;
                                    beGom2_genAlarm.entityName = "P102";
                                    beGom2_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp;
                                    beGom2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom2_tripStatus.activeStatus;
                                    beGom2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment;
                                    beGom2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom2_genAlarm.status = Program.danhSachAlarm.almItem_beGom2_tripStatus.status;
                                    beGom2_genAlarm.description = Program.danhSachAlarm.almItem_beGom2_tripStatus.description;

                                    var l3 = (beGom2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_beGom2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_beGom2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_beGom2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_beGom2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_beGom2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_beGom2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region P103
                        Program.danhSachAlarm.almItem_beGom3_tripStatus.value = Program.InputStatus_PLC1.beGom3_tripStatus;
                        if (Program.danhSachAlarm.almItem_beGom3_tripStatus.value != Program.danhSachAlarm.almItem_beGom3_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_beGom3_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.entityName = "P103";
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_beGom3_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.date = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.time = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.description = "Lỗi quá tải thiết bị 'P103'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_beGom3_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_beGom3_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_beGom3_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_beGom3_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_beGom3_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của P103
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của P103
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của P103
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem beGom3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom3_genAlarm.id = Program.danhSachAlarm.almItem_beGom3_tripStatus.id;
                                    beGom3_genAlarm.entityName = "P103";
                                    beGom3_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp;
                                    beGom3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom3_tripStatus.activeStatus;
                                    beGom3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment;
                                    beGom3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom3_genAlarm.status = Program.danhSachAlarm.almItem_beGom3_tripStatus.status;
                                    beGom3_genAlarm.description = Program.danhSachAlarm.almItem_beGom3_tripStatus.description;

                                    var l3 = (beGom3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem beGom3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    beGom3_genAlarm.id = Program.danhSachAlarm.almItem_beGom3_tripStatus.id;
                                    beGom3_genAlarm.entityName = "P103";
                                    beGom3_genAlarm.timestamp = Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp;
                                    beGom3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_beGom3_tripStatus.activeStatus;
                                    beGom3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    beGom3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment;
                                    beGom3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    beGom3_genAlarm.status = Program.danhSachAlarm.almItem_beGom3_tripStatus.status;
                                    beGom3_genAlarm.description = Program.danhSachAlarm.almItem_beGom3_tripStatus.description;

                                    var l3 = (beGom3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_beGom3_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom3_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_beGom3_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom3_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_beGom3_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_beGom3_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_beGom3_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_beGom3_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_beGom3_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_beGom3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_beGom3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_beGom3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_beGom3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_beGom3_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SKBM1
                        Program.danhSachAlarm.almItem_skbm1_tripStatus.value = Program.InputStatus_PLC1.skbm1_tripStatus;
                        if (Program.danhSachAlarm.almItem_skbm1_tripStatus.value != Program.danhSachAlarm.almItem_skbm1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_skbm1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.entityName = "SKBM1";
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_skbm1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.date = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.time = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.description = "Lỗi quá tải thiết bị 'SKBM1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_skbm1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_skbm1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_skbm1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_skbm1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_skbm1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của SKBM1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của SKBM1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của SKBM1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem skbm1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm1_genAlarm.id = Program.danhSachAlarm.almItem_skbm1_tripStatus.id;
                                    skbm1_genAlarm.entityName = "SKBM1";
                                    skbm1_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp;
                                    skbm1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm1_tripStatus.activeStatus;
                                    skbm1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment;
                                    skbm1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm1_genAlarm.status = Program.danhSachAlarm.almItem_skbm1_tripStatus.status;
                                    skbm1_genAlarm.description = Program.danhSachAlarm.almItem_skbm1_tripStatus.description;

                                    var l3 = (skbm1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem skbm1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm1_genAlarm.id = Program.danhSachAlarm.almItem_skbm1_tripStatus.id;
                                    skbm1_genAlarm.entityName = "SKBM1";
                                    skbm1_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp;
                                    skbm1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm1_tripStatus.activeStatus;
                                    skbm1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment;
                                    skbm1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm1_genAlarm.status = Program.danhSachAlarm.almItem_skbm1_tripStatus.status;
                                    skbm1_genAlarm.description = Program.danhSachAlarm.almItem_skbm1_tripStatus.description;

                                    var l3 = (skbm1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_skbm1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_skbm1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_skbm1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_skbm1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_skbm1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_skbm1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region skbm2
                        Program.danhSachAlarm.almItem_skbm2_tripStatus.value = Program.InputStatus_PLC1.skbm2_tripStatus;
                        if (Program.danhSachAlarm.almItem_skbm2_tripStatus.value != Program.danhSachAlarm.almItem_skbm2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_skbm2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.entityName = "SKBM2";
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_skbm2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.date = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.time = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.description = "Lỗi quá tải thiết bị 'SKBM2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_skbm2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_skbm2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_skbm2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_skbm2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_skbm2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của SKBM2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của SKBM2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của SKBM2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem skbm2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm2_genAlarm.id = Program.danhSachAlarm.almItem_skbm2_tripStatus.id;
                                    skbm2_genAlarm.entityName = "SKBM2";
                                    skbm2_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp;
                                    skbm2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm2_tripStatus.activeStatus;
                                    skbm2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment;
                                    skbm2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm2_genAlarm.status = Program.danhSachAlarm.almItem_skbm2_tripStatus.status;
                                    skbm2_genAlarm.description = Program.danhSachAlarm.almItem_skbm2_tripStatus.description;

                                    var l3 = (skbm2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem skbm2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm2_genAlarm.id = Program.danhSachAlarm.almItem_skbm2_tripStatus.id;
                                    skbm2_genAlarm.entityName = "SKBM2";
                                    skbm2_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp;
                                    skbm2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm2_tripStatus.activeStatus;
                                    skbm2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment;
                                    skbm2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm2_genAlarm.status = Program.danhSachAlarm.almItem_skbm2_tripStatus.status;
                                    skbm2_genAlarm.description = Program.danhSachAlarm.almItem_skbm2_tripStatus.description;

                                    var l3 = (skbm2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_skbm2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_skbm2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_skbm2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_skbm2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_skbm2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_skbm2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SKBM3
                        Program.danhSachAlarm.almItem_skbm3_tripStatus.value = Program.InputStatus_PLC1.skbm3_tripStatus;
                        if (Program.danhSachAlarm.almItem_skbm3_tripStatus.value != Program.danhSachAlarm.almItem_skbm3_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_skbm3_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.entityName = "SKBM3";
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_skbm3_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.date = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.time = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.description = "Lỗi quá tải thiết bị 'SKBM3'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_skbm3_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_skbm3_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_skbm3_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_skbm3_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_skbm3_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của skbm3
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của skbm3
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của skbm3
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem skbm3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm3_genAlarm.id = Program.danhSachAlarm.almItem_skbm3_tripStatus.id;
                                    skbm3_genAlarm.entityName = "SKBM3";
                                    skbm3_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp;
                                    skbm3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm3_tripStatus.activeStatus;
                                    skbm3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment;
                                    skbm3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm3_genAlarm.status = Program.danhSachAlarm.almItem_skbm3_tripStatus.status;
                                    skbm3_genAlarm.description = Program.danhSachAlarm.almItem_skbm3_tripStatus.description;

                                    var l3 = (skbm3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem skbm3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    skbm3_genAlarm.id = Program.danhSachAlarm.almItem_skbm3_tripStatus.id;
                                    skbm3_genAlarm.entityName = "SKBM3";
                                    skbm3_genAlarm.timestamp = Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp;
                                    skbm3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_skbm3_tripStatus.activeStatus;
                                    skbm3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    skbm3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment;
                                    skbm3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    skbm3_genAlarm.status = Program.danhSachAlarm.almItem_skbm3_tripStatus.status;
                                    skbm3_genAlarm.description = Program.danhSachAlarm.almItem_skbm3_tripStatus.description;

                                    var l3 = (skbm3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_skbm3_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm3_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_skbm3_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm3_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_skbm3_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_skbm3_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_skbm3_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_skbm3_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_skbm3_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_skbm3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_skbm3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_skbm3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_skbm3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_skbm3_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region ĐỊNH LƯỢNG AXIT - GD1
                        Program.danhSachAlarm.almItem_dlAxit_tripStatus.value = Program.InputStatus_PLC1.dlAxit_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlAxit_tripStatus.value != Program.danhSachAlarm.almItem_dlAxit_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlAxit_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.entityName = "DL_AXIT-GD1";
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.date = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.time = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.description = "Lỗi quá tải thiết bị 'DL_AXIT-GD1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlAxit_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlAxit_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlAxit_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlAxit_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlAxit_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlAxit
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlAxit
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlAxit
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlAxit_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlAxit_genAlarm.id = Program.danhSachAlarm.almItem_dlAxit_tripStatus.id;
                                    dlAxit_genAlarm.entityName = "DL_AXIT-GD1";
                                    dlAxit_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp;
                                    dlAxit_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlAxit_tripStatus.activeStatus;
                                    dlAxit_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlAxit_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment;
                                    dlAxit_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlAxit_genAlarm.status = Program.danhSachAlarm.almItem_dlAxit_tripStatus.status;
                                    dlAxit_genAlarm.description = Program.danhSachAlarm.almItem_dlAxit_tripStatus.description;

                                    var l3 = (dlAxit_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlAxit_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlAxit_genAlarm.id = Program.danhSachAlarm.almItem_dlAxit_tripStatus.id;
                                    dlAxit_genAlarm.entityName = "DL_AXIT-GD1";
                                    dlAxit_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp;
                                    dlAxit_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlAxit_tripStatus.activeStatus;
                                    dlAxit_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlAxit_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment;
                                    dlAxit_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlAxit_genAlarm.status = Program.danhSachAlarm.almItem_dlAxit_tripStatus.status;
                                    dlAxit_genAlarm.description = Program.danhSachAlarm.almItem_dlAxit_tripStatus.description;

                                    var l3 = (dlAxit_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlAxit_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlAxit_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlAxit_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlAxit_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlAxit_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlAxit_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlAxit_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlAxit_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlAxit_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlAxit_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlAxit_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlAxit_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlAxit_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlAxit_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlAxit_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlAxit_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-02
                        Program.danhSachAlarm.almItem_dlXut_tripStatus.value = Program.InputStatus_PLC1.dlXut_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlXut_tripStatus.value != Program.danhSachAlarm.almItem_dlXut_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlXut_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.entityName = "DP-02";
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlXut_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.date = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.time = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.description = "Lỗi quá tải thiết bị 'DP-02'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlXut_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlXut_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlXut_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlXut_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlXut_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlXut
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlXut_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_tripStatus.id;
                                    dlXut_genAlarm.entityName = "DP-02";
                                    dlXut_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp;
                                    dlXut_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_tripStatus.activeStatus;
                                    dlXut_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment;
                                    dlXut_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_tripStatus.status;
                                    dlXut_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_tripStatus.description;

                                    var l3 = (dlXut_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlXut_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_tripStatus.id;
                                    dlXut_genAlarm.entityName = "DP-02";
                                    dlXut_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp;
                                    dlXut_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_tripStatus.activeStatus;
                                    dlXut_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment;
                                    dlXut_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_tripStatus.status;
                                    dlXut_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_tripStatus.description;

                                    var l3 = (dlXut_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlXut_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlXut_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlXut_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlXut_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlXut_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlXut_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-03
                        Program.danhSachAlarm.almItem_dlNp_tripStatus.value = Program.InputStatus_PLC1.dlNp_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlNp_tripStatus.value != Program.danhSachAlarm.almItem_dlNp_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlNp_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.entityName = "DP-03";
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlNp_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.date = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.time = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.description = "Lỗi quá tải thiết bị 'DP-03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlNp_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlNp_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlNp_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlNp_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlNp_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlNp
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlNp
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlNp
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlNp_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlNp_genAlarm.id = Program.danhSachAlarm.almItem_dlNp_tripStatus.id;
                                    dlNp_genAlarm.entityName = "DP-03";
                                    dlNp_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp;
                                    dlNp_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlNp_tripStatus.activeStatus;
                                    dlNp_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlNp_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment;
                                    dlNp_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlNp_genAlarm.status = Program.danhSachAlarm.almItem_dlNp_tripStatus.status;
                                    dlNp_genAlarm.description = Program.danhSachAlarm.almItem_dlNp_tripStatus.description;

                                    var l3 = (dlNp_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlNp_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlNp_genAlarm.id = Program.danhSachAlarm.almItem_dlNp_tripStatus.id;
                                    dlNp_genAlarm.entityName = "DP-03";
                                    dlNp_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp;
                                    dlNp_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlNp_tripStatus.activeStatus;
                                    dlNp_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlNp_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment;
                                    dlNp_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlNp_genAlarm.status = Program.danhSachAlarm.almItem_dlNp_tripStatus.status;
                                    dlNp_genAlarm.description = Program.danhSachAlarm.almItem_dlNp_tripStatus.description;

                                    var l3 = (dlNp_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlNp_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlNp_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlNp_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlNp_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlNp_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlNp_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlNp_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlNp_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlNp_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlNp_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlNp_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlNp_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlNp_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlNp_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlNp_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlNp_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlNp_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-04
                        Program.danhSachAlarm.almItem_dlClo_tripStatus.value = Program.InputStatus_PLC1.dlClo_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlClo_tripStatus.value != Program.danhSachAlarm.almItem_dlClo_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlClo_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.entityName = "DP-04";
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlClo_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.date = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.time = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.description = "Lỗi quá tải thiết bị 'DP-04'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlClo_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlClo_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlClo_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlClo_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlClo_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlClo
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlClo
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlClo
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlClo_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlClo_genAlarm.id = Program.danhSachAlarm.almItem_dlClo_tripStatus.id;
                                    dlClo_genAlarm.entityName = "DP-04";
                                    dlClo_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp;
                                    dlClo_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlClo_tripStatus.activeStatus;
                                    dlClo_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlClo_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment;
                                    dlClo_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlClo_genAlarm.status = Program.danhSachAlarm.almItem_dlClo_tripStatus.status;
                                    dlClo_genAlarm.description = Program.danhSachAlarm.almItem_dlClo_tripStatus.description;

                                    var l3 = (dlClo_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlClo_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlClo_genAlarm.id = Program.danhSachAlarm.almItem_dlClo_tripStatus.id;
                                    dlClo_genAlarm.entityName = "DP-04";
                                    dlClo_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp;
                                    dlClo_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlClo_tripStatus.activeStatus;
                                    dlClo_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlClo_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment;
                                    dlClo_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlClo_genAlarm.status = Program.danhSachAlarm.almItem_dlClo_tripStatus.status;
                                    dlClo_genAlarm.description = Program.danhSachAlarm.almItem_dlClo_tripStatus.description;

                                    var l3 = (dlClo_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlClo_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlClo_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlClo_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlClo_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlClo_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlClo_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlClo_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlClo_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlClo_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlClo_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlClo_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlClo_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlClo_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlClo_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlClo_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlClo_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlClo_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-05
                        Program.danhSachAlarm.almItem_dlPac_tripStatus.value = Program.InputStatus_PLC1.dlPac_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPac_tripStatus.value != Program.danhSachAlarm.almItem_dlPac_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPac_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.entityName = "DP-05";
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPac_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.date = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.time = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.description = "Lỗi quá tải thiết bị 'DP-05'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPac_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPac_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPac_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPac_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPac_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPac
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPac
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPac
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPac_genAlarm.id = Program.danhSachAlarm.almItem_dlPac_tripStatus.id;
                                    dlPac_genAlarm.entityName = "DP-05";
                                    dlPac_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp;
                                    dlPac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPac_tripStatus.activeStatus;
                                    dlPac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment;
                                    dlPac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPac_genAlarm.status = Program.danhSachAlarm.almItem_dlPac_tripStatus.status;
                                    dlPac_genAlarm.description = Program.danhSachAlarm.almItem_dlPac_tripStatus.description;

                                    var l3 = (dlPac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPac_genAlarm.id = Program.danhSachAlarm.almItem_dlPac_tripStatus.id;
                                    dlPac_genAlarm.entityName = "DP-05";
                                    dlPac_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp;
                                    dlPac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPac_tripStatus.activeStatus;
                                    dlPac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment;
                                    dlPac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPac_genAlarm.status = Program.danhSachAlarm.almItem_dlPac_tripStatus.status;
                                    dlPac_genAlarm.description = Program.danhSachAlarm.almItem_dlPac_tripStatus.description;

                                    var l3 = (dlPac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPac_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPac_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPac_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPac_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPac_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPac_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPac_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPac_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPac_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPac_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-05
                        Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.value = Program.InputStatus_PLC1.dlPolyme1_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.value != Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.entityName = "DP-06-1";
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.date = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.time = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description = "Lỗi quá tải thiết bị 'DP-06-1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPolyme1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPolyme1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme1_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id;
                                    dlPolyme1_genAlarm.entityName = "DP-06-1";
                                    dlPolyme1_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp;
                                    dlPolyme1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.activeStatus;
                                    dlPolyme1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment;
                                    dlPolyme1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme1_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status;
                                    dlPolyme1_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description;

                                    var l3 = (dlPolyme1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPolyme1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme1_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id;
                                    dlPolyme1_genAlarm.entityName = "DP-06-1";
                                    dlPolyme1_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp;
                                    dlPolyme1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.activeStatus;
                                    dlPolyme1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment;
                                    dlPolyme1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme1_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status;
                                    dlPolyme1_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description;

                                    var l3 = (dlPolyme1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-06-1
                        Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.value = Program.InputStatus_PLC1.dlPolyme2_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.value != Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.entityName = "DP-06-2";
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.date = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.time = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description = "Lỗi quá tải thiết bị 'DP-06-2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPolyme2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPolyme2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme2_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id;
                                    dlPolyme2_genAlarm.entityName = "DP-06-2";
                                    dlPolyme2_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp;
                                    dlPolyme2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.activeStatus;
                                    dlPolyme2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment;
                                    dlPolyme2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme2_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status;
                                    dlPolyme2_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description;

                                    var l3 = (dlPolyme2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPolyme2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme2_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id;
                                    dlPolyme2_genAlarm.entityName = "DP-06-2";
                                    dlPolyme2_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp;
                                    dlPolyme2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.activeStatus;
                                    dlPolyme2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment;
                                    dlPolyme2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme2_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status;
                                    dlPolyme2_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description;

                                    var l3 = (dlPolyme2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-03
                        Program.danhSachAlarm.almItem_khuayNp_tripStatus.value = Program.InputStatus_PLC1.khuayNp_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayNp_tripStatus.value != Program.danhSachAlarm.almItem_khuayNp_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayNp_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.entityName = "MT-03";
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.date = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.time = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.description = "Lỗi quá tải thiết bị 'MT-03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayNp_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayNp_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayNp_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayNp_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayNp_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayNp
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayNp
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayNp
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayNp_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayNp_genAlarm.id = Program.danhSachAlarm.almItem_khuayNp_tripStatus.id;
                                    khuayNp_genAlarm.entityName = "MT-03";
                                    khuayNp_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp;
                                    khuayNp_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayNp_tripStatus.activeStatus;
                                    khuayNp_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayNp_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment;
                                    khuayNp_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayNp_genAlarm.status = Program.danhSachAlarm.almItem_khuayNp_tripStatus.status;
                                    khuayNp_genAlarm.description = Program.danhSachAlarm.almItem_khuayNp_tripStatus.description;

                                    var l3 = (khuayNp_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayNp_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayNp_genAlarm.id = Program.danhSachAlarm.almItem_khuayNp_tripStatus.id;
                                    khuayNp_genAlarm.entityName = "MT-03";
                                    khuayNp_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp;
                                    khuayNp_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayNp_tripStatus.activeStatus;
                                    khuayNp_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayNp_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment;
                                    khuayNp_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayNp_genAlarm.status = Program.danhSachAlarm.almItem_khuayNp_tripStatus.status;
                                    khuayNp_genAlarm.description = Program.danhSachAlarm.almItem_khuayNp_tripStatus.description;

                                    var l3 = (khuayNp_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayNp_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayNp_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayNp_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayNp_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayNp_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayNp_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayNp_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayNp_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayNp_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayNp_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayNp_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayNp_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayNp_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayNp_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayNp_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayNp_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-04
                        Program.danhSachAlarm.almItem_khuayClo_tripStatus.value = Program.InputStatus_PLC1.khuayClo_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayClo_tripStatus.value != Program.danhSachAlarm.almItem_khuayClo_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayClo_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.entityName = "MT-04";
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.date = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.time = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.description = "Lỗi quá tải thiết bị 'MT-04'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayClo_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayClo_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayClo_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayClo_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayClo_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayClo
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayClo
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayClo
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayClo_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayClo_genAlarm.id = Program.danhSachAlarm.almItem_khuayClo_tripStatus.id;
                                    khuayClo_genAlarm.entityName = "MT-04";
                                    khuayClo_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp;
                                    khuayClo_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayClo_tripStatus.activeStatus;
                                    khuayClo_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayClo_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment;
                                    khuayClo_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayClo_genAlarm.status = Program.danhSachAlarm.almItem_khuayClo_tripStatus.status;
                                    khuayClo_genAlarm.description = Program.danhSachAlarm.almItem_khuayClo_tripStatus.description;

                                    var l3 = (khuayClo_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayClo_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayClo_genAlarm.id = Program.danhSachAlarm.almItem_khuayClo_tripStatus.id;
                                    khuayClo_genAlarm.entityName = "MT-04";
                                    khuayClo_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp;
                                    khuayClo_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayClo_tripStatus.activeStatus;
                                    khuayClo_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayClo_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment;
                                    khuayClo_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayClo_genAlarm.status = Program.danhSachAlarm.almItem_khuayClo_tripStatus.status;
                                    khuayClo_genAlarm.description = Program.danhSachAlarm.almItem_khuayClo_tripStatus.description;

                                    var l3 = (khuayClo_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayClo_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayClo_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayClo_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayClo_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayClo_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayClo_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayClo_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayClo_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayClo_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayClo_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayClo_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayClo_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayClo_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayClo_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayClo_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayClo_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-05
                        Program.danhSachAlarm.almItem_khuayPac_tripStatus.value = Program.InputStatus_PLC1.khuayPac_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayPac_tripStatus.value != Program.danhSachAlarm.almItem_khuayPac_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayPac_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.entityName = "MT-05";
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.date = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.time = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.description = "Lỗi quá tải thiết bị 'MT-05'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayPac_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayPac_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayPac_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayPac_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayPac_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPac
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPac
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayPac
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayPac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPac_genAlarm.id = Program.danhSachAlarm.almItem_khuayPac_tripStatus.id;
                                    khuayPac_genAlarm.entityName = "MT-05";
                                    khuayPac_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp;
                                    khuayPac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPac_tripStatus.activeStatus;
                                    khuayPac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment;
                                    khuayPac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPac_genAlarm.status = Program.danhSachAlarm.almItem_khuayPac_tripStatus.status;
                                    khuayPac_genAlarm.description = Program.danhSachAlarm.almItem_khuayPac_tripStatus.description;

                                    var l3 = (khuayPac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayPac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPac_genAlarm.id = Program.danhSachAlarm.almItem_khuayPac_tripStatus.id;
                                    khuayPac_genAlarm.entityName = "MT-05";
                                    khuayPac_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp;
                                    khuayPac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPac_tripStatus.activeStatus;
                                    khuayPac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment;
                                    khuayPac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPac_genAlarm.status = Program.danhSachAlarm.almItem_khuayPac_tripStatus.status;
                                    khuayPac_genAlarm.description = Program.danhSachAlarm.almItem_khuayPac_tripStatus.description;

                                    var l3 = (khuayPac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayPac_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPac_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayPac_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPac_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayPac_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayPac_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayPac_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPac_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPac_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-06-1
                        Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.value = Program.InputStatus_PLC1.khuayPolyme1_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.value != Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.entityName = "MT-06-1";
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.date = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.time = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description = "Lỗi quá tải thiết bị 'MT-06-1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPolyme1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPolyme1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayPolyme1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayPolyme1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPolyme1_genAlarm.id = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id;
                                    khuayPolyme1_genAlarm.entityName = "MT-06-1";
                                    khuayPolyme1_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp;
                                    khuayPolyme1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.activeStatus;
                                    khuayPolyme1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPolyme1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment;
                                    khuayPolyme1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPolyme1_genAlarm.status = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status;
                                    khuayPolyme1_genAlarm.description = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description;

                                    var l3 = (khuayPolyme1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayPolyme1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPolyme1_genAlarm.id = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id;
                                    khuayPolyme1_genAlarm.entityName = "MT-06-1";
                                    khuayPolyme1_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp;
                                    khuayPolyme1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.activeStatus;
                                    khuayPolyme1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPolyme1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment;
                                    khuayPolyme1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPolyme1_genAlarm.status = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status;
                                    khuayPolyme1_genAlarm.description = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description;

                                    var l3 = (khuayPolyme1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPolyme1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-06-2
                        Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.value = Program.InputStatus_PLC1.khuayPolyme2_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.value != Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.entityName = "MT-06-2";
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.date = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.time = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description = "Lỗi quá tải thiết bị 'MT-06-2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPolyme2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPolyme2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayPolyme2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayPolyme2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPolyme2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id;
                                    khuayPolyme2_genAlarm.entityName = "MT-06-2";
                                    khuayPolyme2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp;
                                    khuayPolyme2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.activeStatus;
                                    khuayPolyme2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPolyme2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment;
                                    khuayPolyme2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPolyme2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status;
                                    khuayPolyme2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description;

                                    var l3 = (khuayPolyme2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayPolyme2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPolyme2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id;
                                    khuayPolyme2_genAlarm.entityName = "MT-06-2";
                                    khuayPolyme2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp;
                                    khuayPolyme2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.activeStatus;
                                    khuayPolyme2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPolyme2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment;
                                    khuayPolyme2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPolyme2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status;
                                    khuayPolyme2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description;

                                    var l3 = (khuayPolyme2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPolyme2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-01
                        Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.value = Program.InputStatus_PLC1.khuayKeoTu_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.value != Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.entityName = "MT-01";
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.date = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.time = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description = "Lỗi quá tải thiết bị 'MT-01'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayKeoTu
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayKeoTu
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayKeoTu
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayKeoTu_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayKeoTu_genAlarm.id = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id;
                                    khuayKeoTu_genAlarm.entityName = "MT-01";
                                    khuayKeoTu_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp;
                                    khuayKeoTu_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.activeStatus;
                                    khuayKeoTu_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayKeoTu_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment;
                                    khuayKeoTu_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayKeoTu_genAlarm.status = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status;
                                    khuayKeoTu_genAlarm.description = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description;

                                    var l3 = (khuayKeoTu_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayKeoTu_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayKeoTu_genAlarm.id = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id;
                                    khuayKeoTu_genAlarm.entityName = "MT-01";
                                    khuayKeoTu_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp;
                                    khuayKeoTu_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.activeStatus;
                                    khuayKeoTu_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayKeoTu_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment;
                                    khuayKeoTu_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayKeoTu_genAlarm.status = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status;
                                    khuayKeoTu_genAlarm.description = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description;

                                    var l3 = (khuayKeoTu_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayKeoTu_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-02A
                        Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.value = Program.InputStatus_PLC1.khuayTaoBong1_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.value != Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.entityName = "MT-02A";
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.date = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.time = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description = "Lỗi quá tải thiết bị 'MT-02A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayTaoBong1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayTaoBong1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong1_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id;
                                    khuayTaoBong1_genAlarm.entityName = "MT-02A";
                                    khuayTaoBong1_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp;
                                    khuayTaoBong1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.activeStatus;
                                    khuayTaoBong1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment;
                                    khuayTaoBong1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong1_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status;
                                    khuayTaoBong1_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description;

                                    var l3 = (khuayTaoBong1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayTaoBong1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong1_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id;
                                    khuayTaoBong1_genAlarm.entityName = "MT-02A";
                                    khuayTaoBong1_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp;
                                    khuayTaoBong1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.activeStatus;
                                    khuayTaoBong1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment;
                                    khuayTaoBong1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong1_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status;
                                    khuayTaoBong1_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description;

                                    var l3 = (khuayTaoBong1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-02B
                        Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.value = Program.InputStatus_PLC1.khuayTaoBong2_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.value != Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.entityName = "MT-02B";
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.date = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.time = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description = "Lỗi quá tải thiết bị 'MT-02B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayTaoBong2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayTaoBong2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong2_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id;
                                    khuayTaoBong2_genAlarm.entityName = "MT-02B";
                                    khuayTaoBong2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp;
                                    khuayTaoBong2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.activeStatus;
                                    khuayTaoBong2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment;
                                    khuayTaoBong2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong2_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status;
                                    khuayTaoBong2_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description;

                                    var l3 = (khuayTaoBong2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayTaoBong2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong2_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id;
                                    khuayTaoBong2_genAlarm.entityName = "MT-02B";
                                    khuayTaoBong2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp;
                                    khuayTaoBong2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.activeStatus;
                                    khuayTaoBong2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment;
                                    khuayTaoBong2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong2_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status;
                                    khuayTaoBong2_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description;

                                    var l3 = (khuayTaoBong2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region GGB
                        Program.danhSachAlarm.almItem_motorGatBun_tripStatus.value = Program.InputStatus_PLC1.motorGatBun_tripStatus;
                        if (Program.danhSachAlarm.almItem_motorGatBun_tripStatus.value != Program.danhSachAlarm.almItem_motorGatBun_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_motorGatBun_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.entityName = "GGB";
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.date = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.time = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description = "Lỗi quá tải thiết bị 'GGB'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của motorGatBun
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của motorGatBun
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của motorGatBun
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem motorGatBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    motorGatBun_genAlarm.id = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id;
                                    motorGatBun_genAlarm.entityName = "GGB";
                                    motorGatBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp;
                                    motorGatBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.activeStatus;
                                    motorGatBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    motorGatBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment;
                                    motorGatBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    motorGatBun_genAlarm.status = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status;
                                    motorGatBun_genAlarm.description = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description;

                                    var l3 = (motorGatBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem motorGatBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    motorGatBun_genAlarm.id = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id;
                                    motorGatBun_genAlarm.entityName = "GGB";
                                    motorGatBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp;
                                    motorGatBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.activeStatus;
                                    motorGatBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    motorGatBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment;
                                    motorGatBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    motorGatBun_genAlarm.status = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status;
                                    motorGatBun_genAlarm.description = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description;

                                    var l3 = (motorGatBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_motorGatBun_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_motorGatBun_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_motorGatBun_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_motorGatBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_motorGatBun_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM01
                        Program.danhSachAlarm.almItem_anoxic1_tripStatus.value = Program.InputStatus_PLC2.anoxic1_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic1_tripStatus.value != Program.danhSachAlarm.almItem_anoxic1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.entityName = "SM01";
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.date = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.time = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.description = "Lỗi quá tải thiết bị 'SM01'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic1_genAlarm.id = Program.danhSachAlarm.almItem_anoxic1_tripStatus.id;
                                    anoxic1_genAlarm.entityName = "SM01";
                                    anoxic1_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp;
                                    anoxic1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic1_tripStatus.activeStatus;
                                    anoxic1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment;
                                    anoxic1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic1_genAlarm.status = Program.danhSachAlarm.almItem_anoxic1_tripStatus.status;
                                    anoxic1_genAlarm.description = Program.danhSachAlarm.almItem_anoxic1_tripStatus.description;

                                    var l3 = (anoxic1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic1_genAlarm.id = Program.danhSachAlarm.almItem_anoxic1_tripStatus.id;
                                    anoxic1_genAlarm.entityName = "SM01";
                                    anoxic1_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp;
                                    anoxic1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic1_tripStatus.activeStatus;
                                    anoxic1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment;
                                    anoxic1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic1_genAlarm.status = Program.danhSachAlarm.almItem_anoxic1_tripStatus.status;
                                    anoxic1_genAlarm.description = Program.danhSachAlarm.almItem_anoxic1_tripStatus.description;

                                    var l3 = (anoxic1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM02
                        Program.danhSachAlarm.almItem_anoxic2_tripStatus.value = Program.InputStatus_PLC2.anoxic2_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic2_tripStatus.value != Program.danhSachAlarm.almItem_anoxic2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.entityName = "SM02";
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.date = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.time = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.description = "Lỗi quá tải thiết bị 'SM02'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic2_genAlarm.id = Program.danhSachAlarm.almItem_anoxic2_tripStatus.id;
                                    anoxic2_genAlarm.entityName = "SM02";
                                    anoxic2_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp;
                                    anoxic2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic2_tripStatus.activeStatus;
                                    anoxic2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment;
                                    anoxic2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic2_genAlarm.status = Program.danhSachAlarm.almItem_anoxic2_tripStatus.status;
                                    anoxic2_genAlarm.description = Program.danhSachAlarm.almItem_anoxic2_tripStatus.description;

                                    var l3 = (anoxic2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic2_genAlarm.id = Program.danhSachAlarm.almItem_anoxic2_tripStatus.id;
                                    anoxic2_genAlarm.entityName = "SM02";
                                    anoxic2_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp;
                                    anoxic2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic2_tripStatus.activeStatus;
                                    anoxic2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment;
                                    anoxic2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic2_genAlarm.status = Program.danhSachAlarm.almItem_anoxic2_tripStatus.status;
                                    anoxic2_genAlarm.description = Program.danhSachAlarm.almItem_anoxic2_tripStatus.description;

                                    var l3 = (anoxic2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM03
                        Program.danhSachAlarm.almItem_anoxic3_tripStatus.value = Program.InputStatus_PLC2.anoxic3_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic3_tripStatus.value != Program.danhSachAlarm.almItem_anoxic3_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic3_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.entityName = "SM03";
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.date = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.time = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.description = "Lỗi quá tải thiết bị 'SM03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic3_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic3_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic3_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic3_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic3_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic3
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic3
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic3
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic3_genAlarm.id = Program.danhSachAlarm.almItem_anoxic3_tripStatus.id;
                                    anoxic3_genAlarm.entityName = "SM03";
                                    anoxic3_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp;
                                    anoxic3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic3_tripStatus.activeStatus;
                                    anoxic3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment;
                                    anoxic3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic3_genAlarm.status = Program.danhSachAlarm.almItem_anoxic3_tripStatus.status;
                                    anoxic3_genAlarm.description = Program.danhSachAlarm.almItem_anoxic3_tripStatus.description;

                                    var l3 = (anoxic3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic3_genAlarm.id = Program.danhSachAlarm.almItem_anoxic3_tripStatus.id;
                                    anoxic3_genAlarm.entityName = "SM03";
                                    anoxic3_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp;
                                    anoxic3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic3_tripStatus.activeStatus;
                                    anoxic3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment;
                                    anoxic3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic3_genAlarm.status = Program.danhSachAlarm.almItem_anoxic3_tripStatus.status;
                                    anoxic3_genAlarm.description = Program.danhSachAlarm.almItem_anoxic3_tripStatus.description;

                                    var l3 = (anoxic3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic3_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic3_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic3_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic3_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic3_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic3_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic3_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic3_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic3_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM04
                        Program.danhSachAlarm.almItem_anoxic4_tripStatus.value = Program.InputStatus_PLC2.anoxic4_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic4_tripStatus.value != Program.danhSachAlarm.almItem_anoxic4_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic4_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.entityName = "SM04";
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.date = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.time = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.description = "Lỗi quá tải thiết bị 'SM04'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic4_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic4_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic4_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic4_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic4_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic4
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic4
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic4
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic4_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic4_genAlarm.id = Program.danhSachAlarm.almItem_anoxic4_tripStatus.id;
                                    anoxic4_genAlarm.entityName = "SM04";
                                    anoxic4_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp;
                                    anoxic4_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic4_tripStatus.activeStatus;
                                    anoxic4_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic4_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment;
                                    anoxic4_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic4_genAlarm.status = Program.danhSachAlarm.almItem_anoxic4_tripStatus.status;
                                    anoxic4_genAlarm.description = Program.danhSachAlarm.almItem_anoxic4_tripStatus.description;

                                    var l3 = (anoxic4_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic4_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic4_genAlarm.id = Program.danhSachAlarm.almItem_anoxic4_tripStatus.id;
                                    anoxic4_genAlarm.entityName = "SM04";
                                    anoxic4_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp;
                                    anoxic4_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic4_tripStatus.activeStatus;
                                    anoxic4_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic4_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment;
                                    anoxic4_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic4_genAlarm.status = Program.danhSachAlarm.almItem_anoxic4_tripStatus.status;
                                    anoxic4_genAlarm.description = Program.danhSachAlarm.almItem_anoxic4_tripStatus.description;

                                    var l3 = (anoxic4_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic4_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic4_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic4_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic4_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic4_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic4_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic4_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic4_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic4_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic4_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic4_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic4_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic4_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic4_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic4_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic4_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM05
                        Program.danhSachAlarm.almItem_anoxic5_tripStatus.value = Program.InputStatus_PLC2.anoxic5_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic5_tripStatus.value != Program.danhSachAlarm.almItem_anoxic5_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic5_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.entityName = "SM05";
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.date = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.time = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.description = "Lỗi quá tải thiết bị 'SM05'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic5_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic5_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic5_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic5_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic5_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic5
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic5
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic5
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic5_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic5_genAlarm.id = Program.danhSachAlarm.almItem_anoxic5_tripStatus.id;
                                    anoxic5_genAlarm.entityName = "SM05";
                                    anoxic5_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp;
                                    anoxic5_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic5_tripStatus.activeStatus;
                                    anoxic5_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic5_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment;
                                    anoxic5_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic5_genAlarm.status = Program.danhSachAlarm.almItem_anoxic5_tripStatus.status;
                                    anoxic5_genAlarm.description = Program.danhSachAlarm.almItem_anoxic5_tripStatus.description;

                                    var l3 = (anoxic5_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic5_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic5_genAlarm.id = Program.danhSachAlarm.almItem_anoxic5_tripStatus.id;
                                    anoxic5_genAlarm.entityName = "SM05";
                                    anoxic5_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp;
                                    anoxic5_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic5_tripStatus.activeStatus;
                                    anoxic5_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic5_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment;
                                    anoxic5_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic5_genAlarm.status = Program.danhSachAlarm.almItem_anoxic5_tripStatus.status;
                                    anoxic5_genAlarm.description = Program.danhSachAlarm.almItem_anoxic5_tripStatus.description;

                                    var l3 = (anoxic5_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic5_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic5_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic5_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic5_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic5_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic5_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic5_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic5_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic5_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic5_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic5_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic5_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic5_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic5_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic5_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic5_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM06
                        Program.danhSachAlarm.almItem_anoxic6_tripStatus.value = Program.InputStatus_PLC2.anoxic6_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic6_tripStatus.value != Program.danhSachAlarm.almItem_anoxic6_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic6_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.entityName = "SM06";
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.date = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.time = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.description = "Lỗi quá tải thiết bị 'SM06'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic6_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic6_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic6_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic6_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic6_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic6
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic6
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic6
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic6_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic6_genAlarm.id = Program.danhSachAlarm.almItem_anoxic6_tripStatus.id;
                                    anoxic6_genAlarm.entityName = "SM06";
                                    anoxic6_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp;
                                    anoxic6_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic6_tripStatus.activeStatus;
                                    anoxic6_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic6_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment;
                                    anoxic6_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic6_genAlarm.status = Program.danhSachAlarm.almItem_anoxic6_tripStatus.status;
                                    anoxic6_genAlarm.description = Program.danhSachAlarm.almItem_anoxic6_tripStatus.description;

                                    var l3 = (anoxic6_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic6_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic6_genAlarm.id = Program.danhSachAlarm.almItem_anoxic6_tripStatus.id;
                                    anoxic6_genAlarm.entityName = "SM06";
                                    anoxic6_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp;
                                    anoxic6_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic6_tripStatus.activeStatus;
                                    anoxic6_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic6_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment;
                                    anoxic6_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic6_genAlarm.status = Program.danhSachAlarm.almItem_anoxic6_tripStatus.status;
                                    anoxic6_genAlarm.description = Program.danhSachAlarm.almItem_anoxic6_tripStatus.description;

                                    var l3 = (anoxic6_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic6_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic6_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic6_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic6_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic6_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic6_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic6_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic6_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic6_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic6_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic6_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic6_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic6_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic6_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic6_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic6_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM07
                        Program.danhSachAlarm.almItem_anoxic7_tripStatus.value = Program.InputStatus_PLC2.anoxic7_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic7_tripStatus.value != Program.danhSachAlarm.almItem_anoxic7_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic7_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.entityName = "SM07";
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.date = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.time = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.description = "Lỗi quá tải thiết bị 'SM07'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic7_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic7_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic7_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic7_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic7_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic7
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic7
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic7
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic7_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic7_genAlarm.id = Program.danhSachAlarm.almItem_anoxic7_tripStatus.id;
                                    anoxic7_genAlarm.entityName = "SM07";
                                    anoxic7_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp;
                                    anoxic7_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic7_tripStatus.activeStatus;
                                    anoxic7_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic7_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment;
                                    anoxic7_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic7_genAlarm.status = Program.danhSachAlarm.almItem_anoxic7_tripStatus.status;
                                    anoxic7_genAlarm.description = Program.danhSachAlarm.almItem_anoxic7_tripStatus.description;

                                    var l3 = (anoxic7_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic7_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic7_genAlarm.id = Program.danhSachAlarm.almItem_anoxic7_tripStatus.id;
                                    anoxic7_genAlarm.entityName = "SM07";
                                    anoxic7_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp;
                                    anoxic7_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic7_tripStatus.activeStatus;
                                    anoxic7_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic7_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment;
                                    anoxic7_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic7_genAlarm.status = Program.danhSachAlarm.almItem_anoxic7_tripStatus.status;
                                    anoxic7_genAlarm.description = Program.danhSachAlarm.almItem_anoxic7_tripStatus.description;

                                    var l3 = (anoxic7_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic7_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic7_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic7_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic7_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic7_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic7_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic7_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic7_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic7_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic7_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic7_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic7_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic7_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic7_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic7_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic7_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SM08
                        Program.danhSachAlarm.almItem_anoxic8_tripStatus.value = Program.InputStatus_PLC2.anoxic8_tripStatus;
                        if (Program.danhSachAlarm.almItem_anoxic8_tripStatus.value != Program.danhSachAlarm.almItem_anoxic8_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_anoxic8_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.entityName = "SM08";
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.date = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.time = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.description = "Lỗi quá tải thiết bị 'SM08'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_anoxic8_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_anoxic8_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_anoxic8_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_anoxic8_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_anoxic8_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic8
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của anoxic8
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của anoxic8
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem anoxic8_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic8_genAlarm.id = Program.danhSachAlarm.almItem_anoxic8_tripStatus.id;
                                    anoxic8_genAlarm.entityName = "SM08";
                                    anoxic8_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp;
                                    anoxic8_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic8_tripStatus.activeStatus;
                                    anoxic8_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic8_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment;
                                    anoxic8_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic8_genAlarm.status = Program.danhSachAlarm.almItem_anoxic8_tripStatus.status;
                                    anoxic8_genAlarm.description = Program.danhSachAlarm.almItem_anoxic8_tripStatus.description;

                                    var l3 = (anoxic8_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem anoxic8_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    anoxic8_genAlarm.id = Program.danhSachAlarm.almItem_anoxic8_tripStatus.id;
                                    anoxic8_genAlarm.entityName = "SM08";
                                    anoxic8_genAlarm.timestamp = Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp;
                                    anoxic8_genAlarm.activeStatus = Program.danhSachAlarm.almItem_anoxic8_tripStatus.activeStatus;
                                    anoxic8_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    anoxic8_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment;
                                    anoxic8_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    anoxic8_genAlarm.status = Program.danhSachAlarm.almItem_anoxic8_tripStatus.status;
                                    anoxic8_genAlarm.description = Program.danhSachAlarm.almItem_anoxic8_tripStatus.description;

                                    var l3 = (anoxic8_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_anoxic8_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic8_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_anoxic8_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic8_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic8_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic8_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic8_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_anoxic8_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_anoxic8_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_anoxic8_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_anoxic8_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_anoxic8_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_anoxic8_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_anoxic8_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_anoxic8_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_anoxic8_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DBETN
                        Program.danhSachAlarm.almItem_etanol1_tripStatus.value = Program.InputStatus_PLC2.etanol1_tripStatus;
                        if (Program.danhSachAlarm.almItem_etanol1_tripStatus.value != Program.danhSachAlarm.almItem_etanol1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_etanol1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.entityName = "DBETN";
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_etanol1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.date = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.time = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.description = "Lỗi quá tải thiết bị 'DBETN'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_etanol1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_etanol1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_etanol1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_etanol1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_etanol1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của etanol1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của etanol1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của etanol1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem etanol1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    etanol1_genAlarm.id = Program.danhSachAlarm.almItem_etanol1_tripStatus.id;
                                    etanol1_genAlarm.entityName = "DBETN";
                                    etanol1_genAlarm.timestamp = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp;
                                    etanol1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_etanol1_tripStatus.activeStatus;
                                    etanol1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    etanol1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment;
                                    etanol1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    etanol1_genAlarm.status = Program.danhSachAlarm.almItem_etanol1_tripStatus.status;
                                    etanol1_genAlarm.description = Program.danhSachAlarm.almItem_etanol1_tripStatus.description;

                                    var l3 = (etanol1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem etanol1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    etanol1_genAlarm.id = Program.danhSachAlarm.almItem_etanol1_tripStatus.id;
                                    etanol1_genAlarm.entityName = "DBETN";
                                    etanol1_genAlarm.timestamp = Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp;
                                    etanol1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_etanol1_tripStatus.activeStatus;
                                    etanol1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    etanol1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment;
                                    etanol1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    etanol1_genAlarm.status = Program.danhSachAlarm.almItem_etanol1_tripStatus.status;
                                    etanol1_genAlarm.description = Program.danhSachAlarm.almItem_etanol1_tripStatus.description;

                                    var l3 = (etanol1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_etanol1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_etanol1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_etanol1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_etanol1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_etanol1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_etanol1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_etanol1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_etanol1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_etanol1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_etanol1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_etanol1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_etanol1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_etanol1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_etanol1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_etanol1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_etanol1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_etanol1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region ETANOL 2: MÃ THIẾT BỊ
                        Program.danhSachAlarm.almItem_etanol2_tripStatus.value = Program.InputStatus_PLC2.etanol2_tripStatus;
                        if (Program.danhSachAlarm.almItem_etanol2_tripStatus.value != Program.danhSachAlarm.almItem_etanol2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_etanol2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.entityName = "DBETN2";
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_etanol2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.date = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.time = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.description = "Lỗi quá tải thiết bị 'DBETN2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_etanol2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_etanol2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_etanol2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_etanol2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_etanol2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của etanol2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của etanol2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của etanol2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem etanol2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    etanol2_genAlarm.id = Program.danhSachAlarm.almItem_etanol2_tripStatus.id;
                                    etanol2_genAlarm.entityName = "DBETN2";
                                    etanol2_genAlarm.timestamp = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp;
                                    etanol2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_etanol2_tripStatus.activeStatus;
                                    etanol2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    etanol2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment;
                                    etanol2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    etanol2_genAlarm.status = Program.danhSachAlarm.almItem_etanol2_tripStatus.status;
                                    etanol2_genAlarm.description = Program.danhSachAlarm.almItem_etanol2_tripStatus.description;

                                    var l3 = (etanol2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem etanol2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    etanol2_genAlarm.id = Program.danhSachAlarm.almItem_etanol2_tripStatus.id;
                                    etanol2_genAlarm.entityName = "DBETN2";
                                    etanol2_genAlarm.timestamp = Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp;
                                    etanol2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_etanol2_tripStatus.activeStatus;
                                    etanol2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    etanol2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment;
                                    etanol2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    etanol2_genAlarm.status = Program.danhSachAlarm.almItem_etanol2_tripStatus.status;
                                    etanol2_genAlarm.description = Program.danhSachAlarm.almItem_etanol2_tripStatus.description;

                                    var l3 = (etanol2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_etanol2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_etanol2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_etanol2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_etanol2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_etanol2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_etanol2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_etanol2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_etanol2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_etanol2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_etanol2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_etanol2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_etanol2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_etanol2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_etanol2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_etanol2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_etanol2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_etanol2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region METATNOL: MÃ THIẾT BỊ
                        Program.danhSachAlarm.almItem_metanol_tripStatus.value = Program.InputStatus_PLC2.metanol_tripStatus;
                        if (Program.danhSachAlarm.almItem_metanol_tripStatus.value != Program.danhSachAlarm.almItem_metanol_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_metanol_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_metanol_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_metanol_tripStatus.entityName = "DLETN";
                                Program.danhSachAlarm.almItem_metanol_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_metanol_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_metanol_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_metanol_tripStatus.date = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_metanol_tripStatus.time = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_metanol_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_metanol_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_metanol_tripStatus.description = "Lỗi quá tải thiết bị 'DLETN'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_metanol_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_metanol_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_metanol_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_metanol_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_metanol_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của metanol
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của metanol
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của metanol
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem metanol_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    metanol_genAlarm.id = Program.danhSachAlarm.almItem_metanol_tripStatus.id;
                                    metanol_genAlarm.entityName = "DLETN";
                                    metanol_genAlarm.timestamp = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp;
                                    metanol_genAlarm.activeStatus = Program.danhSachAlarm.almItem_metanol_tripStatus.activeStatus;
                                    metanol_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    metanol_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment;
                                    metanol_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    metanol_genAlarm.status = Program.danhSachAlarm.almItem_metanol_tripStatus.status;
                                    metanol_genAlarm.description = Program.danhSachAlarm.almItem_metanol_tripStatus.description;

                                    var l3 = (metanol_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem metanol_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    metanol_genAlarm.id = Program.danhSachAlarm.almItem_metanol_tripStatus.id;
                                    metanol_genAlarm.entityName = "DLETN";
                                    metanol_genAlarm.timestamp = Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp;
                                    metanol_genAlarm.activeStatus = Program.danhSachAlarm.almItem_metanol_tripStatus.activeStatus;
                                    metanol_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    metanol_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment;
                                    metanol_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    metanol_genAlarm.status = Program.danhSachAlarm.almItem_metanol_tripStatus.status;
                                    metanol_genAlarm.description = Program.danhSachAlarm.almItem_metanol_tripStatus.description;

                                    var l3 = (metanol_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_metanol_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_metanol_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_metanol_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_metanol_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_metanol_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_metanol_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_metanol_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_metanol_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_metanol_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_metanol_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_metanol_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_metanol_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_metanol_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_metanol_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_metanol_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_metanol_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_metanol_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_metanol_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MKT1
                        Program.danhSachAlarm.almItem_mkt01_tripStatus.value = Program.InputStatus_PLC2.mkt01_tripStatus;
                        if (Program.danhSachAlarm.almItem_mkt01_tripStatus.value != Program.danhSachAlarm.almItem_mkt01_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mkt01_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.entityName = "MKT1";
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mkt01_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.date = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.time = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.description = "Lỗi quá tải thiết bị 'MKT1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mkt01_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mkt01_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mkt01_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mkt01_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mkt01_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt01
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt01
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mkt01
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mkt01_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt01_genAlarm.id = Program.danhSachAlarm.almItem_mkt01_tripStatus.id;
                                    mkt01_genAlarm.entityName = "MKT1";
                                    mkt01_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp;
                                    mkt01_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt01_tripStatus.activeStatus;
                                    mkt01_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt01_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment;
                                    mkt01_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt01_genAlarm.status = Program.danhSachAlarm.almItem_mkt01_tripStatus.status;
                                    mkt01_genAlarm.description = Program.danhSachAlarm.almItem_mkt01_tripStatus.description;

                                    var l3 = (mkt01_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mkt01_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt01_genAlarm.id = Program.danhSachAlarm.almItem_mkt01_tripStatus.id;
                                    mkt01_genAlarm.entityName = "MKT1";
                                    mkt01_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp;
                                    mkt01_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt01_tripStatus.activeStatus;
                                    mkt01_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt01_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment;
                                    mkt01_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt01_genAlarm.status = Program.danhSachAlarm.almItem_mkt01_tripStatus.status;
                                    mkt01_genAlarm.description = Program.danhSachAlarm.almItem_mkt01_tripStatus.description;

                                    var l3 = (mkt01_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mkt01_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt01_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mkt01_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt01_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt01_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt01_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt01_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mkt01_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mkt01_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mkt01_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mkt01_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt01_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt01_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt01_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt01_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt01_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt01_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MKT2
                        Program.danhSachAlarm.almItem_mkt02_tripStatus.value = Program.InputStatus_PLC2.mkt02_tripStatus;
                        if (Program.danhSachAlarm.almItem_mkt02_tripStatus.value != Program.danhSachAlarm.almItem_mkt02_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mkt02_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.entityName = "MKT2";
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mkt02_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.date = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.time = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.description = "Lỗi quá tải thiết bị 'MKT2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mkt02_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mkt02_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mkt02_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mkt02_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mkt02_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt02
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt02
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mkt02
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mkt02_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt02_genAlarm.id = Program.danhSachAlarm.almItem_mkt02_tripStatus.id;
                                    mkt02_genAlarm.entityName = "MKT2";
                                    mkt02_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp;
                                    mkt02_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt02_tripStatus.activeStatus;
                                    mkt02_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt02_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment;
                                    mkt02_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt02_genAlarm.status = Program.danhSachAlarm.almItem_mkt02_tripStatus.status;
                                    mkt02_genAlarm.description = Program.danhSachAlarm.almItem_mkt02_tripStatus.description;

                                    var l3 = (mkt02_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mkt02_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt02_genAlarm.id = Program.danhSachAlarm.almItem_mkt02_tripStatus.id;
                                    mkt02_genAlarm.entityName = "MKT2";
                                    mkt02_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp;
                                    mkt02_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt02_tripStatus.activeStatus;
                                    mkt02_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt02_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment;
                                    mkt02_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt02_genAlarm.status = Program.danhSachAlarm.almItem_mkt02_tripStatus.status;
                                    mkt02_genAlarm.description = Program.danhSachAlarm.almItem_mkt02_tripStatus.description;

                                    var l3 = (mkt02_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mkt02_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt02_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mkt02_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt02_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt02_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt02_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt02_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mkt02_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mkt02_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mkt02_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mkt02_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt02_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt02_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt02_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt02_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt02_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt02_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MKT3
                        Program.danhSachAlarm.almItem_mkt03_tripStatus.value = Program.InputStatus_PLC2.mkt03_tripStatus;
                        if (Program.danhSachAlarm.almItem_mkt03_tripStatus.value != Program.danhSachAlarm.almItem_mkt03_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mkt03_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.entityName = "MKT3";
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mkt03_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.date = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.time = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.description = "Lỗi quá tải thiết bị 'MKT3'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mkt03_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mkt03_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mkt03_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mkt03_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mkt03_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt03
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mkt03
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mkt03
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mkt03_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt03_genAlarm.id = Program.danhSachAlarm.almItem_mkt03_tripStatus.id;
                                    mkt03_genAlarm.entityName = "MKT3";
                                    mkt03_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp;
                                    mkt03_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt03_tripStatus.activeStatus;
                                    mkt03_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt03_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment;
                                    mkt03_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt03_genAlarm.status = Program.danhSachAlarm.almItem_mkt03_tripStatus.status;
                                    mkt03_genAlarm.description = Program.danhSachAlarm.almItem_mkt03_tripStatus.description;

                                    var l3 = (mkt03_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mkt03_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mkt03_genAlarm.id = Program.danhSachAlarm.almItem_mkt03_tripStatus.id;
                                    mkt03_genAlarm.entityName = "MKT3";
                                    mkt03_genAlarm.timestamp = Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp;
                                    mkt03_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mkt03_tripStatus.activeStatus;
                                    mkt03_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mkt03_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment;
                                    mkt03_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mkt03_genAlarm.status = Program.danhSachAlarm.almItem_mkt03_tripStatus.status;
                                    mkt03_genAlarm.description = Program.danhSachAlarm.almItem_mkt03_tripStatus.description;

                                    var l3 = (mkt03_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mkt03_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt03_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mkt03_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt03_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt03_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt03_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt03_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mkt03_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mkt03_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mkt03_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mkt03_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mkt03_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mkt03_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mkt03_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mkt03_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mkt03_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mkt03_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region TH1
                        Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.value = Program.InputStatus_PLC2.tuanHoan1_tripStatus;
                        if (Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.value != Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.entityName = "TH1";
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.date = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.time = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description = "Lỗi quá tải thiết bị 'TH1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của tuanHoan1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem tuanHoan1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan1_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id;
                                    tuanHoan1_genAlarm.entityName = "TH1";
                                    tuanHoan1_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp;
                                    tuanHoan1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.activeStatus;
                                    tuanHoan1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment;
                                    tuanHoan1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan1_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status;
                                    tuanHoan1_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description;

                                    var l3 = (tuanHoan1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem tuanHoan1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan1_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id;
                                    tuanHoan1_genAlarm.entityName = "TH1";
                                    tuanHoan1_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp;
                                    tuanHoan1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.activeStatus;
                                    tuanHoan1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment;
                                    tuanHoan1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan1_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status;
                                    tuanHoan1_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description;

                                    var l3 = (tuanHoan1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region TH2
                        Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.value = Program.InputStatus_PLC2.tuanHoan2_tripStatus;
                        if (Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.value != Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.entityName = "TH2";
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.date = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.time = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description = "Lỗi quá tải thiết bị 'TH2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của tuanHoan2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem tuanHoan2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan2_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id;
                                    tuanHoan2_genAlarm.entityName = "TH2";
                                    tuanHoan2_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp;
                                    tuanHoan2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.activeStatus;
                                    tuanHoan2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment;
                                    tuanHoan2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan2_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status;
                                    tuanHoan2_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description;

                                    var l3 = (tuanHoan2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem tuanHoan2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan2_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id;
                                    tuanHoan2_genAlarm.entityName = "TH2";
                                    tuanHoan2_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp;
                                    tuanHoan2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.activeStatus;
                                    tuanHoan2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment;
                                    tuanHoan2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan2_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status;
                                    tuanHoan2_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description;

                                    var l3 = (tuanHoan2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region TH3
                        Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.value = Program.InputStatus_PLC2.tuanHoan3_tripStatus;
                        if (Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.value != Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.entityName = "TH3";
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.date = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.time = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description = "Lỗi quá tải thiết bị 'TH3'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan3
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của tuanHoan3
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của tuanHoan3
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem tuanHoan3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan3_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id;
                                    tuanHoan3_genAlarm.entityName = "TH3";
                                    tuanHoan3_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp;
                                    tuanHoan3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.activeStatus;
                                    tuanHoan3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment;
                                    tuanHoan3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan3_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status;
                                    tuanHoan3_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description;

                                    var l3 = (tuanHoan3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem tuanHoan3_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    tuanHoan3_genAlarm.id = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id;
                                    tuanHoan3_genAlarm.entityName = "TH3";
                                    tuanHoan3_genAlarm.timestamp = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp;
                                    tuanHoan3_genAlarm.activeStatus = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.activeStatus;
                                    tuanHoan3_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    tuanHoan3_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment;
                                    tuanHoan3_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    tuanHoan3_genAlarm.status = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status;
                                    tuanHoan3_genAlarm.description = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description;

                                    var l3 = (tuanHoan3_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_tuanHoan3_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region GB1
                        Program.danhSachAlarm.almItem_gatBun_tripStatus.value = Program.InputStatus_PLC2.gatBun_tripStatus;
                        if (Program.danhSachAlarm.almItem_gatBun_tripStatus.value != Program.danhSachAlarm.almItem_gatBun_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_gatBun_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.entityName = "GB1";
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_gatBun_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.date = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.time = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.description = "Lỗi quá tải thiết bị 'GB1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_gatBun_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_gatBun_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_gatBun_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_gatBun_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_gatBun_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của gatBun
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của gatBun
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của gatBun
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem gatBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gatBun_genAlarm.id = Program.danhSachAlarm.almItem_gatBun_tripStatus.id;
                                    gatBun_genAlarm.entityName = "GB1";
                                    gatBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp;
                                    gatBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gatBun_tripStatus.activeStatus;
                                    gatBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gatBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment;
                                    gatBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gatBun_genAlarm.status = Program.danhSachAlarm.almItem_gatBun_tripStatus.status;
                                    gatBun_genAlarm.description = Program.danhSachAlarm.almItem_gatBun_tripStatus.description;

                                    var l3 = (gatBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem gatBun_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gatBun_genAlarm.id = Program.danhSachAlarm.almItem_gatBun_tripStatus.id;
                                    gatBun_genAlarm.entityName = "GB1";
                                    gatBun_genAlarm.timestamp = Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp;
                                    gatBun_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gatBun_tripStatus.activeStatus;
                                    gatBun_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gatBun_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment;
                                    gatBun_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gatBun_genAlarm.status = Program.danhSachAlarm.almItem_gatBun_tripStatus.status;
                                    gatBun_genAlarm.description = Program.danhSachAlarm.almItem_gatBun_tripStatus.description;

                                    var l3 = (gatBun_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_gatBun_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_gatBun_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_gatBun_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gatBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gatBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gatBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gatBun_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_gatBun_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_gatBun_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_gatBun_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_gatBun_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_gatBun_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gatBun_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gatBun_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gatBun_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gatBun_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gatBun_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region BB1
                        Program.danhSachAlarm.almItem_bomBun1_tripStatus.value = Program.InputStatus_PLC2.bomBun1_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun1_tripStatus.value != Program.danhSachAlarm.almItem_bomBun1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.entityName = "BB1";
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.date = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.time = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.description = "Lỗi quá tải thiết bị 'BB1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun1_genAlarm.id = Program.danhSachAlarm.almItem_bomBun1_tripStatus.id;
                                    bomBun1_genAlarm.entityName = "BB1";
                                    bomBun1_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp;
                                    bomBun1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun1_tripStatus.activeStatus;
                                    bomBun1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment;
                                    bomBun1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun1_genAlarm.status = Program.danhSachAlarm.almItem_bomBun1_tripStatus.status;
                                    bomBun1_genAlarm.description = Program.danhSachAlarm.almItem_bomBun1_tripStatus.description;

                                    var l3 = (bomBun1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun1_genAlarm.id = Program.danhSachAlarm.almItem_bomBun1_tripStatus.id;
                                    bomBun1_genAlarm.entityName = "BB1";
                                    bomBun1_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp;
                                    bomBun1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun1_tripStatus.activeStatus;
                                    bomBun1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment;
                                    bomBun1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun1_genAlarm.status = Program.danhSachAlarm.almItem_bomBun1_tripStatus.status;
                                    bomBun1_genAlarm.description = Program.danhSachAlarm.almItem_bomBun1_tripStatus.description;

                                    var l3 = (bomBun1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region BB2
                        Program.danhSachAlarm.almItem_bomBun2_tripStatus.value = Program.InputStatus_PLC2.bomBun2_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun2_tripStatus.value != Program.danhSachAlarm.almItem_bomBun2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.entityName = "BB2";
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.date = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.time = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.description = "Lỗi quá tải thiết bị 'BB2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun2_genAlarm.id = Program.danhSachAlarm.almItem_bomBun2_tripStatus.id;
                                    bomBun2_genAlarm.entityName = "BB2";
                                    bomBun2_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp;
                                    bomBun2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun2_tripStatus.activeStatus;
                                    bomBun2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment;
                                    bomBun2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun2_genAlarm.status = Program.danhSachAlarm.almItem_bomBun2_tripStatus.status;
                                    bomBun2_genAlarm.description = Program.danhSachAlarm.almItem_bomBun2_tripStatus.description;

                                    var l3 = (bomBun2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun2_genAlarm.id = Program.danhSachAlarm.almItem_bomBun2_tripStatus.id;
                                    bomBun2_genAlarm.entityName = "BB2";
                                    bomBun2_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp;
                                    bomBun2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun2_tripStatus.activeStatus;
                                    bomBun2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment;
                                    bomBun2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun2_genAlarm.status = Program.danhSachAlarm.almItem_bomBun2_tripStatus.status;
                                    bomBun2_genAlarm.description = Program.danhSachAlarm.almItem_bomBun2_tripStatus.description;

                                    var l3 = (bomBun2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MT-NAOH
                        Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.value = Program.InputStatus_PLC2.khuayNaoh_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.value != Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.entityName = "MT-NAOH";
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.date = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.time = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description = "Lỗi quá tải thiết bị 'MT-NAOH'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayNaoh
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayNaoh
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayNaoh
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayNaoh_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayNaoh_genAlarm.id = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id;
                                    khuayNaoh_genAlarm.entityName = "MT-NAOH";
                                    khuayNaoh_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp;
                                    khuayNaoh_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.activeStatus;
                                    khuayNaoh_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayNaoh_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment;
                                    khuayNaoh_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayNaoh_genAlarm.status = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status;
                                    khuayNaoh_genAlarm.description = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description;

                                    var l3 = (khuayNaoh_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayNaoh_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayNaoh_genAlarm.id = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id;
                                    khuayNaoh_genAlarm.entityName = "MT-NAOH";
                                    khuayNaoh_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp;
                                    khuayNaoh_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.activeStatus;
                                    khuayNaoh_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayNaoh_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment;
                                    khuayNaoh_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayNaoh_genAlarm.status = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status;
                                    khuayNaoh_genAlarm.description = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description;

                                    var l3 = (khuayNaoh_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayNaoh_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-NAOH
                        Program.danhSachAlarm.almItem_dlNaoh_tripStatus.value = Program.InputStatus_PLC2.dlNaoh_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlNaoh_tripStatus.value != Program.danhSachAlarm.almItem_dlNaoh_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlNaoh_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.entityName = "DP-NAOH";
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.date = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.time = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description = "Lỗi quá tải thiết bị 'DP-NAOH'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlNaoh
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlNaoh
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlNaoh
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlNaoh_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlNaoh_genAlarm.id = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id;
                                    dlNaoh_genAlarm.entityName = "DP-NAOH";
                                    dlNaoh_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp;
                                    dlNaoh_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.activeStatus;
                                    dlNaoh_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlNaoh_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment;
                                    dlNaoh_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlNaoh_genAlarm.status = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status;
                                    dlNaoh_genAlarm.description = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description;

                                    var l3 = (dlNaoh_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlNaoh_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlNaoh_genAlarm.id = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id;
                                    dlNaoh_genAlarm.entityName = "DP-NAOH";
                                    dlNaoh_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp;
                                    dlNaoh_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.activeStatus;
                                    dlNaoh_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlNaoh_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment;
                                    dlNaoh_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlNaoh_genAlarm.status = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status;
                                    dlNaoh_genAlarm.description = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description;

                                    var l3 = (dlNaoh_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlNaoh_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlNaoh_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlNaoh_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlNaoh_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlNaoh_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-AL2SO4-1
                        Program.danhSachAlarm.almItem_al2so4_1_tripStatus.value = Program.InputStatus_PLC2.al2so4_1_tripStatus;
                        if (Program.danhSachAlarm.almItem_al2so4_1_tripStatus.value != Program.danhSachAlarm.almItem_al2so4_1_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_al2so4_1_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.entityName = "DP-AL2SO4-1";
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.date = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.time = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description = "Lỗi quá tải thiết bị 'DP-AL2SO4-1'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của al2so4_1
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của al2so4_1
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của al2so4_1
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem al2so4_1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    al2so4_1_genAlarm.id = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id;
                                    al2so4_1_genAlarm.entityName = "DP-AL2SO4-1";
                                    al2so4_1_genAlarm.timestamp = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp;
                                    al2so4_1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.activeStatus;
                                    al2so4_1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    al2so4_1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment;
                                    al2so4_1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    al2so4_1_genAlarm.status = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status;
                                    al2so4_1_genAlarm.description = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description;

                                    var l3 = (al2so4_1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem al2so4_1_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    al2so4_1_genAlarm.id = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id;
                                    al2so4_1_genAlarm.entityName = "DP-AL2SO4-1";
                                    al2so4_1_genAlarm.timestamp = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp;
                                    al2so4_1_genAlarm.activeStatus = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.activeStatus;
                                    al2so4_1_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    al2so4_1_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment;
                                    al2so4_1_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    al2so4_1_genAlarm.status = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status;
                                    al2so4_1_genAlarm.description = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description;

                                    var l3 = (al2so4_1_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_al2so4_1_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_al2so4_1_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_al2so4_1_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_al2so4_1_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_al2so4_1_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP-AL2SO4-2
                        Program.danhSachAlarm.almItem_al2so4_2_tripStatus.value = Program.InputStatus_PLC2.al2so4_2_tripStatus;
                        if (Program.danhSachAlarm.almItem_al2so4_2_tripStatus.value != Program.danhSachAlarm.almItem_al2so4_2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_al2so4_2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.entityName = "DP-AL2SO4-2";
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.date = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.time = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description = "Lỗi quá tải thiết bị 'DP-AL2SO4-2'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của al2so4_2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của al2so4_2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của al2so4_2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem al2so4_2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    al2so4_2_genAlarm.id = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id;
                                    al2so4_2_genAlarm.entityName = "DP-AL2SO4-2";
                                    al2so4_2_genAlarm.timestamp = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp;
                                    al2so4_2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.activeStatus;
                                    al2so4_2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    al2so4_2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment;
                                    al2so4_2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    al2so4_2_genAlarm.status = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status;
                                    al2so4_2_genAlarm.description = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description;

                                    var l3 = (al2so4_2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem al2so4_2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    al2so4_2_genAlarm.id = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id;
                                    al2so4_2_genAlarm.entityName = "DP-AL2SO4-2";
                                    al2so4_2_genAlarm.timestamp = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp;
                                    al2so4_2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.activeStatus;
                                    al2so4_2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    al2so4_2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment;
                                    al2so4_2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    al2so4_2_genAlarm.status = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status;
                                    al2so4_2_genAlarm.description = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description;

                                    var l3 = (al2so4_2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_al2so4_2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_al2so4_2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_al2so4_2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_al2so4_2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_al2so4_2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region BS02A
                        Program.danhSachAlarm.almItem_mayTachRac_tripStatus.value = Program.InputStatus_PLC3.mayTachRac_tripStatus;
                        if (Program.danhSachAlarm.almItem_mayTachRac_tripStatus.value != Program.danhSachAlarm.almItem_mayTachRac_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mayTachRac_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.entityName = "BS02A";
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.date = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.time = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description = "Lỗi quá tải thiết bị 'BS02A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mayTachRac
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mayTachRac
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mayTachRac
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mayTachRac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mayTachRac_genAlarm.id = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id;
                                    mayTachRac_genAlarm.entityName = "BS02A";
                                    mayTachRac_genAlarm.timestamp = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp;
                                    mayTachRac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.activeStatus;
                                    mayTachRac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mayTachRac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment;
                                    mayTachRac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mayTachRac_genAlarm.status = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status;
                                    mayTachRac_genAlarm.description = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description;

                                    var l3 = (mayTachRac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mayTachRac_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mayTachRac_genAlarm.id = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id;
                                    mayTachRac_genAlarm.entityName = "BS02A";
                                    mayTachRac_genAlarm.timestamp = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp;
                                    mayTachRac_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.activeStatus;
                                    mayTachRac_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mayTachRac_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment;
                                    mayTachRac_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mayTachRac_genAlarm.status = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status;
                                    mayTachRac_genAlarm.description = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description;

                                    var l3 = (mayTachRac_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mayTachRac_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mayTachRac_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mayTachRac_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mayTachRac_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mayTachRac_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region WP02A
                        Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.value = Program.InputStatus_PLC3.bomNt_02A_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.value != Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.entityName = "WP02A";
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.date = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.time = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description = "Lỗi quá tải thiết bị 'WP02A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomNt_02A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomNt_02A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomNt_02A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomNt_02A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomNt_02A_genAlarm.id = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id;
                                    bomNt_02A_genAlarm.entityName = "WP02A";
                                    bomNt_02A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp;
                                    bomNt_02A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.activeStatus;
                                    bomNt_02A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomNt_02A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment;
                                    bomNt_02A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomNt_02A_genAlarm.status = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status;
                                    bomNt_02A_genAlarm.description = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description;

                                    var l3 = (bomNt_02A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomNt_02A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomNt_02A_genAlarm.id = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id;
                                    bomNt_02A_genAlarm.entityName = "WP02A";
                                    bomNt_02A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp;
                                    bomNt_02A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.activeStatus;
                                    bomNt_02A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomNt_02A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment;
                                    bomNt_02A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomNt_02A_genAlarm.status = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status;
                                    bomNt_02A_genAlarm.description = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description;

                                    var l3 = (bomNt_02A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomNt_02A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region WP02B
                        Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.value = Program.InputStatus_PLC3.bomNt_02B_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.value != Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.entityName = "WP02B";
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.date = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.time = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description = "Lỗi quá tải thiết bị 'WP02B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomNt_02B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomNt_02B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomNt_02B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomNt_02B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomNt_02B_genAlarm.id = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id;
                                    bomNt_02B_genAlarm.entityName = "WP02B";
                                    bomNt_02B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp;
                                    bomNt_02B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.activeStatus;
                                    bomNt_02B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomNt_02B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment;
                                    bomNt_02B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomNt_02B_genAlarm.status = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status;
                                    bomNt_02B_genAlarm.description = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description;

                                    var l3 = (bomNt_02B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomNt_02B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomNt_02B_genAlarm.id = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id;
                                    bomNt_02B_genAlarm.entityName = "WP02B";
                                    bomNt_02B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp;
                                    bomNt_02B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.activeStatus;
                                    bomNt_02B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomNt_02B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment;
                                    bomNt_02B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomNt_02B_genAlarm.status = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status;
                                    bomNt_02B_genAlarm.description = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description;

                                    var l3 = (bomNt_02B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomNt_02B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region AB06A
                        Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.value = Program.InputStatus_PLC3.mtk_AB06A_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.value != Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.entityName = "AB06A";
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.date = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.time = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description = "Lỗi quá tải thiết bị 'AB06A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mtk_AB06A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mtk_AB06A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06A_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id;
                                    mtk_AB06A_genAlarm.entityName = "AB06A";
                                    mtk_AB06A_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp;
                                    mtk_AB06A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.activeStatus;
                                    mtk_AB06A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment;
                                    mtk_AB06A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06A_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status;
                                    mtk_AB06A_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description;

                                    var l3 = (mtk_AB06A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk_AB06A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06A_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id;
                                    mtk_AB06A_genAlarm.entityName = "AB06A";
                                    mtk_AB06A_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp;
                                    mtk_AB06A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.activeStatus;
                                    mtk_AB06A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment;
                                    mtk_AB06A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06A_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status;
                                    mtk_AB06A_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description;

                                    var l3 = (mtk_AB06A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region AB06B
                        Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.value = Program.InputStatus_PLC3.mtk_AB06B_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.value != Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.entityName = "AB06B";
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.date = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.time = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description = "Lỗi quá tải thiết bị 'AB06B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mtk_AB06B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mtk_AB06B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06B_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id;
                                    mtk_AB06B_genAlarm.entityName = "AB06B";
                                    mtk_AB06B_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp;
                                    mtk_AB06B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.activeStatus;
                                    mtk_AB06B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment;
                                    mtk_AB06B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06B_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status;
                                    mtk_AB06B_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description;

                                    var l3 = (mtk_AB06B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk_AB06B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06B_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id;
                                    mtk_AB06B_genAlarm.entityName = "AB06B";
                                    mtk_AB06B_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp;
                                    mtk_AB06B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.activeStatus;
                                    mtk_AB06B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment;
                                    mtk_AB06B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06B_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status;
                                    mtk_AB06B_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description;

                                    var l3 = (mtk_AB06B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region AB06C
                        Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.value = Program.InputStatus_PLC3.mtk_AB06C_tripStatus;
                        if (Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.value != Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.entityName = "AB06C";
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.date = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.time = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description = "Lỗi quá tải thiết bị 'AB06C'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06C
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của mtk_AB06C
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của mtk_AB06C
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem mtk_AB06C_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06C_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id;
                                    mtk_AB06C_genAlarm.entityName = "AB06C";
                                    mtk_AB06C_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp;
                                    mtk_AB06C_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.activeStatus;
                                    mtk_AB06C_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06C_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment;
                                    mtk_AB06C_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06C_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status;
                                    mtk_AB06C_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description;

                                    var l3 = (mtk_AB06C_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem mtk_AB06C_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    mtk_AB06C_genAlarm.id = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id;
                                    mtk_AB06C_genAlarm.entityName = "AB06C";
                                    mtk_AB06C_genAlarm.timestamp = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp;
                                    mtk_AB06C_genAlarm.activeStatus = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.activeStatus;
                                    mtk_AB06C_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    mtk_AB06C_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment;
                                    mtk_AB06C_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    mtk_AB06C_genAlarm.status = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status;
                                    mtk_AB06C_genAlarm.description = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description;

                                    var l3 = (mtk_AB06C_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_mtk_AB06C_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MI03
                        Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.value = Program.InputStatus_PLC3.khuayKeoTu_GD2_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.value != Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.entityName = "MI03";
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.date = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.time = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description = "Lỗi quá tải thiết bị 'MI03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayKeoTu_GD2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayKeoTu_GD2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayKeoTu_GD2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayKeoTu_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayKeoTu_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id;
                                    khuayKeoTu_GD2_genAlarm.entityName = "MI03";
                                    khuayKeoTu_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp;
                                    khuayKeoTu_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.activeStatus;
                                    khuayKeoTu_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayKeoTu_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment;
                                    khuayKeoTu_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayKeoTu_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status;
                                    khuayKeoTu_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description;

                                    var l3 = (khuayKeoTu_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayKeoTu_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayKeoTu_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id;
                                    khuayKeoTu_GD2_genAlarm.entityName = "MI03";
                                    khuayKeoTu_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp;
                                    khuayKeoTu_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.activeStatus;
                                    khuayKeoTu_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayKeoTu_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment;
                                    khuayKeoTu_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayKeoTu_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status;
                                    khuayKeoTu_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description;

                                    var l3 = (khuayKeoTu_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayKeoTu_GD2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MI04A
                        Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.value = Program.InputStatus_PLC3.khuayTaoBong_A_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.value != Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.entityName = "MI04A";
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.date = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.time = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description = "Lỗi quá tải thiết bị 'MI04A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong_A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong_A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayTaoBong_A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayTaoBong_A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong_A_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id;
                                    khuayTaoBong_A_genAlarm.entityName = "MI04A";
                                    khuayTaoBong_A_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp;
                                    khuayTaoBong_A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.activeStatus;
                                    khuayTaoBong_A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong_A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment;
                                    khuayTaoBong_A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong_A_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status;
                                    khuayTaoBong_A_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description;

                                    var l3 = (khuayTaoBong_A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayTaoBong_A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong_A_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id;
                                    khuayTaoBong_A_genAlarm.entityName = "MI04A";
                                    khuayTaoBong_A_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp;
                                    khuayTaoBong_A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.activeStatus;
                                    khuayTaoBong_A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong_A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment;
                                    khuayTaoBong_A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong_A_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status;
                                    khuayTaoBong_A_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description;

                                    var l3 = (khuayTaoBong_A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong_A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MI04B
                        Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.value = Program.InputStatus_PLC3.khuayTaoBong_B_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.value != Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.entityName = "MI04B";
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.date = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.time = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description = "Lỗi quá tải thiết bị 'MI04B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong_B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayTaoBong_B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayTaoBong_B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayTaoBong_B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong_B_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id;
                                    khuayTaoBong_B_genAlarm.entityName = "MI04B";
                                    khuayTaoBong_B_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp;
                                    khuayTaoBong_B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.activeStatus;
                                    khuayTaoBong_B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong_B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment;
                                    khuayTaoBong_B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong_B_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status;
                                    khuayTaoBong_B_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description;

                                    var l3 = (khuayTaoBong_B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayTaoBong_B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayTaoBong_B_genAlarm.id = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id;
                                    khuayTaoBong_B_genAlarm.entityName = "MI04B";
                                    khuayTaoBong_B_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp;
                                    khuayTaoBong_B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.activeStatus;
                                    khuayTaoBong_B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayTaoBong_B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment;
                                    khuayTaoBong_B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayTaoBong_B_genAlarm.status = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status;
                                    khuayTaoBong_B_genAlarm.description = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description;

                                    var l3 = (khuayTaoBong_B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayTaoBong_B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MS05
                        Program.danhSachAlarm.almItem_gbbl05_tripStatus.value = Program.InputStatus_PLC3.gbbl05_tripStatus;
                        if (Program.danhSachAlarm.almItem_gbbl05_tripStatus.value != Program.danhSachAlarm.almItem_gbbl05_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_gbbl05_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.entityName = "MS05";
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.date = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.time = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.description = "Lỗi quá tải thiết bị 'MS05'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_gbbl05_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_gbbl05_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_gbbl05_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_gbbl05_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_gbbl05_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl05
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl05
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của gbbl05
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem gbbl05_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl05_genAlarm.id = Program.danhSachAlarm.almItem_gbbl05_tripStatus.id;
                                    gbbl05_genAlarm.entityName = "MS05";
                                    gbbl05_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp;
                                    gbbl05_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl05_tripStatus.activeStatus;
                                    gbbl05_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl05_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment;
                                    gbbl05_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl05_genAlarm.status = Program.danhSachAlarm.almItem_gbbl05_tripStatus.status;
                                    gbbl05_genAlarm.description = Program.danhSachAlarm.almItem_gbbl05_tripStatus.description;

                                    var l3 = (gbbl05_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem gbbl05_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl05_genAlarm.id = Program.danhSachAlarm.almItem_gbbl05_tripStatus.id;
                                    gbbl05_genAlarm.entityName = "MS05";
                                    gbbl05_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp;
                                    gbbl05_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl05_tripStatus.activeStatus;
                                    gbbl05_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl05_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment;
                                    gbbl05_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl05_genAlarm.status = Program.danhSachAlarm.almItem_gbbl05_tripStatus.status;
                                    gbbl05_genAlarm.description = Program.danhSachAlarm.almItem_gbbl05_tripStatus.description;

                                    var l3 = (gbbl05_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_gbbl05_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl05_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_gbbl05_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl05_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl05_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl05_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl05_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_gbbl05_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_gbbl05_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_gbbl05_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl05_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl05_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl05_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl05_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl05_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl05_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MS07
                        Program.danhSachAlarm.almItem_gbbl07_tripStatus.value = Program.InputStatus_PLC3.gbbl07_tripStatus;
                        if (Program.danhSachAlarm.almItem_gbbl07_tripStatus.value != Program.danhSachAlarm.almItem_gbbl07_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_gbbl07_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.entityName = "MS07";
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.date = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.time = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.description = "Lỗi quá tải thiết bị 'MS07'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_gbbl07_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_gbbl07_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_gbbl07_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_gbbl07_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_gbbl07_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl07
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl07
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của gbbl07
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem gbbl07_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl07_genAlarm.id = Program.danhSachAlarm.almItem_gbbl07_tripStatus.id;
                                    gbbl07_genAlarm.entityName = "MS07";
                                    gbbl07_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp;
                                    gbbl07_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl07_tripStatus.activeStatus;
                                    gbbl07_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl07_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment;
                                    gbbl07_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl07_genAlarm.status = Program.danhSachAlarm.almItem_gbbl07_tripStatus.status;
                                    gbbl07_genAlarm.description = Program.danhSachAlarm.almItem_gbbl07_tripStatus.description;

                                    var l3 = (gbbl07_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem gbbl07_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl07_genAlarm.id = Program.danhSachAlarm.almItem_gbbl07_tripStatus.id;
                                    gbbl07_genAlarm.entityName = "MS07";
                                    gbbl07_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp;
                                    gbbl07_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl07_tripStatus.activeStatus;
                                    gbbl07_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl07_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment;
                                    gbbl07_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl07_genAlarm.status = Program.danhSachAlarm.almItem_gbbl07_tripStatus.status;
                                    gbbl07_genAlarm.description = Program.danhSachAlarm.almItem_gbbl07_tripStatus.description;

                                    var l3 = (gbbl07_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_gbbl07_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl07_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_gbbl07_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl07_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl07_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl07_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl07_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_gbbl07_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_gbbl07_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_gbbl07_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl07_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl07_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl07_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl07_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl07_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl07_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MS09
                        Program.danhSachAlarm.almItem_gbbl09_tripStatus.value = Program.InputStatus_PLC3.gbbl09_tripStatus;
                        if (Program.danhSachAlarm.almItem_gbbl09_tripStatus.value != Program.danhSachAlarm.almItem_gbbl09_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_gbbl09_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.entityName = "MS09";
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.date = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.time = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.description = "Lỗi quá tải thiết bị 'MS09'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_gbbl09_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_gbbl09_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_gbbl09_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_gbbl09_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_gbbl09_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl09
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của gbbl09
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của gbbl09
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem gbbl09_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl09_genAlarm.id = Program.danhSachAlarm.almItem_gbbl09_tripStatus.id;
                                    gbbl09_genAlarm.entityName = "MS09";
                                    gbbl09_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp;
                                    gbbl09_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl09_tripStatus.activeStatus;
                                    gbbl09_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl09_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment;
                                    gbbl09_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl09_genAlarm.status = Program.danhSachAlarm.almItem_gbbl09_tripStatus.status;
                                    gbbl09_genAlarm.description = Program.danhSachAlarm.almItem_gbbl09_tripStatus.description;

                                    var l3 = (gbbl09_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem gbbl09_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    gbbl09_genAlarm.id = Program.danhSachAlarm.almItem_gbbl09_tripStatus.id;
                                    gbbl09_genAlarm.entityName = "MS09";
                                    gbbl09_genAlarm.timestamp = Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp;
                                    gbbl09_genAlarm.activeStatus = Program.danhSachAlarm.almItem_gbbl09_tripStatus.activeStatus;
                                    gbbl09_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    gbbl09_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment;
                                    gbbl09_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    gbbl09_genAlarm.status = Program.danhSachAlarm.almItem_gbbl09_tripStatus.status;
                                    gbbl09_genAlarm.description = Program.danhSachAlarm.almItem_gbbl09_tripStatus.description;

                                    var l3 = (gbbl09_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_gbbl09_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl09_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_gbbl09_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl09_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl09_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl09_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl09_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_gbbl09_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_gbbl09_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_gbbl09_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_gbbl09_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_gbbl09_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_gbbl09_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_gbbl09_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_gbbl09_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_gbbl09_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MC03
                        Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.value = Program.InputStatus_PLC3.khuayPac_GD2_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.value != Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.entityName = "MC03";
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.date = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.time = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description = "Lỗi quá tải thiết bị 'MC03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPac_GD2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPac_GD2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayPac_GD2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayPac_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPac_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id;
                                    khuayPac_GD2_genAlarm.entityName = "MC03";
                                    khuayPac_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp;
                                    khuayPac_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.activeStatus;
                                    khuayPac_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPac_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment;
                                    khuayPac_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPac_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status;
                                    khuayPac_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description;

                                    var l3 = (khuayPac_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayPac_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPac_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id;
                                    khuayPac_GD2_genAlarm.entityName = "MC03";
                                    khuayPac_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp;
                                    khuayPac_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.activeStatus;
                                    khuayPac_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPac_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment;
                                    khuayPac_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPac_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status;
                                    khuayPac_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description;

                                    var l3 = (khuayPac_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPac_GD2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MC04
                        Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.value = Program.InputStatus_PLC3.khuayPoly_GD2_tripStatus;
                        if (Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.value != Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.entityName = "MC04";
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.date = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.time = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description = "Lỗi quá tải thiết bị 'MC04'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPoly_GD2
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của khuayPoly_GD2
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của khuayPoly_GD2
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem khuayPoly_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPoly_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id;
                                    khuayPoly_GD2_genAlarm.entityName = "MC04";
                                    khuayPoly_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp;
                                    khuayPoly_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.activeStatus;
                                    khuayPoly_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPoly_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment;
                                    khuayPoly_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPoly_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status;
                                    khuayPoly_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description;

                                    var l3 = (khuayPoly_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem khuayPoly_GD2_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    khuayPoly_GD2_genAlarm.id = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id;
                                    khuayPoly_GD2_genAlarm.entityName = "MC04";
                                    khuayPoly_GD2_genAlarm.timestamp = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp;
                                    khuayPoly_GD2_genAlarm.activeStatus = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.activeStatus;
                                    khuayPoly_GD2_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    khuayPoly_GD2_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment;
                                    khuayPoly_GD2_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    khuayPoly_GD2_genAlarm.status = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status;
                                    khuayPoly_GD2_genAlarm.description = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description;

                                    var l3 = (khuayPoly_GD2_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_khuayPoly_GD2_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP05A
                        Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.value = Program.InputStatus_PLC3.bomBun_05A_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.value != Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.entityName = "SP05A";
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.date = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.time = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description = "Lỗi quá tải thiết bị 'SP05A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_05A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_05A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun_05A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun_05A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_05A_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id;
                                    bomBun_05A_genAlarm.entityName = "SP05A";
                                    bomBun_05A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp;
                                    bomBun_05A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.activeStatus;
                                    bomBun_05A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_05A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment;
                                    bomBun_05A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_05A_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status;
                                    bomBun_05A_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description;

                                    var l3 = (bomBun_05A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun_05A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_05A_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id;
                                    bomBun_05A_genAlarm.entityName = "SP05A";
                                    bomBun_05A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp;
                                    bomBun_05A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.activeStatus;
                                    bomBun_05A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_05A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment;
                                    bomBun_05A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_05A_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status;
                                    bomBun_05A_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description;

                                    var l3 = (bomBun_05A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_05A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP05B
                        Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.value = Program.InputStatus_PLC3.bomBun_05B_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.value != Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.entityName = "SP05B";
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.date = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.time = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description = "Lỗi quá tải thiết bị 'SP05B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_05B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_05B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun_05B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun_05B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_05B_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id;
                                    bomBun_05B_genAlarm.entityName = "SP05B";
                                    bomBun_05B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp;
                                    bomBun_05B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.activeStatus;
                                    bomBun_05B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_05B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment;
                                    bomBun_05B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_05B_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status;
                                    bomBun_05B_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description;

                                    var l3 = (bomBun_05B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun_05B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_05B_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id;
                                    bomBun_05B_genAlarm.entityName = "SP05B";
                                    bomBun_05B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp;
                                    bomBun_05B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.activeStatus;
                                    bomBun_05B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_05B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment;
                                    bomBun_05B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_05B_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status;
                                    bomBun_05B_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description;

                                    var l3 = (bomBun_05B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_05B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP07A
                        Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.value = Program.InputStatus_PLC3.bomBun_07A_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.value != Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.entityName = "SP07A";
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.date = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.time = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description = "Lỗi quá tải thiết bị 'SP07A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_07A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_07A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun_07A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun_07A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_07A_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id;
                                    bomBun_07A_genAlarm.entityName = "SP07A";
                                    bomBun_07A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp;
                                    bomBun_07A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.activeStatus;
                                    bomBun_07A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_07A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment;
                                    bomBun_07A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_07A_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status;
                                    bomBun_07A_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description;

                                    var l3 = (bomBun_07A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun_07A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_07A_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id;
                                    bomBun_07A_genAlarm.entityName = "SP07A";
                                    bomBun_07A_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp;
                                    bomBun_07A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.activeStatus;
                                    bomBun_07A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_07A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment;
                                    bomBun_07A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_07A_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status;
                                    bomBun_07A_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description;

                                    var l3 = (bomBun_07A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_07A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP07B
                        Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.value = Program.InputStatus_PLC3.bomBun_07B_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.value != Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.entityName = "SP07B";
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.date = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.time = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description = "Lỗi quá tải thiết bị 'SP07B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_07B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_07B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun_07B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun_07B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_07B_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id;
                                    bomBun_07B_genAlarm.entityName = "SP07B";
                                    bomBun_07B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp;
                                    bomBun_07B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.activeStatus;
                                    bomBun_07B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_07B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment;
                                    bomBun_07B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_07B_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status;
                                    bomBun_07B_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description;

                                    var l3 = (bomBun_07B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun_07B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_07B_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id;
                                    bomBun_07B_genAlarm.entityName = "SP07B";
                                    bomBun_07B_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp;
                                    bomBun_07B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.activeStatus;
                                    bomBun_07B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_07B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment;
                                    bomBun_07B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_07B_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status;
                                    bomBun_07B_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description;

                                    var l3 = (bomBun_07B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_07B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region SP10
                        Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.value = Program.InputStatus_PLC3.bomBun_SP10_tripStatus;
                        if (Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.value != Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.entityName = "SP10";
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.date = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.time = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description = "Lỗi quá tải thiết bị 'SP10'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_SP10
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của bomBun_SP10
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của bomBun_SP10
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem bomBun_SP10_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_SP10_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id;
                                    bomBun_SP10_genAlarm.entityName = "SP10";
                                    bomBun_SP10_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp;
                                    bomBun_SP10_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.activeStatus;
                                    bomBun_SP10_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_SP10_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment;
                                    bomBun_SP10_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_SP10_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status;
                                    bomBun_SP10_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description;

                                    var l3 = (bomBun_SP10_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem bomBun_SP10_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    bomBun_SP10_genAlarm.id = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id;
                                    bomBun_SP10_genAlarm.entityName = "SP10";
                                    bomBun_SP10_genAlarm.timestamp = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp;
                                    bomBun_SP10_genAlarm.activeStatus = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.activeStatus;
                                    bomBun_SP10_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    bomBun_SP10_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment;
                                    bomBun_SP10_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    bomBun_SP10_genAlarm.status = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status;
                                    bomBun_SP10_genAlarm.description = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description;

                                    var l3 = (bomBun_SP10_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_bomBun_SP10_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region MI03
                        Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.value = Program.InputStatus_PLC3.dlPhen_03A_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.value != Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.entityName = "MI03";
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.date = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.time = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description = "Lỗi quá tải thiết bị 'MI03'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPhen_03A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPhen_03A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPhen_03A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPhen_03A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPhen_03A_genAlarm.id = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id;
                                    dlPhen_03A_genAlarm.entityName = "MI03";
                                    dlPhen_03A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp;
                                    dlPhen_03A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.activeStatus;
                                    dlPhen_03A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPhen_03A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment;
                                    dlPhen_03A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPhen_03A_genAlarm.status = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status;
                                    dlPhen_03A_genAlarm.description = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description;

                                    var l3 = (dlPhen_03A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPhen_03A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPhen_03A_genAlarm.id = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id;
                                    dlPhen_03A_genAlarm.entityName = "MI03";
                                    dlPhen_03A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp;
                                    dlPhen_03A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.activeStatus;
                                    dlPhen_03A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPhen_03A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment;
                                    dlPhen_03A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPhen_03A_genAlarm.status = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status;
                                    dlPhen_03A_genAlarm.description = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description;

                                    var l3 = (dlPhen_03A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPhen_03A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP03B
                        Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.value = Program.InputStatus_PLC3.dlPhen_03B_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.value != Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.entityName = "DP03B";
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.date = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.time = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description = "Lỗi quá tải thiết bị 'DP03B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPhen_03B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPhen_03B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPhen_03B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPhen_03B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPhen_03B_genAlarm.id = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id;
                                    dlPhen_03B_genAlarm.entityName = "DP03B";
                                    dlPhen_03B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp;
                                    dlPhen_03B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.activeStatus;
                                    dlPhen_03B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPhen_03B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment;
                                    dlPhen_03B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPhen_03B_genAlarm.status = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status;
                                    dlPhen_03B_genAlarm.description = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description;

                                    var l3 = (dlPhen_03B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPhen_03B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPhen_03B_genAlarm.id = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id;
                                    dlPhen_03B_genAlarm.entityName = "DP03B";
                                    dlPhen_03B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp;
                                    dlPhen_03B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.activeStatus;
                                    dlPhen_03B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPhen_03B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment;
                                    dlPhen_03B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPhen_03B_genAlarm.status = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status;
                                    dlPhen_03B_genAlarm.description = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description;

                                    var l3 = (dlPhen_03B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPhen_03B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP04A
                        Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.value = Program.InputStatus_PLC3.dlPolyme_04A_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.value != Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.entityName = "DP04A";
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.date = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.time = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description = "Lỗi quá tải thiết bị 'DP04A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme_04A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme_04A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPolyme_04A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPolyme_04A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme_04A_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id;
                                    dlPolyme_04A_genAlarm.entityName = "DP04A";
                                    dlPolyme_04A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp;
                                    dlPolyme_04A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.activeStatus;
                                    dlPolyme_04A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme_04A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment;
                                    dlPolyme_04A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme_04A_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status;
                                    dlPolyme_04A_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description;

                                    var l3 = (dlPolyme_04A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPolyme_04A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme_04A_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id;
                                    dlPolyme_04A_genAlarm.entityName = "DP04A";
                                    dlPolyme_04A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp;
                                    dlPolyme_04A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.activeStatus;
                                    dlPolyme_04A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme_04A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment;
                                    dlPolyme_04A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme_04A_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status;
                                    dlPolyme_04A_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description;

                                    var l3 = (dlPolyme_04A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme_04A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP04B
                        Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.value = Program.InputStatus_PLC3.dlPolyme_04B_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.value != Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.entityName = "DP04B";
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.date = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.time = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description = "Lỗi quá tải thiết bị 'DP04B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme_04B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlPolyme_04B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlPolyme_04B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlPolyme_04B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme_04B_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id;
                                    dlPolyme_04B_genAlarm.entityName = "DP04B";
                                    dlPolyme_04B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp;
                                    dlPolyme_04B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.activeStatus;
                                    dlPolyme_04B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme_04B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment;
                                    dlPolyme_04B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme_04B_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status;
                                    dlPolyme_04B_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description;

                                    var l3 = (dlPolyme_04B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlPolyme_04B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlPolyme_04B_genAlarm.id = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id;
                                    dlPolyme_04B_genAlarm.entityName = "DP04B";
                                    dlPolyme_04B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp;
                                    dlPolyme_04B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.activeStatus;
                                    dlPolyme_04B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlPolyme_04B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment;
                                    dlPolyme_04B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlPolyme_04B_genAlarm.status = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status;
                                    dlPolyme_04B_genAlarm.description = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description;

                                    var l3 = (dlPolyme_04B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlPolyme_04B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP05A
                        Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.value = Program.InputStatus_PLC3.dlXut_05A_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.value != Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.entityName = "DP05A";
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.date = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.time = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description = "Lỗi quá tải thiết bị 'DP05A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut_05A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut_05A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlXut_05A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlXut_05A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_05A_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id;
                                    dlXut_05A_genAlarm.entityName = "DP05A";
                                    dlXut_05A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp;
                                    dlXut_05A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.activeStatus;
                                    dlXut_05A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_05A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment;
                                    dlXut_05A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_05A_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status;
                                    dlXut_05A_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description;

                                    var l3 = (dlXut_05A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlXut_05A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_05A_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id;
                                    dlXut_05A_genAlarm.entityName = "DP05A";
                                    dlXut_05A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp;
                                    dlXut_05A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.activeStatus;
                                    dlXut_05A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_05A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment;
                                    dlXut_05A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_05A_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status;
                                    dlXut_05A_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description;

                                    var l3 = (dlXut_05A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_05A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP05B
                        Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.value = Program.InputStatus_PLC3.dlXut_05B_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.value != Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.entityName = "DP05B";
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.date = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.time = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description = "Lỗi quá tải thiết bị 'DP05B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut_05B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlXut_05B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlXut_05B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlXut_05B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_05B_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id;
                                    dlXut_05B_genAlarm.entityName = "DP05B";
                                    dlXut_05B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp;
                                    dlXut_05B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.activeStatus;
                                    dlXut_05B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_05B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment;
                                    dlXut_05B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_05B_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status;
                                    dlXut_05B_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description;

                                    var l3 = (dlXut_05B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlXut_05B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlXut_05B_genAlarm.id = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id;
                                    dlXut_05B_genAlarm.entityName = "DP05B";
                                    dlXut_05B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp;
                                    dlXut_05B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.activeStatus;
                                    dlXut_05B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlXut_05B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment;
                                    dlXut_05B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlXut_05B_genAlarm.status = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status;
                                    dlXut_05B_genAlarm.description = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description;

                                    var l3 = (dlXut_05B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlXut_05B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP06A
                        Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.value = Program.InputStatus_PLC3.dlDd_06A_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.value != Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.entityName = "DP06A";
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.date = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.time = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description = "Lỗi quá tải thiết bị 'DP06A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlDd_06A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlDd_06A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlDd_06A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlDd_06A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlDd_06A_genAlarm.id = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id;
                                    dlDd_06A_genAlarm.entityName = "DP06A";
                                    dlDd_06A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp;
                                    dlDd_06A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.activeStatus;
                                    dlDd_06A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlDd_06A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment;
                                    dlDd_06A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlDd_06A_genAlarm.status = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status;
                                    dlDd_06A_genAlarm.description = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description;

                                    var l3 = (dlDd_06A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlDd_06A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlDd_06A_genAlarm.id = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id;
                                    dlDd_06A_genAlarm.entityName = "DP06A";
                                    dlDd_06A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp;
                                    dlDd_06A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.activeStatus;
                                    dlDd_06A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlDd_06A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment;
                                    dlDd_06A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlDd_06A_genAlarm.status = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status;
                                    dlDd_06A_genAlarm.description = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description;

                                    var l3 = (dlDd_06A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlDd_06A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP06B
                        Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.value = Program.InputStatus_PLC3.dlDd_06B_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.value != Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.entityName = "DP06B";
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.date = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.time = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description = "Lỗi quá tải thiết bị 'DP06B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlDd_06B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlDd_06B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlDd_06B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlDd_06B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlDd_06B_genAlarm.id = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id;
                                    dlDd_06B_genAlarm.entityName = "DP06B";
                                    dlDd_06B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp;
                                    dlDd_06B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.activeStatus;
                                    dlDd_06B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlDd_06B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment;
                                    dlDd_06B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlDd_06B_genAlarm.status = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status;
                                    dlDd_06B_genAlarm.description = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description;

                                    var l3 = (dlDd_06B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlDd_06B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlDd_06B_genAlarm.id = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id;
                                    dlDd_06B_genAlarm.entityName = "DP06B";
                                    dlDd_06B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp;
                                    dlDd_06B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.activeStatus;
                                    dlDd_06B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlDd_06B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment;
                                    dlDd_06B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlDd_06B_genAlarm.status = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status;
                                    dlDd_06B_genAlarm.description = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description;

                                    var l3 = (dlDd_06B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlDd_06B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP07A
                        Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.value = Program.InputStatus_PLC3.dlKhuTrung_07A_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.value != Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.entityName = "DP07A";
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.date = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.time = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description = "Lỗi quá tải thiết bị 'DP07A'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlKhuTrung_07A
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlKhuTrung_07A
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlKhuTrung_07A
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlKhuTrung_07A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlKhuTrung_07A_genAlarm.id = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id;
                                    dlKhuTrung_07A_genAlarm.entityName = "DP07A";
                                    dlKhuTrung_07A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp;
                                    dlKhuTrung_07A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.activeStatus;
                                    dlKhuTrung_07A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlKhuTrung_07A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment;
                                    dlKhuTrung_07A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlKhuTrung_07A_genAlarm.status = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status;
                                    dlKhuTrung_07A_genAlarm.description = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description;

                                    var l3 = (dlKhuTrung_07A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlKhuTrung_07A_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlKhuTrung_07A_genAlarm.id = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id;
                                    dlKhuTrung_07A_genAlarm.entityName = "DP07A";
                                    dlKhuTrung_07A_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp;
                                    dlKhuTrung_07A_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.activeStatus;
                                    dlKhuTrung_07A_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlKhuTrung_07A_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment;
                                    dlKhuTrung_07A_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlKhuTrung_07A_genAlarm.status = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status;
                                    dlKhuTrung_07A_genAlarm.description = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description;

                                    var l3 = (dlKhuTrung_07A_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlKhuTrung_07A_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion


                        #region DP07B
                        Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.value = Program.InputStatus_PLC3.dlKhuTrung_07B_tripStatus;
                        if (Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.value != Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.previousValue)
                        {
                            if (Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.value)
                            {
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.previousValue = true; // previous = true, save current value become previous value after out of function

                                // Định nghĩa alarm, đẩy vào Alarm Table
                                Guid newId = new Guid(); // Create a Unique ID string with 128 byte
                                newId = Guid.NewGuid();

                                #region LƯU DATA TO CHƯƠNG TRÌNH
                                // TEMPORARY INFO TO MAP TO OTHER:
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.entityName = "DP07B";
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.activeStatus = true;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp = DateTime.Now;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment = false;

                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id = newId.ToString();
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.date = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp.ToString("dd/MM/yyyy");
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.time = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp.ToString("HH:mm:ss");
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status = "TRIP FAULT";
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description = "Lỗi quá tải thiết bị 'DP07B'";

                                // CREATE "ListviewItem"( save to List of "ListViewItem"): List General and List TRIP as same as
                                lviAlarm_InLviList = new ListViewItem(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id); // Khởi tạo row item với ô đầu tiên là date (ngày)
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.date);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.time); // Ô thứ 2 là time
                                lviAlarm_InLviList.SubItems.Add("");
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.error_id.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status);

                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.alarmSeverity.ToString());
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description);
                                lviAlarm_InLviList.SubItems.Add(Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment.ToString());
                                lviAlarm_InLviList.BackColor = Color.Yellow;

                                // Create class item (To save to List of class item): Trip class and General class
                                TripItem_InClassList.id = newId.ToString();
                                TripItem_InClassList.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp;
                                TripItem_InClassList.date = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp.ToString("dd/MM/yyyy"); // Day
                                TripItem_InClassList.time = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp.ToString("HH:mm:ss"); // Time
                                TripItem_InClassList.duration = "";
                                TripItem_InClassList.error_id = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.error_id;
                                TripItem_InClassList.status = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status;
                                TripItem_InClassList.alarmSeverity = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.alarmSeverity;
                                TripItem_InClassList.comment = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.comment;
                                TripItem_InClassList.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment;
                                TripItem_InClassList.user = new Users();



                                // Thêm vào danh sách các ListViewItem của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlKhuTrung_07B
                                var l1 = (lviAlarm_InLviList.Clone()) as ListViewItem;
                                Program.alarmItemsList.Add(l1); // List of ListVieItem of all of trip
                                Program.alarmItemsList_trip.Add(l1); // List of ListVieItem of Trip

                                // Thêm vào danh sách các class item của: danh sách cảnh báo chung và danh sách cảnh báo trip của dlKhuTrung_07B
                                var l2 = (TripItem_InClassList.clone()) as AlarmItems.tripAlarmRow;
                                Program.alarmList_trip.Add(l2); // Thêm vào danh sách cảnh báo TRIP của dlKhuTrung_07B
                                #region Thêm vào General List

                                int n = Program.alarmList.Count;

                                if (n < maxNumberItem)
                                {

                                    //Program.alarmList[n].id = newId.ToString();
                                    AlarmItems.GeneralAlarmItem dlKhuTrung_07B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlKhuTrung_07B_genAlarm.id = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id;
                                    dlKhuTrung_07B_genAlarm.entityName = "DP07B";
                                    dlKhuTrung_07B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp;
                                    dlKhuTrung_07B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.activeStatus;
                                    dlKhuTrung_07B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlKhuTrung_07B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment;
                                    dlKhuTrung_07B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlKhuTrung_07B_genAlarm.status = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status;
                                    dlKhuTrung_07B_genAlarm.description = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description;

                                    var l3 = (dlKhuTrung_07B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;

                                    Program.alarmList.Insert(n, l3);
                                }
                                else
                                {
                                    Program.alarmList.RemoveAt(0);

                                    AlarmItems.GeneralAlarmItem dlKhuTrung_07B_genAlarm = new AlarmItems.GeneralAlarmItem();
                                    dlKhuTrung_07B_genAlarm.id = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id;
                                    dlKhuTrung_07B_genAlarm.entityName = "DP07B";
                                    dlKhuTrung_07B_genAlarm.timestamp = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp;
                                    dlKhuTrung_07B_genAlarm.activeStatus = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.activeStatus;
                                    dlKhuTrung_07B_genAlarm.alarmSeverity = ElementBase_Template.ALARM_EVENTS.alarmSeverityLevels.Warning;
                                    dlKhuTrung_07B_genAlarm.acknowledgment = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment;
                                    dlKhuTrung_07B_genAlarm.error_id = ElementBase_Template.ALARM_EVENTS.alarmCode._0x0001;
                                    dlKhuTrung_07B_genAlarm.status = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status;
                                    dlKhuTrung_07B_genAlarm.description = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description;

                                    var l3 = (dlKhuTrung_07B_genAlarm.clone()) as AlarmItems.GeneralAlarmItem;
                                    Program.alarmList.Insert(n, l3);
                                }

                                #endregion

                                #endregion

                                // CREATE BSON TYPE DOC:
                                //var bsonDoc = new BsonDocument { { "name", "BMW" }, { "price", 34621 } };
                                var bsonDoc = new BsonDocument {
                                                { "_id", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id },
                                                { "entityName", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.entityName },
                                                { "activeStatus", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.activeStatus },
                                                {"timestamp", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description }
                                                };


                                // ADD ALARM TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    lvAlarm.Items.Add(lviAlarm_InLviList);
                                });

                                #region SAVE ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion


                            }
                            else
                            {
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.value = false;
                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.previousValue = false;

                                Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.activeStatus = false;

                                #region Express "activeStatus = false" on: Table listview, DATABASE, LIST on Program
                                string _id = Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.id;
                                TimeSpan T2T1 = new TimeSpan();
                                DateTime T2 = DateTime.Now;
                                T2T1 = T2 - Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.timestamp;

                                #region UNACTIVE ON LIST OF LISTVIEW ITEM:

                                // GENERAL ALARM LIST: lviAlarm_InLviList

                                foreach (ListViewItem item in Program.alarmItemsList)
                                {
                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                // TRIP ALARM LIST:
                                foreach (ListViewItem item in Program.alarmItemsList_trip)
                                {

                                    if (item.SubItems[0].Text == _id)
                                    {
                                        item.BackColor = Color.White;
                                        item.SubItems[3].Text = T2T1.TotalSeconds.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE TO ALARM TABLE:
                                lvAlarm.Invoke((MethodInvoker)delegate
                                {
                                    for (int i = 0; i < lvAlarm.Items.Count; i++)
                                    {
                                        if (lvAlarm.Items[i].SubItems[0].Text == _id)
                                        {
                                            string a = T2T1.ToString(@"dd\.hh\:mm\:ss\.ff");
                                            lvAlarm.Items[i].BackColor = Color.White;
                                            lvAlarm.Items[i].SubItems[3].Text = a;
                                        }

                                    }
                                });
                                #endregion

                                #region UNACTIVE ON LIST OF CLASS ITEM:
                                // GENERAL ALARM LIST
                                foreach (AlarmItems.GeneralAlarmItem item in Program.alarmList)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                // TRIP ALARM LIST
                                foreach (AlarmItems.tripAlarmRow item in Program.alarmList_trip)
                                {

                                    if (item.id == _id)
                                    {
                                        item.activeStatus = false;
                                        item.duration = T2T1.ToString();
                                    }
                                }

                                #endregion

                                #region UNACTIVE ON DATABASE:

                                #region ADD ALARM DOCUMENT TO COLLECTION ADD "Alarm_Historian_Data"
                                BsonDocument bsonDoc = new BsonDocument {
                                                { "_id", Guid.NewGuid().ToString() },
                                                { "entityName", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.entityName },
                                                { "activeStatus", false },
                                                {"timestamp", T2},
                                                {"alarmSeverity", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.alarmSeverity},
                                                {"acknowledgment", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.acknowledgment},
                                                {"error_id", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.error_id},
                                                {"status", Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.status},
                                                { "description",Program.danhSachAlarm.almItem_dlKhuTrung_07B_tripStatus.description }
                                                };

                                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Alarm_Historian_Data");
                                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);
                                #endregion

                                #endregion

                                #endregion

                            }
                        }
                        #endregion

                        #endregion

                        else
                        {
                            return;
                        }

                    }

                    // FOR DEBUGGING:
                    //Console.WriteLine("Trip_mtk01: " + Program.danhSachAlarm.almItem_mtk01_tripStatus.value.ToString());
                    //Console.WriteLine("Trip_mtk02: " + Program.danhSachAlarm.almItem_mtk02_tripStatus.value.ToString());
                }
                catch (Exception err)
                {

                }

            }
        }

        internal class EnviIndxAquisition : ElementBase_Template.Ultility.CycleTime.levelDown
        {
            Timestamp.ultility getTime = new Timestamp.ultility();
            public EnviIndxAquisition()
            {

            }

            public EnviIndxAquisition(int Period)
            {
                this.Period = Period;
            }
            public override void updateEventHandler(object sender, ElapsedEventArgs e)
            {
                //base.Detect();
                Detect();
            }

            public override void Detect()
            {
                BsonDocument bsonDoc = new BsonDocument {
                                            {"_id", Guid.NewGuid().ToString() },
                                            {"cod_Index", Program.QuanTracIndex_PLC1.cod_Index },
                                            {"tss_Index", Program.QuanTracIndex_PLC1.tss_Index },
                                            {"ph_Index", Program.QuanTracIndex_PLC1.ph_Index},
                                            {"color_Index", Program.QuanTracIndex_PLC1.color_Index},
                                            {"temper_Index", Program.QuanTracIndex_PLC1.temper_Index},
                                            {"nh3_Index", Program.QuanTracIndex_PLC1.nh3_Index},
                                            {"flowInTotal", Program.QuanTracIndex_PLC1.flowInTotal},
                                            { "flowInCap",Program.QuanTracIndex_PLC1.flowInCap },
                                            { "flowOutTotal",Program.QuanTracIndex_PLC1.flowOutTotal },
                                            { "flowOutCap",Program.QuanTracIndex_PLC1.flowOutCap },
                                            { "timestamp", DateTime.Now /*getTime.getTime_LocalToUTC_second(DateTime.Now).ToString()*/ }, // Date.Now (Local time) => UTC time when on MongoDB
                                            };

                Program.mongoDB_MP2.findDB(Program.mongoDB_MP2.dbClient, "MP2_2");
                Program.mongoDB_MP2.getCollection(Program.mongoDB_MP2.dbClient, Program.mongoDB_MP2.database, "Environment_Index_Historian_Data");
                Program.mongoDB_MP2.crud_insert(Program.mongoDB_MP2.collection, bsonDoc);

               
        }
        }
    }
 }
    
